EXPORT START


===============================
FILE: electron/utils/shortcuts.js
===============================
// electron/utils/shortcuts.js
const { globalShortcut } = require('electron');

const SHORTCUTS = {
  'CommandOrControl+K': 'globalSearch',
  'CommandOrControl+N': 'newBooking',
  'CommandOrControl+,': 'showHelp',
  'CommandOrControl+1': 'dashboard',
  'CommandOrControl+2': 'calendar'
};

function registerShortcuts(mainWindow) {
  Object.entries(SHORTCUTS).forEach(([shortcut, action]) => {
    globalShortcut.register(shortcut, () => {
      if (mainWindow) {
        mainWindow.webContents.send('shortcut', action);
      }
    });
  });
}

function unregisterShortcuts() {
  globalShortcut.unregisterAll();
}

module.exports = { registerShortcuts, unregisterShortcuts };


===============================
FILE: electron/utils/errorLogger.js
===============================
// electron/utils/errorLogger.js
const fs = require('fs');
const path = require('path');
const { app } = require('electron');

const logDir = path.join(app.getPath('userData'), 'logs');
if (!fs.existsSync(logDir)) {
  fs.mkdirSync(logDir, { recursive: true });
}

const logFile = path.join(logDir, `error-${new Date().toISOString().split('T')[0]}.log`);

function logError(error, context = 'Unknown') {
  const logEntry = {
    timestamp: new Date().toISOString(),
    context,
    error: error.message || error,
    stack: error.stack
  };
  
  fs.appendFileSync(logFile, JSON.stringify(logEntry) + '\n');
  console.error(`[${context}]`, error);
}

module.exports = { logError };


===============================
FILE: electron/utils/logger.js
===============================
// electron/utils/logger.js
const fs = require('fs');
const path = require('path');
const { app } = require('electron');

const logDir = path.join(app.getPath('userData'), 'logs');
if (!fs.existsSync(logDir)) {
  fs.mkdirSync(logDir, { recursive: true });
}

const logFile = path.join(logDir, `app-${new Date().toISOString().split('T')[0]}.log`);

function log(level, message, data = {}) {
  const logEntry = {
    timestamp: new Date().toISOString(),
    level: level.toUpperCase(),
    message,
    ...data
  };
  
  fs.appendFileSync(logFile, JSON.stringify(logEntry) + '\n');
  console.log(`[${level.toUpperCase()}]`, message);
}

module.exports = {
  info: (msg, data) => log('info', msg, data),
  warn: (msg, data) => log('warn', msg, data),
  error: (msg, data) => log('error', msg, data),
  debug: (msg, data) => log('debug', msg, data)
};


===============================
FILE: electron/utils/skuGenerator.js
===============================
// electron/utils/skuGenerator.js
const crypto = require('crypto');

function generateSKU(prefix = 'SKU') {
  const ts = Date.now().toString(36).toUpperCase();
  const rand = crypto.randomBytes(3).toString('hex').toUpperCase();
  return `${prefix}-${ts}${rand}`;
}

function validateSKU(sku) {
  const skuRegex = /^[A-Z0-9]{3,}-[A-Z0-9]{6,}$/;
  return skuRegex.test(sku);
}

module.exports = { generateSKU, validateSKU };


===============================
FILE: electron/config/env.js
===============================
// electron/config/env.js
const path = require('path');
const { app } = require('electron');

module.exports = {
  isDev: process.env.NODE_ENV === 'development',
  dbPath: process.env.NODE_ENV === 'development' 
    ? path.join(__dirname, '..', 'database', 'sqlite.db')
    : path.join(app.getPath('userData'), 'xnoll-offline.sqlite'),
  apiBaseUrl: process.env.VITEAPIBASEURL || 'https://api.xnoll.com',
  syncEnabled: process.env.VITESYNCENABLED === 'true',
  logLevel: process.env.VITELOGLEVEL || 'info'
};


===============================
FILE: electron/config/app.config.json
===============================
{
  "appName": "Xnoll Booking Desktop",
  "version": "1.0.0",
  "author": "Xnoll Team",
  "features": {
    "offlineMode": true,
    "syncEnabled": false,
    "licenseRequired": true,
    "autoBackup": false
  },
  "defaultSettings": {
    "theme": "light",
    "language": "en",
    "currency": "INR",
    "dateFormat": "DD/MM/YYYY",
    "timezone": "Asia/Kolkata"
  }
}


===============================
FILE: electron/windows/mainWindow.js
===============================
const { BrowserWindow } = require('electron');
const path = require('path');

function createMainWindow(isDev) {
  const mainWindow = new BrowserWindow({
    width: 1280,
    height: 800,
    minWidth: 1024,
    minHeight: 640,
    title: 'Xnoll Booking Desktop',
    webPreferences: {
      preload: path.join(__dirname, '../preload/index.js'),
      contextIsolation: true,
      nodeIntegration: false
    }
  });

  if (isDev) {
    mainWindow.loadURL('http://localhost:5173');
    mainWindow.webContents.openDevTools();
  } else {
    mainWindow.loadFile(path.join(__dirname, '../../dist/renderer/index.html'));
  }

  return mainWindow;
}

module.exports = createMainWindow;


===============================
FILE: electron/windows/licenseWindow.js
===============================
// electron/windows/licenseWindow.js
const { BrowserWindow } = require('electron');
const path = require('path');

function createLicenseWindow(parentWindow) {
  const licenseWindow = new BrowserWindow({
    width: 500,
    height: 400,
    parent: parentWindow,
    modal: true,
    show: false,
    webPreferences: {
      preload: path.join(__dirname, '..', 'preload', 'index.js'),
      contextIsolation: true,
      nodeIntegration: false
    }
  });

  licenseWindow.loadFile(path.join(__dirname, '..', 'renderer', 'license.html'));
  licenseWindow.once('ready-to-show', () => licenseWindow.show());

  return licenseWindow;
}

module.exports = { createLicenseWindow };


===============================
FILE: electron/ipc/customer.ipc.js
===============================
// electron/ipc/customer.ipc.js
const { ipcMain } = require('electron');
const db = require('../database/db');

// Get all customers (for list)
ipcMain.handle('customers:list', async () => {
  return db.getCustomersWithCustomFields();
});

// Create new customer
ipcMain.handle('customers:create', async (_event, payload) => {
  return db.insertCustomer(payload);
});

// Update existing customer
ipcMain.handle('customers:update', async (_event, payload) => {
  return db.updateCustomer(payload);
});

// Delete customer
ipcMain.handle('customers:delete', async (_event, id) => {
  return db.deleteCustomer(id);
});


===============================
FILE: electron/ipc/print.ipc.js
===============================
const { ipcMain, BrowserWindow, dialog } = require('electron');
const path = require('path');

ipcMain.handle('print:html', async (_event, htmlContent) => {
  try {
    // Create a new hidden browser window for printing
    const printWindow = new BrowserWindow({
      show: false,
      webPreferences: {
        nodeIntegration: false,
        contextIsolation: true,
      },
    });

    // Load the HTML content
    await printWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(htmlContent)}`);

    // Wait for content to load
    await new Promise((resolve) => {
      printWindow.webContents.once('did-finish-load', resolve);
    });

    // Print the content
    const result = await printWindow.webContents.print({}, {
      silent: false,
      printBackground: true,
      deviceName: '',
    });

    // Close the print window
    printWindow.close();

    return { success: true, result };
  } catch (error) {
    console.error('Print error:', error);
    return { success: false, error: error.message };
  }
});


===============================
FILE: electron/ipc/settings.ipc.js
===============================
// electron/ipc/settings.ipc.js
const { ipcMain } = require('electron');
const db = require('../database/db');

// Get all settings
ipcMain.handle('settings:get', async () => {
  try {
    const settings = db.getSettings();
    return { success: true, settings };
  } catch (error) {
    console.error('Get settings error:', error);
    return { success: false, error: error.message };
  }
});

// Update settings
ipcMain.handle('settings:save', async (_event, payload) => {
  try {
    db.updateSettings(payload);
    return { success: true };
  } catch (error) {
    console.error('Save settings error:', error);
    return { success: false, error: error.message };
  }
});

// Get specific setting
ipcMain.handle('settings:getSetting', async (_event, key) => {
  try {
    const settings = db.getSettings();
    return { success: true, value: settings[key] };
  } catch (error) {
    console.error('Get setting error:', error);
    return { success: false, error: error.message };
  }
});

// Update specific setting
ipcMain.handle('settings:updateSetting', async (_event, { key, value }) => {
  try {
    const settings = db.getSettings();
    settings[key] = value;
    db.updateSettings(settings);
    return { success: true };
  } catch (error) {
    console.error('Update setting error:', error);
    return { success: false, error: error.message };
  }
});

===============================
FILE: electron/ipc/sku.ipc.js
===============================
const { ipcMain } = require('electron');
const { generateSKU, validateSKU } = require('../utils/skuGenerator');
const db = require('../database/db');

ipcMain.handle('sku:generate', async (_event, prefix = 'SKU') => {
  try {
    let sku = generateSKU(prefix);
    let attempts = 0;
    while (db.checkSkuExists(sku) && attempts < 10) {
      sku = generateSKU(prefix);
      attempts++;
    }
    if (attempts === 10) throw new Error('Failed to generate unique SKU');
    return { success: true, sku };
  } catch (err) {
    console.error('sku:generate error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('sku:validate', async (_event, sku, excludeId) => {
  try {
    const exists = db.checkSkuExists(sku, excludeId);
    return { success: true, exists };
  } catch (err) {
    console.error('sku:validate error', err);
    return { success: false, error: err.message };
  }
});



===============================
FILE: electron/ipc/invoice.ipc.js
===============================

const { ipcMain } = require('electron');
const db = require('../database/db');

ipcMain.handle('invoices:list', async () => {
  return db.getAllInvoices();
});

ipcMain.handle('invoices:create', async (_event, payload) => {
  return db.insertInvoice(payload);
});

ipcMain.handle('invoices:update', async (_event, payload) => {
  return db.updateInvoice(payload);
});

ipcMain.handle('invoices:delete', async (_event, id) => {
  return db.deleteInvoice(id);
});

===============================
FILE: electron/ipc/error.ipc.js
===============================
// electron/ipc/error.ipc.js
const { ipcMain } = require('electron');
const { logError } = require('../utils/errorLogger');

ipcMain.handle('errorReport', async (event, errorData) => {
  try {
    logError(errorData.error, errorData.context);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
});


===============================
FILE: electron/ipc/backup.ipc.js
===============================
// electron/ipc/backup.ipc.js
const { ipcMain, app } = require('electron');
const fs = require('fs-extra');
const path = require('path');

const isDev = process.env.NODE_ENV === 'development';
const dbPath = isDev
  ? path.join(__dirname, '../database/sqlite.db')
  : path.join(app.getPath('userData'), 'xnoll-offline.sqlite');

function getBackupDir() {
  const dir = path.join(app.getPath('documents'), 'XnollBackups');
  fs.ensureDirSync(dir);
  return dir;
}

ipcMain.handle('backup:create', async (_event, location) => {
  try {
    const targetDir = location || getBackupDir();
    const backupPath = path.join(targetDir, `xnoll-backup-${Date.now()}.sqlite`);
    await fs.copy(dbPath, backupPath);
    return { success: true, backupPath };
  } catch (error) {
    console.error('backup:create error', error);
    return { success: false, error: error.message };
  }
});

ipcMain.handle('backup:list', async () => {
  try {
    const dir = getBackupDir();
    const files = fs.readdirSync(dir).filter((f) => f.endsWith('.sqlite'));
    return files.map((f) => {
      const full = path.join(dir, f);
      return { name: f, path: full, modified: fs.statSync(full).mtimeMs };
    });
  } catch (error) {
    console.error('backup:list error', error);
  return [];
  }
});

ipcMain.handle('backup:restore', async (_event, filePath) => {
  try {
    if (!filePath) throw new Error('No file selected');
    await fs.copy(filePath, dbPath);
    // remove shm/wal if present
    const wal = `${dbPath}-wal`;
    const shm = `${dbPath}-shm`;
    if (fs.existsSync(wal)) fs.removeSync(wal);
    if (fs.existsSync(shm)) fs.removeSync(shm);
    return { success: true };
  } catch (error) {
    console.error('backup:restore error', error);
    return { success: false, error: error.message };
  }
});

ipcMain.handle('backup:export', async () => {
  try {
    const dir = getBackupDir();
    const backupPath = path.join(dir, `xnoll-export-${Date.now()}.sqlite`);
    await fs.copy(dbPath, backupPath);
    return { success: true, backupPath };
  } catch (error) {
    console.error('backup:export error', error);
    return { success: false, error: error.message };
  }
});


===============================
FILE: electron/ipc/seeder.ipc.js
===============================
// electron/ipc/seeder.ipc.js
const { ipcMain } = require("electron");
const { spawn } = require("child_process");
const path = require("path");

ipcMain.handle("dev:run-seeder", async (event) => {  // Changed to handle
  return new Promise((resolve, reject) => {  // Wrap in Promise for await
    try {
      const seedPath = path.join(__dirname, "..", "database", "seed.js");
      if (!require("fs").existsSync(seedPath)) {
        const err = new Error(`Seeder script not found: ${seedPath}`);
        event.sender.send("seeder:log", `ERROR: ${err.message}`);
        reject(err);
        return;
      }

      const child = spawn(process.execPath, [seedPath]);

      child.stdout.on("data", (data) => {
        const logMsg = data.toString();
        event.sender.send("seeder:log", logMsg);  // Still send for real-time
      });

      child.stderr.on("data", (data) => {
        const logMsg = "ERROR: " + data.toString();
        event.sender.send("seeder:log", logMsg);
      });

      child.on("close", (code) => {
        event.sender.send("seeder:finished", code);
        if (code === 0) {
          resolve({ success: true, code });  // Resolve on success
        } else {
          reject(new Error(`Seeder exited with code ${code}`));
        }
      });

      child.on("error", (err) => {
        event.sender.send("seeder:log", `SPAWN ERROR: ${err.message}`);
        reject(err);
      });
    } catch (err) {
      event.sender.send("seeder:log", `ERROR: ${err.message}`);
      reject(err);
    }
  });
});

===============================
FILE: electron/ipc/booking.ipc.js
===============================
const { ipcMain } = require("electron");
const db = require("../database/db");

// list
ipcMain.handle("bookings:list", async () => {
  return db.getBookingsWithCustomFields();
});

// create (header + items)
ipcMain.handle("bookings:create", async (_event, payload) => {
  return db.createBookingWithItems(payload);
});

// update (header + items)
ipcMain.handle("bookings:update", async (_event, payload) => {
  return db.updateBookingWithItems(payload);
});

// delete (header + items)
ipcMain.handle("bookings:delete", async (_event, id) => {
  return db.deleteBookingWithItems(id);
});

ipcMain.handle("bookings:getById", async (_event, id) => {
  return db.getBookingsById(id);
});


===============================
FILE: electron/ipc/reports.ipc.js
===============================


===============================
FILE: electron/ipc/calendar.ipc.js
===============================
const { ipcMain } = require('electron');
const db = require('../database/db');

ipcMain.handle('calendar:getBookings', async (_event, { startDate, endDate }) => {
  try {
    const rows = db.listBookingsInRange(startDate, endDate);
    return rows;
  } catch (err) {
    console.error('calendar:getBookings error', err);
    return { success: false, error: err.message };
  }
});



===============================
FILE: electron/ipc/search.ipc.js
===============================
// electron/ipc/search.ipc.js
const { ipcMain } = require('electron');
const searchService = require('../services/search.service');

// Global search
ipcMain.handle('search:global', async (_event, query) => {
  try {
    const results = await searchService.globalSearch(query);
    return { success: true, results };
  } catch (error) {
    console.error('Global search error:', error);
    return { success: false, error: error.message, results: {} };
  }
});

// Module-specific search
ipcMain.handle('search:module', async (_event, { module, query }) => {
  try {
    const results = await searchService.moduleSearch(module, query);
    return { success: true, results };
  } catch (error) {
    console.error('Module search error:', error);
    return { success: false, error: error.message, results: [] };
  }
});

===============================
FILE: electron/ipc/license.ipc.js
===============================
// electron/ipc/license.ipc.js
const { ipcMain } = require('electron');
const licenseService = require('../services/license.service');

// Get machine ID
ipcMain.handle('license:getMachineId', async () => {
  try {
    const machineId = licenseService.getMachineId();
    return { success: true, machineId };
  } catch (error) {
    return { success: false, error: error.message };
  }
});

// Activate license
ipcMain.handle('license:activate', async (_event, licenseKey) => {
  try {
    const result = licenseService.saveLicense(licenseKey);
    return result;
  } catch (error) {
    return { success: false, error: error.message };
  }
});

// Check license status
ipcMain.handle('license:check', async () => {
  try {
    const result = licenseService.loadLicense();
    return result;
  } catch (error) {
    return { valid: false, error: error.message };
  }
});

// Deactivate license
ipcMain.handle('license:deactivate', async () => {
  try {
    const result = licenseService.removeLicense();
    return result;
  } catch (error) {
    return { success: false, error: error.message };
  }
});

// Generate license (for testing/demo - remove in production!)
ipcMain.handle('license:generate', async (_event, { machineId, daysValid }) => {
  try {
    const expiryDate = new Date();
    expiryDate.setDate(expiryDate.getDate() + (daysValid || 365));
    
    const licenseKey = licenseService.constructor.generateLicenseKey(machineId, expiryDate);
    return { success: true, licenseKey, expiryDate };
  } catch (error) {
    return { success: false, error: error.message };
  }
});

===============================
FILE: electron/ipc/company.ipc.js
===============================
const { ipcMain } = require('electron');
const db = require('../database/db');

ipcMain.handle('company:get', async () => {
  try {
    const company = db.getCompanyProfile();
    return { success: true, company };
  } catch (err) {
    console.error('company:get error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('company:save', async (_event, payload) => {
  try {
    db.updateCompanyProfile(payload);
    return { success: true };
  } catch (err) {
    console.error('company:save error', err);
    return { success: false, error: err.message };
  }
});



===============================
FILE: electron/ipc/app.ipc.js
===============================
const { ipcMain } = require('electron');
const db = require('../database/db');

ipcMain.handle('db:select', async (_event, table) => {
  return db.selectAll(table);
});


===============================
FILE: electron/ipc/customFields.ipc.js
===============================
const { ipcMain } = require('electron');
const db = require('../database/db');

ipcMain.handle('customFields:list', async (_event, module) => {
  try {
    return db.getAllCustomFields(module);
  } catch (err) {
    console.error('customFields:list error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('customFields:create', async (_event, payload) => {
  try {
    // Map frontend field names to database field names
    const dbPayload = {
      field_name: payload.name,
      field_label: payload.label,
      module: payload.module,
      field_type: payload.type,
      is_required: payload.required,
      display_in_grid: payload.display_in_grid,
      display_in_filter: payload.display_in_filter,
      is_sortable: payload.sortable,
      is_searchable: payload.searchable,
      options: payload.options,
      default_value: payload.default_value
    };
    return db.insertCustomField(dbPayload);
  } catch (err) {
    console.error('customFields:create error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('customFields:update', async (_event, payload) => {
  try {
    // Map frontend field names to database field names
    const dbPayload = {
      id: payload.id,
      field_name: payload.name,
      field_label: payload.label,
      module: payload.module,
      field_type: payload.type,
      is_required: payload.required,
      display_in_grid: payload.display_in_grid,
      display_in_filter: payload.display_in_filter,
      is_sortable: payload.sortable,
      is_searchable: payload.searchable,
      options: payload.options,
      default_value: payload.default_value
    };
    return db.updateCustomField(dbPayload);
  } catch (err) {
    console.error('customFields:update error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('customFields:delete', async (_event, id) => {
  try {
    return db.deleteCustomField(id);
  } catch (err) {
    console.error('customFields:delete error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('customFieldValues:get', async (_event, { fieldId, recordId }) => {
  try {
    return db.getCustomFieldValues(fieldId, recordId);
  } catch (err) {
    console.error('customFieldValues:get error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('customFieldValues:save', async (_event, payload) => {
  try {
    // Map field_id to custom_field_id for database
    const dbPayload = {
      custom_field_id: payload.field_id,
      record_id: payload.record_id,
      value: payload.value
    };
    return db.saveCustomFieldValue(dbPayload);
  } catch (err) {
    console.error('customFieldValues:save error', err);
    return { success: false, error: err.message };
  }
});



===============================
FILE: electron/ipc/product.ipc.js
===============================
// electron/ipc/product.ipc.js
const { ipcMain } = require('electron');
const db = require('../database/db');

// List products
ipcMain.handle('products:list', async () => {
  return db.getProductsWithCustomFields();
});

// Create
ipcMain.handle('products:create', async (_event, payload) => {
  return db.insertProduct(payload);
});

// Update
ipcMain.handle('products:update', async (_event, payload) => {
  return db.updateProduct(payload);
});

// Delete
ipcMain.handle('products:delete', async (_event, id) => {
  return db.deleteProduct(id);
});

===============================
FILE: electron/ipc/notes.ipc.js
===============================
const { ipcMain } = require('electron');
const db = require('../database/db');

ipcMain.handle('notes:list', async () => {
  try {
    return db.getAllNotes();
  } catch (err) {
    console.error('notes:list error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('notes:create', async (_event, payload) => {
  try {
    return db.insertNote(payload);
  } catch (err) {
    console.error('notes:create error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('notes:update', async (_event, payload) => {
  try {
    return db.updateNote(payload);
  } catch (err) {
    console.error('notes:update error', err);
    return { success: false, error: err.message };
  }
});

ipcMain.handle('notes:delete', async (_event, id) => {
  try {
    return db.deleteNote(id);
  } catch (err) {
    console.error('notes:delete error', err);
    return { success: false, error: err.message };
  }
});



===============================
FILE: electron/menu.js
===============================
// electron/menu.js
const { Menu, shell, BrowserWindow, dialog } = require('electron');

const isDev = process.env.NODE_ENV === 'development';

const template = [
  {
    label: 'File',
    submenu: [
      {
        label: 'New Booking',
        accelerator: 'CmdOrCtrl+N',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'booking');
        }
      },
      { type: 'separator' },
      { type: 'separator' },
      {
        label: 'Settings',
        accelerator: 'CmdOrCtrl+,',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'settings');
        }
      },
      { type: 'separator' },
      { 
        role: 'quit', 
        label: 'Exit',
        accelerator: 'CmdOrCtrl+Q'
      }
    ]
  },
  {
    label: 'Edit',
    submenu: [
      { role: 'undo', label: 'Undo', accelerator: 'CmdOrCtrl+Z' },
      { role: 'redo', label: 'Redo', accelerator: 'Shift+CmdOrCtrl+Z' },
      { type: 'separator' },
      { role: 'cut', label: 'Cut', accelerator: 'CmdOrCtrl+X' },
      { role: 'copy', label: 'Copy', accelerator: 'CmdOrCtrl+C' },
      { role: 'paste', label: 'Paste', accelerator: 'CmdOrCtrl+V' },
      { role: 'selectAll', label: 'Select All', accelerator: 'CmdOrCtrl+A' }
    ]
  },
  {
    label: 'View',
    submenu: [
      {
        label: 'Dashboard',
        accelerator: 'CmdOrCtrl+1',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'dashboard');
        }
      },
      {
        label: 'Calendar',
        accelerator: 'CmdOrCtrl+2',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'calendar');
        }
      },
      {
        label: 'Bookings',
        accelerator: 'CmdOrCtrl+3',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'booking');
        }
      },
      {
        label: 'Customers',
        accelerator: 'CmdOrCtrl+4',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'customers');
        }
      },
      {
        label: 'Products',
        accelerator: 'CmdOrCtrl+5',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'products');
        }
      },
      {
        label: 'Invoices',
        accelerator: 'CmdOrCtrl+6',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'invoices');
        }
      },
      {
        label: 'Reports',
        accelerator: 'CmdOrCtrl+7',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) win.webContents.send('navigate', 'reports');
        }
      },
      { type: 'separator' },
      { 
        role: 'reload', 
        label: 'Reload',
        accelerator: 'CmdOrCtrl+R'
      },
      // { 
      //   role: 'togglefullscreen',
      //   label: 'Toggle Fullscreen',
      //   accelerator: process.platform === 'darwin' ? 'Ctrl+Command+F' : 'F11'
      // },
      ...(isDev
        ? [
            { type: 'separator' }, 
            { 
              role: 'toggledevtools', 
              label: 'Toggle DevTools',
              accelerator: 'CmdOrCtrl+Shift+I'
            }
          ]
        : [])
    ]
  },
  {
    label: 'Reports',
    submenu: [
      {
        label: 'Sales Report',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) {
            win.webContents.send('navigate', 'reports');
            win.webContents.send('reports:type', 'sales');
          }
        }
      },
      {
        label: 'Booking Statistics',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) {
            win.webContents.send('navigate', 'reports');
            win.webContents.send('reports:type', 'bookings');
          }
        }
      },
      {
        label: 'Customer Analytics',
        click: () => {
          const win = BrowserWindow.getAllWindows()[0];
          if (win) {
            win.webContents.send('navigate', 'reports');
            win.webContents.send('reports:type', 'customers');
          }
        }
      }
    ]
  },
  {
    label: 'Help',
    submenu: [
      // {
      //   label: 'Keyboard Shortcuts',
      //   accelerator: 'CmdOrCtrl+/',
      //   click: () => {
      //     const win = BrowserWindow.getAllWindows()[0];
      //     if (win) win.webContents.send('show:shortcuts');
      //   }
      // },
      { type: 'separator' },
      {
        label: 'Documentation',
        click: () => shell.openExternal('https://xnoll.com/xnoll-booking-desktop/docs')
      },
      {
        label: 'Open Website',
        click: () => shell.openExternal('https://xnoll.com')
      },
      {
        label: 'Report Issue',
        click: () => shell.openExternal('https://xnoll.com/support')
      },
      { type: 'separator' },
      {
        label: 'About Xnoll Desktop',
        click: () => {
          dialog.showMessageBox({
            type: 'info',
            title: 'About Xnoll Booking Desktop',
            message: 'Xnoll Booking Desktop',
            detail: `Version: 1.0.0\nOffline-first booking and appointment system\n\nÂ© 2024 Xnoll. All rights reserved.`,
            buttons: ['OK']
          });
        }
      }
    ]
  }
];

module.exports = Menu.buildFromTemplate(template);

===============================
FILE: electron/preload/index.js
===============================
const { contextBridge, ipcRenderer } = require("electron");

const env = process.env.NODE_ENV || "production";

contextBridge.exposeInMainWorld("xnoll", {
  // App info
  getAppInfo: () => ({
    name: "Xnoll Booking Desktop",
    env,
  }),

  // Navigation
  onNavigate: (callback) => {
    const handler = (_event, page) => callback(page);
    ipcRenderer.on("navigate", handler);
    // Return a cleanup function
    return () => ipcRenderer.removeListener("navigate", handler);
  },

  // Database - Generic
  dbSelect: (table) => ipcRenderer.invoke("db:select", table),

  // Customers API
  customersList: () => ipcRenderer.invoke("customers:list"),
  customersCreate: (payload) => ipcRenderer.invoke("customers:create", payload),
  customersUpdate: (payload) => ipcRenderer.invoke("customers:update", payload),
  customersDelete: (id) => ipcRenderer.invoke("customers:delete", id),

  // Products API
  productsList: () => ipcRenderer.invoke("products:list"),
  productsCreate: (payload) => ipcRenderer.invoke("products:create", payload),
  productsUpdate: (payload) => ipcRenderer.invoke("products:update", payload),
  productsDelete: (id) => ipcRenderer.invoke("products:delete", id),

  // Bookings API
  bookingsList: (payload) => ipcRenderer.invoke("bookings:list", payload),
  bookingsCreate: (payload) => ipcRenderer.invoke("bookings:create", payload),
  bookingsUpdate: (payload) => ipcRenderer.invoke("bookings:update", payload),
  bookingsDelete: (id) => ipcRenderer.invoke("bookings:delete", id),
  getBookingsById: (id) => ipcRenderer.invoke("bookings:getById", id),

  // Invoices API
  invoicesList: () => ipcRenderer.invoke("invoices:list"),
  invoicesCreate: (payload) => ipcRenderer.invoke("invoices:create", payload),
  invoicesUpdate: (payload) => ipcRenderer.invoke("invoices:update", payload),
  invoicesDelete: (id) => ipcRenderer.invoke("invoices:delete", id),

  // License API
  licenseGetMachineId: () => ipcRenderer.invoke("license:getMachineId"),
  licenseActivate: (key) => ipcRenderer.invoke("license:activate", key),
  licenseCheck: () => ipcRenderer.invoke("license:check"),
  licenseDeactivate: () => ipcRenderer.invoke("license:deactivate"),
  licenseGenerate: (params) => ipcRenderer.invoke("license:generate", params), // Demo only

  // Settings API
  settingsGet: () => ipcRenderer.invoke("settings:get"),
  settingsSave: (payload) => ipcRenderer.invoke("settings:save", payload),

  // Custom Fields API
  customFieldsList: (module) => ipcRenderer.invoke("customFields:list", module),
  customFieldsCreate: (payload) =>
    ipcRenderer.invoke("customFields:create", payload),
  customFieldsUpdate: (payload) =>
    ipcRenderer.invoke("customFields:update", payload),
  customFieldsDelete: (id) => ipcRenderer.invoke("customFields:delete", id),
  customFieldValuesGet: (fieldId, recordId) =>
    ipcRenderer.invoke("customFieldValues:get", { fieldId, recordId }),
  customFieldValuesSave: (payload) =>
    ipcRenderer.invoke("customFieldValues:save", payload),

  // Notes API
  notesList: () => ipcRenderer.invoke("notes:list"),
  notesCreate: (payload) => ipcRenderer.invoke("notes:create", payload),
  notesUpdate: (payload) => ipcRenderer.invoke("notes:update", payload),
  notesDelete: (id) => ipcRenderer.invoke("notes:delete", id),

  // Search API
  searchGlobal: (query) => ipcRenderer.invoke("search:global", query),
  searchModule: (module, query) =>
    ipcRenderer.invoke("search:module", { module, query }),

  // Backup & Restore API
  backupCreate: (location) => ipcRenderer.invoke("backup:create", location),
  backupRestore: (filePath) => ipcRenderer.invoke("backup:restore", filePath),
  backupList: () => ipcRenderer.invoke("backup:list"),
  backupExport: () => ipcRenderer.invoke("backup:export"),

  // Reports API
  reportsGenerate: (type, params) =>
    ipcRenderer.invoke("reports:generate", { type, params }),
  reportsExport: (type, format, params) =>
    ipcRenderer.invoke("reports:export", { type, format, params }),

  // Error Reporting API
  errorReport: (errorData) => ipcRenderer.invoke("error:report", errorData),

  // SKU Generation API
  skuGenerate: (prefix) => ipcRenderer.invoke("sku:generate", prefix),
  skuValidate: (sku) => ipcRenderer.invoke("sku:validate", sku),

  // Company Profile API
  companyGet: () => ipcRenderer.invoke("company:get"),
  companySave: (payload) => ipcRenderer.invoke("company:save", payload),

  // Calendar API
  calendarGetBookings: (startDate, endDate) =>
    ipcRenderer.invoke("calendar:getBookings", { startDate, endDate }),

  // Notifications (from main process)
  onNotification: (callback) => {
    ipcRenderer.on("notification", (_event, data) => callback(data));
  },

  // System API
  systemInfo: () => ipcRenderer.invoke("system:info"),

  // File operations
  selectFile: (options) => ipcRenderer.invoke("file:select", options),
  selectDirectory: () => ipcRenderer.invoke("file:selectDirectory"),

  // Seeder logs & progress
  onSeederLog: (callback) => {
    const handler = (_event, log) => callback(log);
    ipcRenderer.on("seeder:log", handler);
    return () => ipcRenderer.removeListener("seeder:log", handler);
  },
  onSeederFinished: (callback) => {
    const handler = (_event, code) => callback(code);
    ipcRenderer.on("seeder:finished", handler);
    return () => ipcRenderer.removeListener("seeder:finished", handler);
  },

  // Print
  print: (htmlContent) => ipcRenderer.invoke("print:html", htmlContent),
});

// electron/preload/index.js (in the "api" exposure)
contextBridge.exposeInMainWorld("api", {
  runSeeder: () => ipcRenderer.invoke("dev:run-seeder"), // Now works with handle
});


===============================
FILE: electron/services/sync.service.js
===============================


===============================
FILE: electron/services/license.service.js
===============================
// electron/services/license.service.js
const crypto = require('crypto');
const os = require('os');
const { app } = require('electron');
const path = require('path');
const fs = require('fs');

class LicenseService {
  constructor() {
    this.licenseFile = path.join(app.getPath('userData'), 'license.dat');
    this.secretKey = 'XNOLL_SECRET_KEY_2024'; // In production, use environment variable
  }

  /**
   * Generate unique machine ID based on CPU and network interfaces
   */
  getMachineId() {
    const cpus = os.cpus();
    const networkInterfaces = os.networkInterfaces();
    
    // Get CPU model
    const cpuModel = cpus[0]?.model || 'unknown';
    
    // Get MAC addresses
    const macs = [];
    Object.values(networkInterfaces).forEach(interfaces => {
      interfaces.forEach(iface => {
        if (iface.mac && iface.mac !== '00:00:00:00:00:00') {
          macs.push(iface.mac);
        }
      });
    });
    
    const uniqueString = `${cpuModel}-${macs.sort().join('-')}-${os.hostname()}`;
    
    // Hash the unique string
    return crypto.createHash('sha256').update(uniqueString).digest('hex').substring(0, 32);
  }

  /**
   * Validate license key format and signature
   */
  validateLicenseFormat(licenseKey) {
    // License format: XXXX-XXXX-XXXX-XXXX-XXXX (20 characters + 4 dashes)
    const regex = /^[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/;
    return regex.test(licenseKey);
  }

  /**
   * Verify license key against machine ID
   */
  verifyLicense(licenseKey, machineId) {
    if (!this.validateLicenseFormat(licenseKey)) {
      return { valid: false, error: 'Invalid license format' };
    }

    try {
      // Decode license key
      const parts = licenseKey.split('-');
      const encodedData = parts.slice(0, 4).join('');
      
      // Verify checksum (last part)
      const checksum = parts[4];
      const calculatedChecksum = this.calculateChecksum(encodedData + machineId);
      
      if (checksum !== calculatedChecksum) {
        return { valid: false, error: 'Invalid license key' };
      }

      // Decode expiry date (embedded in first 8 chars)
      const expiryTimestamp = parseInt(encodedData.substring(0, 8), 36);
      const expiryDate = new Date(expiryTimestamp * 1000);
      const now = new Date();

      if (expiryDate < now) {
        return { valid: false, error: 'License expired', expiryDate };
      }

      return { 
        valid: true, 
        expiryDate,
        daysRemaining: Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24))
      };
    } catch (error) {
      return { valid: false, error: 'Invalid license key' };
    }
  }

  /**
   * Calculate checksum for license validation
   */
  calculateChecksum(data) {
    const hash = crypto.createHmac('sha256', this.secretKey)
      .update(data)
      .digest('hex');
    return hash.substring(0, 4).toUpperCase();
  }

  /**
   * Save license to file (encrypted)
   */
  saveLicense(licenseKey) {
    try {
      const machineId = this.getMachineId();
      const verification = this.verifyLicense(licenseKey, machineId);

      if (!verification.valid) {
        return { success: false, error: verification.error };
      }

      const licenseData = {
        key: licenseKey,
        machineId,
        activatedAt: new Date().toISOString(),
        expiryDate: verification.expiryDate.toISOString()
      };

      // Encrypt and save
      const encrypted = this.encrypt(JSON.stringify(licenseData));
      fs.writeFileSync(this.licenseFile, encrypted, 'utf8');

      return { 
        success: true, 
        expiryDate: verification.expiryDate,
        daysRemaining: verification.daysRemaining
      };
    } catch (error) {
      return { success: false, error: error.message };
    }
  }

  /**
   * Load and verify saved license
   */
  loadLicense() {
    try {
      if (!fs.existsSync(this.licenseFile)) {
        return { valid: false, error: 'No license found' };
      }

      const encrypted = fs.readFileSync(this.licenseFile, 'utf8');
      const decrypted = this.decrypt(encrypted);
      const licenseData = JSON.parse(decrypted);

      // Verify machine ID matches
      const currentMachineId = this.getMachineId();
      if (licenseData.machineId !== currentMachineId) {
        return { valid: false, error: 'License is for different machine' };
      }

      // Verify license key
      const verification = this.verifyLicense(licenseData.key, currentMachineId);
      
      if (!verification.valid) {
        return verification;
      }

      return {
        valid: true,
        licenseKey: licenseData.key,
        activatedAt: licenseData.activatedAt,
        expiryDate: verification.expiryDate,
        daysRemaining: verification.daysRemaining
      };
    } catch (error) {
      return { valid: false, error: 'Failed to load license' };
    }
  }

  /**
   * Encrypt data
   */
  encrypt(text) {
    const algorithm = 'aes-256-cbc';
    const key = crypto.scryptSync(this.secretKey, 'salt', 32);
    const iv = crypto.randomBytes(16);
    
    const cipher = crypto.createCipheriv(algorithm, key, iv);
    let encrypted = cipher.update(text, 'utf8', 'hex');
    encrypted += cipher.final('hex');
    
    return iv.toString('hex') + ':' + encrypted;
  }

  /**
   * Decrypt data
   */
  decrypt(text) {
    const algorithm = 'aes-256-cbc';
    const key = crypto.scryptSync(this.secretKey, 'salt', 32);
    
    const parts = text.split(':');
    const iv = Buffer.from(parts[0], 'hex');
    const encrypted = parts[1];
    
    const decipher = crypto.createDecipheriv(algorithm, key, iv);
    let decrypted = decipher.update(encrypted, 'hex', 'utf8');
    decrypted += decipher.final('utf8');
    
    return decrypted;
  }

  /**
   * Remove license (deactivate)
   */
  removeLicense() {
    try {
      if (fs.existsSync(this.licenseFile)) {
        fs.unlinkSync(this.licenseFile);
      }
      return { success: true };
    } catch (error) {
      return { success: false, error: error.message };
    }
  }

  /**
   * Generate license key (for license server/admin tool)
   * This should NOT be in the client app in production!
   * Shown here for demonstration only.
   */
  static generateLicenseKey(machineId, expiryDate) {
    const secretKey = 'XNOLL_SECRET_KEY_2024';
    
    // Convert expiry date to timestamp (in seconds)
    const timestamp = Math.floor(expiryDate.getTime() / 1000);
    
    // Encode timestamp in base36 (8 chars)
    const encodedTimestamp = timestamp.toString(36).padStart(8, '0').toUpperCase();
    
    // Generate random padding (8 chars)
    const padding = crypto.randomBytes(4).toString('hex').toUpperCase();
    
    const encodedData = encodedTimestamp + padding;
    
    // Calculate checksum
    const hash = crypto.createHmac('sha256', secretKey)
      .update(encodedData + machineId)
      .digest('hex');
    const checksum = hash.substring(0, 4).toUpperCase();
    
    // Format as XXXX-XXXX-XXXX-XXXX-XXXX
    const licenseKey = encodedData.match(/.{1,4}/g).join('-') + '-' + checksum;
    
    return licenseKey;
  }
}

module.exports = new LicenseService();

===============================
FILE: electron/services/errorReport.service.js
===============================


===============================
FILE: electron/services/customField.service.js
===============================


===============================
FILE: electron/services/settings.service.js
===============================
// electron/services/settings.service.js
const path = require('path');
const Database = require('better-sqlite3');
const path = require('path');
const { app } = require('electron');

const isDev = process.env.NODE_ENV === 'development';

const dbPath = isDev
  ? path.join(__dirname, '../database/sqlite.db')
  : path.join(app.getPath('userData'), 'xnoll-offline.sqlite');

  const db = new Database(dbPath);

class SettingsService {
  /**
   * Get all settings
   */
  getSettings() {
    return new Promise((resolve, reject) => {
      db.get('SELECT * FROM settings WHERE id = 1', (err, row) => {
        if (err) return reject(err);
        resolve(row || {});
      });
    });
  }

  /**
   * Update settings
   */
  updateSettings(settings) {
    return new Promise((resolve, reject) => {
      const fields = [];
      const values = [];

      // Build dynamic SQL based on provided fields
      Object.keys(settings).forEach(key => {
        if (key !== 'id' && key !== 'created_at') {
          fields.push(`${key} = ?`);
          values.push(settings[key]);
        }
      });

      fields.push('updated_at = CURRENT_TIMESTAMP');
      values.push(1); // id

      const sql = `UPDATE settings SET ${fields.join(', ')} WHERE id = ?`;

      db.run(sql, values, function(err) {
        if (err) return reject(err);
        resolve({ success: true, changes: this.changes });
      });
    });
  }

  /**
   * Get specific setting by key
   */
  getSetting(key) {
    return new Promise((resolve, reject) => {
      db.get(`SELECT ${key} FROM settings WHERE id = 1`, (err, row) => {
        if (err) return reject(err);
        resolve(row ? row[key] : null);
      });
    });
  }

  /**
   * Update specific setting
   */
  updateSetting(key, value) {
    return new Promise((resolve, reject) => {
      const sql = `UPDATE settings SET ${key} = ?, updated_at = CURRENT_TIMESTAMP WHERE id = 1`;
      
      db.run(sql, [value], function(err) {
        if (err) return reject(err);
        resolve({ success: true, changes: this.changes });
      });
    });
  }
}

module.exports = new SettingsService();

===============================
FILE: electron/services/backup.service.js
===============================


===============================
FILE: electron/services/search.service.js
===============================
// electron/services/search.service.js
const path = require('path');
const Database = require('better-sqlite3');
const { app } = require('electron');

const isDev = process.env.NODE_ENV === 'development';

const dbPath = isDev
  ? path.join(__dirname, '../database/sqlite.db')
  : path.join(app.getPath('userData'), 'xnoll-offline.sqlite');

  const db = new Database(dbPath);

class SearchService {
  /**
   * Global search across all modules
   */
  globalSearch(query) {
    return new Promise((resolve, reject) => {
      const searchTerm = `%${query}%`;
      const results = {
        customers: [],
        products: [],
        bookings: [],
        invoices: [],
        notes: []
      };

      let completed = 0;
      const modules = 5;

      const checkComplete = () => {
        completed++;
        if (completed === modules) {
          resolve(results);
        }
      };

      // Search customers
      db.all(
        `SELECT id, name, phone, email, 'customer' as type 
         FROM customers 
         WHERE name LIKE ? OR phone LIKE ? OR email LIKE ?
         LIMIT 10`,
        [searchTerm, searchTerm, searchTerm],
        (err, rows) => {
          if (!err) results.customers = rows;
          checkComplete();
        }
      );

      // Search products
      db.all(
        `SELECT id, sku, name, price, 'product' as type 
         FROM products 
         WHERE name LIKE ? OR sku LIKE ? OR description LIKE ?
         LIMIT 10`,
        [searchTerm, searchTerm, searchTerm],
        (err, rows) => {
          if (!err) results.products = rows;
          checkComplete();
        }
      );

      // Search bookings
      db.all(
        `SELECT b.id, b.service_name, b.booking_date, b.status, 
                c.name as customer_name, 'booking' as type
         FROM bookings b
         LEFT JOIN customers c ON b.customer_id = c.id
         WHERE b.service_name LIKE ? OR c.name LIKE ?
         LIMIT 10`,
        [searchTerm, searchTerm],
        (err, rows) => {
          if (!err) results.bookings = rows;
          checkComplete();
        }
      );

      // Search invoices
      db.all(
        `SELECT i.id, i.invoice_number, i.total, i.invoice_date, i.status,
                c.name as customer_name, 'invoice' as type
         FROM invoices i
         LEFT JOIN customers c ON i.customer_id = c.id
         WHERE i.invoice_number LIKE ? OR c.name LIKE ?
         LIMIT 10`,
        [searchTerm, searchTerm],
        (err, rows) => {
          if (!err) results.invoices = rows;
          checkComplete();
        }
      );

      // Search notes
      db.all(
        `SELECT id, title, content, tags, 'note' as type 
         FROM notes 
         WHERE title LIKE ? OR content LIKE ? OR tags LIKE ?
         LIMIT 10`,
        [searchTerm, searchTerm, searchTerm],
        (err, rows) => {
          if (!err) results.notes = rows;
          checkComplete();
        }
      );
    });
  }

  /**
   * Search within specific module
   */
  moduleSearch(module, query) {
    return new Promise((resolve, reject) => {
      const searchTerm = `%${query}%`;

      switch (module) {
        case 'customers':
          db.all(
            `SELECT * FROM customers 
             WHERE name LIKE ? OR phone LIKE ? OR email LIKE ?
             ORDER BY name`,
            [searchTerm, searchTerm, searchTerm],
            (err, rows) => {
              if (err) return reject(err);
              resolve(rows);
            }
          );
          break;

        case 'products':
          db.all(
            `SELECT * FROM products 
             WHERE name LIKE ? OR sku LIKE ? OR description LIKE ?
             ORDER BY name`,
            [searchTerm, searchTerm, searchTerm],
            (err, rows) => {
              if (err) return reject(err);
              resolve(rows);
            }
          );
          break;

        case 'bookings':
          db.all(
            `SELECT b.*, c.name as customer_name, p.name as product_name
             FROM bookings b
             LEFT JOIN customers c ON b.customer_id = c.id
             LEFT JOIN products p ON b.product_id = p.id
             WHERE b.service_name LIKE ? OR c.name LIKE ?
             ORDER BY b.booking_date DESC`,
            [searchTerm, searchTerm],
            (err, rows) => {
              if (err) return reject(err);
              resolve(rows);
            }
          );
          break;

        case 'invoices':
          db.all(
            `SELECT i.*, c.name as customer_name
             FROM invoices i
             LEFT JOIN customers c ON i.customer_id = c.id
             WHERE i.invoice_number LIKE ? OR c.name LIKE ?
             ORDER BY i.invoice_date DESC`,
            [searchTerm, searchTerm],
            (err, rows) => {
              if (err) return reject(err);
              resolve(rows);
            }
          );
          break;

        case 'notes':
          db.all(
            `SELECT * FROM notes 
             WHERE title LIKE ? OR content LIKE ? OR tags LIKE ?
             ORDER BY created_at DESC`,
            [searchTerm, searchTerm, searchTerm],
            (err, rows) => {
              if (err) return reject(err);
              resolve(rows);
            }
          );
          break;

        default:
          resolve([]);
      }
    });
  }
}

module.exports = new SearchService();

===============================
FILE: electron/services/sku.service.js
===============================


===============================
FILE: electron/services/booking.service.js
===============================


===============================
FILE: electron/services/customer.service.js
===============================


===============================
FILE: electron/services/stock.service.js
===============================


===============================
FILE: electron/services/reports.service.js
===============================


===============================
FILE: electron/services/billing.service.js
===============================


===============================
FILE: electron/database/clear.js
===============================
// electron/database/clear.js
const path = require("path");
const fs = require("fs");
const Database = require("better-sqlite3");

const dbPath = path.join(__dirname, "sqlite.db");
if (!fs.existsSync(dbPath)) {
  console.error("sqlite.db not found at", dbPath);
  process.exit(1);
}

const db = new Database(dbPath);

// WARNING: This permanently deletes rows. Back up your DB if needed.
console.log("Clearing seeded tables (customers, products, bookings, invoices, notes, custom_field_values, custom_fields).");

const deleteOrder = [
  "custom_field_values",
  "invoices",
  "bookings",
  "products",
  "customers",
  "notes",
  "custom_fields"
];

db.exec("PRAGMA foreign_keys = OFF;"); // temporarily disable foreign keys while truncating

for (const table of deleteOrder) {
  try {
    db.exec(`DELETE FROM ${table};`);
    db.exec(`VACUUM;`);
    console.log(`Cleared ${table}`);
  } catch (err) {
    console.error(`Failed to clear ${table}:`, err.message);
  }
}

db.exec("PRAGMA foreign_keys = ON;");
console.log("Done.");


===============================
FILE: electron/database/db.js
===============================
// electron/database/db.js
const path = require("path");
const fs = require("fs");
const Database = require("better-sqlite3");
const { app } = require("electron");

const isDev = process.env.NODE_ENV === "development";

const dbPath = isDev
  ? path.join(__dirname, "sqlite.db")
  : path.join(app.getPath("userData"), "xnoll-offline.sqlite");

const db = new Database(dbPath);

// Enable WAL mode for better performance
db.pragma("journal_mode = WAL");
db.pragma("synchronous = NORMAL");
db.pragma("cache_size = 1000000");
db.pragma("foreign_keys = ON");
db.pragma("temp_store = memory");

// --- migrations runner (idempotent) ---
function runMigrations() {
  const migrationsDir = path.join(__dirname, "migrations");
  if (!fs.existsSync(migrationsDir)) return;

  // Create migrations table
  db.exec(`CREATE TABLE IF NOT EXISTS migrations (name TEXT PRIMARY KEY);`);

  // Prepare statements
  const getMigration = db.prepare("SELECT name FROM migrations WHERE name = ?");
  const insertMigration = db.prepare(
    "INSERT INTO migrations (name) VALUES (?)"
  );

  const files = fs
    .readdirSync(migrationsDir)
    .filter((f) => f.endsWith(".sql"))
    .sort();

  files.forEach((file) => {
    try {
      // Check if migration already applied
      const row = getMigration.get(file);
      if (row) return; // already applied

      // Apply migration
      const sql = fs.readFileSync(path.join(migrationsDir, file), "utf8");
      db.exec(sql);

      // Record migration
      insertMigration.run(file);
      console.log("Migration applied:", file);
    } catch (error) {
      console.error("Migration failed", file, error);
      throw error;
    }
  });
}

// Initialize database schema
function initDatabase() {
  // Run migrations to create/update schema
  runMigrations();
}

// Initialize database
initDatabase();

// --- Prepared statements ---
const statements = {
  // Settings
  getSettings: db.prepare("SELECT * FROM settings WHERE id = 1"),
  updateSettings: db.prepare(`
    UPDATE settings SET
      company_name = ?, currency = ?, auto_generate_sku = ?, sku_prefix = ?,
      language = ?,
      updated_at = CURRENT_TIMESTAMP
    WHERE id = 1
  `),

  // Customers
  insertCustomer: db.prepare(`
    INSERT INTO customers (name, phone, email, address, created_at, updated_at)
    VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
  `),
  updateCustomer: db.prepare(`
    UPDATE customers SET name = ?, phone = ?, email = ?, address = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `),
  deleteCustomer: db.prepare("DELETE FROM customers WHERE id = ?"),
  getAllCustomers: db.prepare("SELECT * FROM customers ORDER BY id DESC"),

  // Products
  insertProduct: db.prepare(`
    INSERT INTO products (sku, name, description, unit, price, discount, category, created_at, updated_at)
    VALUES (?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
  `),
  updateProduct: db.prepare(`
    UPDATE products SET sku = ?, name = ?, description = ?, unit = ?, price = ?, discount = ?, category = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `),
  deleteProduct: db.prepare("DELETE FROM products WHERE id = ?"),
  getAllProducts: db.prepare("SELECT * FROM products ORDER BY id DESC"),

  // Bookings
  insertBooking: db.prepare(`
    INSERT INTO bookings (customer_id, service_name, booking_date, status, discount, notes, created_at, updated_at)
    VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
  `),
  updateBooking: db.prepare(`
    UPDATE bookings SET customer_id = ?, service_name = ?, booking_date = ?, status = ?, discount = ?, notes = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `),
  deleteBooking: db.prepare("DELETE FROM bookings WHERE id = ?"),
  getAllBookings: db.prepare(`
    SELECT b.*, c.name as customer_name
    FROM bookings b
    LEFT JOIN customers c ON b.customer_id = c.id
    ORDER BY b.id DESC
  `),
  getBookingsInRange: db.prepare(`
    SELECT b.*, c.name as customer_name
    FROM bookings b
    LEFT JOIN customers c ON b.customer_id = c.id
    WHERE b.booking_date >= ? AND b.booking_date <= ?
    ORDER BY b.booking_date
  `),

  // Booking Items
  // Booking Items
  insertBookingItem: db.prepare(`
    INSERT INTO booking_items (booking_id, product_id, qty, unit_price, line_total)
    VALUES (?, ?, ?, ?, ?)
  `),
  deleteBookingItems: db.prepare(
    "DELETE FROM booking_items WHERE booking_id = ?"
  ),
  getBookingItems: db.prepare(
    "SELECT * FROM booking_items WHERE booking_id = ?"
  ),

  // Invoices
  insertInvoice: db.prepare(`
    INSERT INTO invoices (invoice_number, customer_id, booking_id, total, discount, invoice_date, due_date, status, notes, created_at, updated_at)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
  `),
  updateInvoice: db.prepare(`
    UPDATE invoices SET invoice_number = ?, customer_id = ?, booking_id = ?, total = ?, discount = ?, invoice_date = ?, due_date = ?, status = ?, notes = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `),
  deleteInvoice: db.prepare("DELETE FROM invoices WHERE id = ?"),
  getAllInvoices: db.prepare(`
    SELECT i.*, c.name as customer_name, b.service_name
    FROM invoices i
    LEFT JOIN customers c ON i.customer_id = c.id
    LEFT JOIN bookings b ON i.booking_id = b.id
    ORDER BY i.id DESC
  `),

  // Invoice Items
  insertInvoiceItem: db.prepare(`
    INSERT INTO invoice_items (invoice_id, product_id, description, qty, unit_price, line_total)
    VALUES (?, ?, ?, ?, ?, ?)
  `),
  deleteInvoiceItems: db.prepare(
    "DELETE FROM invoice_items WHERE invoice_id = ?"
  ),
  getInvoiceItems: db.prepare(
    "SELECT * FROM invoice_items WHERE invoice_id = ?"
  ),

  // Notes
  insertNote: db.prepare(`
    INSERT INTO notes (title, content, tags, color, is_pinned, created_at, updated_at)
    VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
  `),
  updateNote: db.prepare(`
    UPDATE notes SET title = ?, content = ?, tags = ?, color = ?, is_pinned = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `),
  deleteNote: db.prepare("DELETE FROM notes WHERE id = ?"),
  getAllNotes: db.prepare(
    "SELECT * FROM notes ORDER BY is_pinned DESC, created_at DESC"
  ),

  // Custom Fields
  insertCustomField: db.prepare(`
    INSERT INTO custom_fields (module, field_name, field_label, field_type, is_required, display_in_grid, display_in_filter, is_sortable, is_searchable, options, default_value, field_order, created_at, updated_at)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
  `),
  updateCustomField: db.prepare(`
    UPDATE custom_fields SET module = ?, field_name = ?, field_label = ?, field_type = ?, is_required = ?, display_in_grid = ?, display_in_filter = ?, is_sortable = ?, is_searchable = ?, options = ?, default_value = ?, field_order = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `),
  deleteCustomField: db.prepare("DELETE FROM custom_fields WHERE id = ?"),
  getAllCustomFields: db.prepare(`
    SELECT
      id,
      field_name as name,
      field_label as label,
      module,
      field_type as type,
      is_required as required,
      display_in_grid,
      display_in_filter,
      is_sortable as sortable,
      is_searchable as searchable,
      options,
      default_value,
      field_order,
      created_at,
      updated_at
    FROM custom_fields ORDER BY field_order, id
  `),
  getCustomFieldValues: db.prepare(
    "SELECT value FROM custom_field_values WHERE custom_field_id = ? AND record_id = ?"
  ),
  saveCustomFieldValue: db.prepare(`
    INSERT OR REPLACE INTO custom_field_values (custom_field_id, record_id, value, created_at, updated_at)
    VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
  `),

  // Company Profile
  getCompanyProfile: db.prepare("SELECT * FROM company WHERE id = 1"),
  updateCompanyProfile: db.prepare(`
    INSERT OR REPLACE INTO company (
      id, name, logo, address, city, state, postal_code, country,
      phone, email, website, tax_id, currency, timezone, date_format, time_format
    ) VALUES (
      1, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?
    )
  `),

  // SKU validation
  checkSkuExists: db.prepare(
    "SELECT id FROM products WHERE sku = ? AND id != ?"
  ),
};

// Helper function for custom fields
function getAllCustomFields(module) {
  const allFields = statements.getAllCustomFields.all();
  return module ? allFields.filter((f) => f.module === module) : allFields;
}

// --- Helper functions ---
function getCustomersWithCustomFields() {
  const customers = statements.getAllCustomers.all();
  const customFields = getAllCustomFields("customers");

  if (customFields.length === 0) return customers;

  for (const customer of customers) {
    customer.custom_fields = {};
    for (const field of customFields) {
      const row = statements.getCustomFieldValues.get(field.id, customer.id);
      if (row) customer.custom_fields[field.name] = row.value;
    }
  }
  return customers;
}

function getProductsWithCustomFields() {
  const products = statements.getAllProducts.all();
  const customFields = getAllCustomFields("products");

  if (customFields.length === 0) return products;

  for (const product of products) {
    product.custom_fields = {};
    for (const field of customFields) {
      const row = statements.getCustomFieldValues.get(field.id, product.id);
      if (row) product.custom_fields[field.name] = row.value;
    }
  }
  return products;
}

function getBookingsWithCustomFields() {
  const bookings = statements.getAllBookings.all();
  const customFields = getAllCustomFields("bookings");

  for (const booking of bookings) {
    // ð¥ FIX: always attach items
    booking.items = statements.getBookingItems.all(booking.id);

    booking.custom_fields = {};
    for (const field of customFields) {
      const row = statements.getCustomFieldValues.get(field.id, booking.id);
      if (row) booking.custom_fields[field.name] = row.value;
    }
  }
  return bookings;
}

function getBookingsById(id) {
  const booking = db
    .prepare(
      `
    SELECT b.*, c.name as customer_name
    FROM bookings b
    LEFT JOIN customers c ON b.customer_id = c.id
    WHERE b.id = ?
  `
    )
    .get(id);

  if (booking) {
    booking.items = statements.getBookingItems.all(id);
  }
  return booking || null;
}

function getInvoiceById(id) {
  const invoice = db
    .prepare(
      `
    SELECT i.*, c.name as customer_name, b.service_name
    FROM invoices i
    LEFT JOIN customers c ON i.customer_id = c.id
    LEFT JOIN bookings b ON i.booking_id = b.id
    WHERE i.id = ?
  `
    )
    .get(id);

  if (invoice) {
    invoice.items = statements.getInvoiceItems.all(id);
  }
  return invoice || null;
}

function getInvoicesWithItems() {
  const invoices = statements.getAllInvoices.all();
  const products = statements.getAllProducts.all();
  const productMap = {};
  products.forEach(p => productMap[p.id] = p);

  for (const invoice of invoices) {
    invoice.items = statements.getInvoiceItems.all(invoice.id);

    // Enrich items with product name if available
    if (Array.isArray(invoice.items)) {
      invoice.items = invoice.items.map(item => ({
        ...item,
        product_name: productMap[item.product_id]?.name || item.description || "Unknown Item"
      }));
    } else {
      invoice.items = [];
    }
  }

  return invoices;
}

function checkSkuExists(sku, excludeId = null) {
  const result = statements.checkSkuExists.get(sku, excludeId || 0);
  return !!result;
}

/**
 * â Create booking with items (ATOMIC)
 * - Inserts booking ONCE
 * - Inserts multiple booking_items
 * - Uses transaction (ERP-safe)
 */
function createBookingWithItems(data) {
  return db.transaction(() => {
    // 1ï¸â£ Create booking header
    const bookingInfo = statements.insertBooking.run(
      data.customer_id || null,
      data.service_name || "",
      data.booking_date,
      data.status || "pending",
      data.discount || 0,
      data.notes || ""
    );

    const bookingId = bookingInfo.lastInsertRowid;

    // 2ï¸â£ Validate items
    if (!Array.isArray(data.items) || data.items.length === 0) {
      throw new Error("Booking must contain at least one item");
    }

    // 3ï¸â£ Insert booking items
    for (const item of data.items) {
      if (!item.product_id) {
        throw new Error("Product ID is required in booking item");
      }

      const qty = Number(item.qty || 1);
      const unitPrice = Number(item.unit_price || 0);
      const lineTotal =
        item.line_total != null ? Number(item.line_total) : qty * unitPrice;

      statements.insertBookingItem.run(
        bookingId,
        item.product_id,
        qty,
        unitPrice,
        lineTotal
      );
    }

    return { id: bookingId };
  })();
}

/**
 * â Update booking with items (ATOMIC)
 * - Updates booking header
 * - Deletes old items
 * - Inserts new items
 */
function updateBookingWithItems(data) {
  return db.transaction(() => {
    if (!data.id) {
      throw new Error("Booking ID is required for update");
    }

    // 1ï¸â£ Update booking header
    statements.updateBooking.run(
      data.customer_id || null,
      data.service_name || "",
      data.booking_date,
      data.status || "pending",
      data.discount || 0,
      data.notes || "",
      data.id
    );

    // 2ï¸â£ Replace items
    statements.deleteBookingItems.run(data.id);

    if (!Array.isArray(data.items) || data.items.length === 0) {
      throw new Error("Booking must contain at least one item");
    }

    for (const item of data.items) {
      const qty = Number(item.qty || 1);
      const unitPrice = Number(item.unit_price || 0);
      const lineTotal =
        item.line_total != null ? Number(item.line_total) : qty * unitPrice;

      statements.insertBookingItem.run(
        data.id,
        item.product_id,
        qty,
        unitPrice,
        lineTotal
      );
    }

    return { id: data.id };
  })();
}

/**
 * â Delete booking with items
 */
function deleteBookingWithItems(id) {
  return db.transaction(() => {
    statements.deleteBookingItems.run(id);
    statements.deleteBooking.run(id);
    return true;
  })();
}

/**
 * Create invoice with items (ATOMIC)
 * payload: { invoice: { invoice_number, customer_id, booking_id, total, discount, invoice_date, due_date, status, notes }, items: [ { product_id, description, qty, unit_price, line_total } ] }
 */
function createInvoiceWithItems(data) {
  return db.transaction(() => {
    const inv = data.invoice || data; // allow old payload shape
    const info = statements.insertInvoice.run(
      inv.invoice_number || null,
      inv.customer_id || null,
      inv.booking_id || null,
      inv.total || 0,
      inv.discount || 0,
      inv.invoice_date,
      inv.due_date || null,
      inv.status || "unpaid",
      inv.notes || ""
    );
    const invoiceId = info.lastInsertRowid;

    if (Array.isArray(data.items)) {
      for (const it of data.items) {
        const qty = Number(it.qty || 1);
        const unitPrice = Number(it.unit_price || 0);
        const lineTotal =
          it.line_total != null ? Number(it.line_total) : qty * unitPrice;
        statements.insertInvoiceItem.run(
          invoiceId,
          it.product_id || null,
          it.description || "",
          qty,
          unitPrice,
          lineTotal
        );
      }
    }

    return { id: invoiceId };
  })();
}

// --- Public API ---
module.exports = {
  // Settings
  getSettings: () => statements.getSettings.get(),
  updateSettings: (data) =>
    statements.updateSettings.run(
      data.company_name,
      data.currency,
      data.auto_generate_sku,
      data.sku_prefix,
      data.language
    ),

  // Customers
  insertCustomer: (data) => {
    const info = statements.insertCustomer.run(
      data.name,
      data.phone,
      data.email,
      data.address || ""
    );
    return { id: info.lastInsertRowid };
  },
  updateCustomer: (data) =>
    statements.updateCustomer.run(
      data.name,
      data.phone,
      data.email,
      data.address || "",
      data.id
    ),
  deleteCustomer: (id) => statements.deleteCustomer.run(id),
  getCustomersWithCustomFields,

  // Products
  insertProduct: (data) => {
    const info = statements.insertProduct.run(
      data.sku,
      data.name,
      data.description || "",
      data.unit || "",
      data.price || 0,
      data.discount || 0,
      data.category || ""
    );
    return { id: info.lastInsertRowid };
  },
  updateProduct: (data) =>
    statements.updateProduct.run(
      data.sku,
      data.name,
      data.description || "",
      data.unit || "",
      data.price || 0,
      data.discount || 0,
      data.category || "",
      data.id
    ),
  deleteProduct: (id) => statements.deleteProduct.run(id),
  getProductsWithCustomFields,
  createBookingWithItems,
  updateBookingWithItems,
  deleteBookingWithItems,
  createInvoiceWithItems,
  // Bookings
  insertBooking: (data) => {
    const info = statements.insertBooking.run(
      data.customer_id,
      data.service_name || "",
      data.booking_date,
      data.status || "pending",
      data.discount || 0,
      data.notes || ""
    );
    return { id: info.lastInsertRowid };
  },
  updateBooking: (data) =>
    statements.updateBooking.run(
      data.customer_id,
      data.service_name || "",
      data.booking_date,
      data.status || "pending",
      data.discount || 0,
      data.notes || "",
      data.id
    ),
  deleteBooking: (id) => {
    db.transaction(() => {
      statements.deleteBookingItems.run(id);
      statements.deleteBooking.run(id);
    })();
  },
  getBookingsWithCustomFields,
  listBookingsInRange: (start, end) =>
    statements.getBookingsInRange.all(start, end),
  getBookingsById,
  insertBookingItem: (data) =>
    statements.insertBookingItem.run(
      data.booking_id,
      data.product_id,
      data.unit_price,
      data.line_total
    ),
  getBookingItems: (bookingId) => statements.getBookingItems.all(bookingId),

  // Invoices
  insertInvoice: (data) => {
    const info = statements.insertInvoice.run(
      data.invoice_number,
      data.customer_id,
      data.booking_id || null,
      data.total || 0,
      data.discount || 0,
      data.invoice_date,
      data.due_date || null,
      data.status || "unpaid",
      data.notes || ""
    );
    return { id: info.lastInsertRowid };
  },
  updateInvoice: (data) =>
    statements.updateInvoice.run(
      data.invoice_number,
      data.customer_id,
      data.booking_id || null,
      data.total || 0,
      data.discount || 0,
      data.invoice_date,
      data.due_date || null,
      data.status || "unpaid",
      data.notes || "",
      data.id
    ),
  deleteInvoice: (id) => {
    db.transaction(() => {
      statements.deleteInvoiceItems.run(id);
      statements.deleteInvoice.run(id);
    })();
  },
  getAllInvoices: () => getInvoicesWithItems(),
  getInvoiceById,
  insertInvoiceItem: (data) =>
    statements.insertInvoiceItem.run(
      data.invoice_id,
      data.product_id || null,
      data.description,
      data.unit_price,
      data.line_total
    ),
  getInvoiceItems: (invoiceId) => statements.getInvoiceItems.all(invoiceId),

  // Notes
  insertNote: (data) => {
    const info = statements.insertNote.run(
      data.title,
      data.content || "",
      data.tags || "",
      data.color || "#ffffff",
      data.is_pinned || 0
    );
    return { id: info.lastInsertRowid };
  },
  updateNote: (data) =>
    statements.updateNote.run(
      data.title,
      data.content || "",
      data.tags || "",
      data.color || "#ffffff",
      data.is_pinned || 0,
      data.id
    ),
  deleteNote: (id) => statements.deleteNote.run(id),
  getAllNotes: () => statements.getAllNotes.all(),

  // Custom Fields
  insertCustomField: (data) => {
    const info = statements.insertCustomField.run(
      data.module,
      data.field_name,
      data.field_label,
      data.field_type,
      data.is_required || 0,
      data.display_in_grid || 0,
      data.display_in_filter || 0,
      data.is_sortable || 0,
      data.is_searchable || 0,
      data.options || "",
      data.default_value || "",
      data.field_order || 0
    );
    return { id: info.lastInsertRowid };
  },
  updateCustomField: (data) =>
    statements.updateCustomField.run(
      data.module,
      data.field_name,
      data.field_label,
      data.field_type,
      data.is_required || 0,
      data.display_in_grid || 0,
      data.display_in_filter || 0,
      data.is_sortable || 0,
      data.is_searchable || 0,
      data.options || "",
      data.default_value || "",
      data.field_order || 0,
      data.id
    ),
  deleteCustomField: (id) => statements.deleteCustomField.run(id),
  getAllCustomFields: (module) => {
    const all = statements.getAllCustomFields.all();
    return module ? all.filter((f) => f.module === module) : all;
  },
  getCustomFieldValues: (fieldId, recordId) =>
    statements.getCustomFieldValues.get(fieldId, recordId),
  saveCustomFieldValue: (data) =>
    statements.saveCustomFieldValue.run(
      data.custom_field_id,
      data.record_id,
      data.value
    ),

  // Company Profile
  getCompanyProfile: () => statements.getCompanyProfile.get(),
  updateCompanyProfile: (data) =>
    statements.updateCompanyProfile.run(
      data.name,
      data.logo || null,
      data.address || "",
      data.city || "",
      data.state || "",
      data.postal_code || "",
      data.country || "",
      data.phone || "",
      data.email || "",
      data.website || "",
      data.tax_id || "",
      data.currency || "INR",
      data.timezone || "Asia/Kolkata",
      data.date_format || "DD/MM/YYYY",
      data.time_format || "12h"
    ),

  // SKU validation
  checkSkuExists,

  // Close DB (optional)
  close: () => db.close(),
};


===============================
FILE: electron/database/migrations/001_init.sql
===============================
-- electron/database/migrations/001_init.sql

CREATE TABLE IF NOT EXISTS settings (
  id INTEGER PRIMARY KEY,
  company_name TEXT,
  currency TEXT DEFAULT 'INR',
  auto_generate_sku INTEGER DEFAULT 1,
  sku_prefix TEXT DEFAULT 'SKU',
  enable_reminders INTEGER DEFAULT 0,
  reminder_lead_minutes INTEGER DEFAULT 30,
  language TEXT DEFAULT 'en',
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

-- Insert default settings
INSERT OR IGNORE INTO settings (id, company_name, currency, auto_generate_sku, sku_prefix, enable_reminders, reminder_lead_minutes, language)
VALUES (1, 'My Company', 'INR', 1, 'SKU', 0, 30, 'en');

CREATE TABLE IF NOT EXISTS customers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  phone TEXT,
  email TEXT,
  address TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_customers_name ON customers(name);
CREATE INDEX idx_customers_phone ON customers(phone);
CREATE INDEX idx_customers_email ON customers(email);

CREATE TABLE IF NOT EXISTS products (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  sku TEXT UNIQUE,
  name TEXT NOT NULL,
  description TEXT,
  unit TEXT,
  price REAL DEFAULT 0,
  discount REAL DEFAULT 0,
  category TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_products_sku ON products(sku);
CREATE INDEX idx_products_name ON products(name);
CREATE INDEX idx_products_category ON products(category);

CREATE TABLE IF NOT EXISTS bookings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  customer_id INTEGER,
  service_name TEXT,
  booking_date TEXT NOT NULL,
  status TEXT DEFAULT 'pending',
  discount REAL DEFAULT 0,
  notes TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE SET NULL
);

CREATE INDEX idx_bookings_customer ON bookings(customer_id);
CREATE INDEX idx_bookings_date ON bookings(booking_date);
CREATE INDEX idx_bookings_status ON bookings(status);

CREATE TABLE IF NOT EXISTS booking_items (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  booking_id INTEGER NOT NULL,
  product_id INTEGER NOT NULL,
  qty REAL DEFAULT 1,
  unit_price REAL DEFAULT 0,
  line_total REAL DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL
);

CREATE INDEX idx_booking_items_booking ON booking_items(booking_id);
CREATE INDEX idx_booking_items_product ON booking_items(product_id);


CREATE TABLE IF NOT EXISTS invoices (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  invoice_number TEXT UNIQUE,
  customer_id INTEGER,
  booking_id INTEGER,
  total REAL DEFAULT 0,
  discount REAL DEFAULT 0,
  invoice_date TEXT NOT NULL,
  due_date TEXT,
  status TEXT DEFAULT 'unpaid',
  notes TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE SET NULL,
  FOREIGN KEY (booking_id) REFERENCES bookings(id) ON DELETE SET NULL
);

CREATE INDEX idx_invoices_customer ON invoices(customer_id);
CREATE INDEX idx_invoices_date ON invoices(invoice_date);
CREATE INDEX idx_invoices_status ON invoices(status);
CREATE INDEX idx_invoices_number ON invoices(invoice_number);

CREATE TABLE IF NOT EXISTS invoice_items (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  invoice_id INTEGER NOT NULL,
  product_id INTEGER,
  description TEXT,
  qty REAL DEFAULT 1,
  unit_price REAL DEFAULT 0,
  line_total REAL DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL
);

CREATE INDEX idx_invoice_items_invoice ON invoice_items(invoice_id);

===============================
FILE: electron/database/migrations/003_company_profile.sql
===============================
CREATE TABLE IF NOT EXISTS company (
  id INTEGER PRIMARY KEY CHECK (id = 1),
  name TEXT NOT NULL,
  logo TEXT,
  address TEXT,
  city TEXT,
  state TEXT,
  postal_code TEXT,
  country TEXT,
  phone TEXT,
  email TEXT,
  website TEXT,
  tax_id TEXT,
  currency TEXT DEFAULT 'INR',
  timezone TEXT DEFAULT 'Asia/Kolkata',
  date_format TEXT DEFAULT 'DD/MM/YYYY',
  time_format TEXT DEFAULT '12h',
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

INSERT OR IGNORE INTO company (id, name, currency) VALUES (1, 'My Company', 'INR');

===============================
FILE: electron/database/migrations/002_custom_fields.sql
===============================
CREATE TABLE IF NOT EXISTS custom_fields (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  module TEXT NOT NULL,
  field_name TEXT NOT NULL,
  field_label TEXT NOT NULL,
  field_type TEXT NOT NULL,
  is_required INTEGER DEFAULT 0,
  display_in_grid INTEGER DEFAULT 0,
  display_in_filter INTEGER DEFAULT 0,
  is_sortable INTEGER DEFAULT 0,
  is_searchable INTEGER DEFAULT 0,
  options TEXT,
  default_value TEXT,
  field_order INTEGER DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(module, field_name)
);

CREATE TABLE IF NOT EXISTS custom_field_values (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  custom_field_id INTEGER NOT NULL,
  record_id INTEGER NOT NULL,
  value TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (custom_field_id) REFERENCES custom_fields(id) ON DELETE CASCADE
);

CREATE INDEX idx_custom_field_values ON custom_field_values(custom_field_id, record_id);

===============================
FILE: electron/database/migrations/004_notes.sql
===============================
CREATE TABLE IF NOT EXISTS notes (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  content TEXT,
  tags TEXT,
  color TEXT DEFAULT '#ffffff',
  is_pinned INTEGER DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_notes_pinned ON notes(is_pinned);
CREATE INDEX idx_notes_created ON notes(created_at DESC);

===============================
FILE: electron/main.js
===============================
// electron/main.js
const { app, Menu, BrowserWindow, globalShortcut } = require('electron');
const { registerShortcuts } = require('./utils/shortcuts');
const { logError } = require('./utils/errorLogger');
const config = require('./config/env');
const path = require('path');
const isDev = process.env.NODE_ENV === 'development';

const createMainWindow = require('./windows/mainWindow');
const appMenu = require('./menu');
const licenseService = require('./services/license.service');

// Register all IPC handlers
require('./ipc/app.ipc');
require('./ipc/customer.ipc');
require('./ipc/product.ipc');
require('./ipc/booking.ipc');
require('./ipc/invoice.ipc');
require('./ipc/license.ipc');
require('./ipc/settings.ipc');
require('./ipc/search.ipc');
require('./ipc/backup.ipc');
require('./ipc/customFields.ipc');
require('./ipc/notes.ipc');
require('./ipc/reports.ipc');
require('./ipc/company.ipc');
require('./ipc/calendar.ipc');
require('./ipc/error.ipc');
require('./ipc/sku.ipc');
require('./ipc/print.ipc');
require('./ipc/seeder.ipc');

let mainWindow = null;

// Check license before allowing app to start
async function checkLicenseAndStart() {
  // In development, skip license check
  if (isDev) {
    console.log('Development mode: Skipping license check');
    startApp();
    return;
  }

  try {
    const licenseStatus = licenseService.loadLicense();
    
    if (!licenseStatus.valid) {
      console.log('License invalid:', licenseStatus.error);
      // App will show license activation screen
      startApp();
    } else {
      console.log('License valid. Days remaining:', licenseStatus.daysRemaining);
      
      // Warn if license expires soon (within 7 days)
      if (licenseStatus.daysRemaining <= 7) {
        console.log('WARNING: License expires soon!');
      }
      
      startApp();
    }
  } catch (error) {
    console.error('License check failed:', error);
    // Still start the app, let the UI handle the error
    startApp();
  }
}

function startApp() {
  Menu.setApplicationMenu(appMenu);
  mainWindow = createMainWindow(isDev);
  
  // Register global shortcuts
  registerGlobalShortcuts();
  
  // Handle app updates (future)
  // checkForUpdates();
}

function registerGlobalShortcuts() {
  // Global search (Ctrl+K or Cmd+K)
  globalShortcut.register('CommandOrControl+K', () => {
    if (mainWindow) {
      mainWindow.webContents.send('shortcut', 'globalSearch');
    }
  });
  
  // Quick new booking (Ctrl+N or Cmd+N)
  globalShortcut.register('CommandOrControl+N', () => {
    if (mainWindow) {
      mainWindow.webContents.send('shortcut', 'newBooking');
    }
  });
  
  // Show shortcuts help (Ctrl+/ or Cmd+/)
  globalShortcut.register('CommandOrControl+/', () => {
    if (mainWindow) {
      mainWindow.webContents.send('shortcut', 'showHelp');
    }
  });
  
  // Calendar view (Ctrl+2 or Cmd+2)
  globalShortcut.register('CommandOrControl+2', () => {
    if (mainWindow) {
      mainWindow.webContents.send('navigate', 'calendar');
    }
  });
  
  // Dashboard (Ctrl+1 or Cmd+1)
  globalShortcut.register('CommandOrControl+1', () => {
    if (mainWindow) {
      mainWindow.webContents.send('navigate', 'dashboard');
    }
  });
}

function createMainWindowIfNeeded() {
  if (BrowserWindow.getAllWindows().length === 0) {
    mainWindow = createMainWindow(isDev);
  }
}

// App lifecycle events
app.whenReady().then(checkLicenseAndStart);

app.on('window-all-closed', () => {
  // Unregister all shortcuts
  globalShortcut.unregisterAll();
  
  // On macOS, keep app running when windows are closed
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', () => {
  // On macOS, recreate window when dock icon is clicked
  if (process.platform === 'darwin') {
    createMainWindowIfNeeded();
  }
});

app.on('will-quit', () => {
  // Cleanup before quit
  globalShortcut.unregisterAll();
});

// Handle uncaught exceptions
process.on('uncaughtException', (error) => {
  console.error('Uncaught exception:', error);
  // Log to file
  // Optionally send to error reporting service
});

process.on('unhandledRejection', (reason, promise) => {
  console.error('Unhandled rejection at:', promise, 'reason:', reason);
  // Log to file
});

// Export for testing
module.exports = { startApp, checkLicenseAndStart };

===============================
FILE: shared/validators.js
===============================


===============================
FILE: shared/constants.js
===============================


===============================
FILE: src/store/app.store.js
===============================


===============================
FILE: src/hooks/useForm.js
===============================


===============================
FILE: src/hooks/useSync.js
===============================


===============================
FILE: src/hooks/useKeyboardShortcut.js
===============================
import { useEffect } from 'react';

/**
 * Hook to register keyboard shortcuts
 * @param {string} key - Key combination (e.g., 'Ctrl+S', 'Escape', 'Enter')
 * @param {function} callback - Function to execute when shortcut is pressed
 * @param {array} deps - Dependencies array
 */
export const useKeyboardShortcut = (key, callback, deps = []) => {
  useEffect(() => {
    const handleKeyDown = (e) => {
      // Handle modifier keys
      const isCtrlOrCmd = e.ctrlKey || e.metaKey;
      const isShift = e.shiftKey;
      const isAlt = e.altKey;

      if (key.includes('+')) {
        const parts = key.split('+').map(p => p.trim().toLowerCase());
        
        // Check for Ctrl/Cmd modifier
        if (parts.includes('ctrl') || parts.includes('cmd')) {
          if (!isCtrlOrCmd) return;
          parts.splice(parts.indexOf('ctrl') !== -1 ? parts.indexOf('ctrl') : parts.indexOf('cmd'), 1);
        }

        // Check for Shift modifier
        if (parts.includes('shift')) {
          if (!isShift) return;
          parts.splice(parts.indexOf('shift'), 1);
        }

        // Check for Alt modifier
        if (parts.includes('alt')) {
          if (!isAlt) return;
          parts.splice(parts.indexOf('alt'), 1);
        }

        // Check the actual key
        const actualKey = parts[0];
        if (e.key.toLowerCase() === actualKey.toLowerCase()) {
          e.preventDefault();
          callback(e);
        }
      } else {
        // Simple key without modifiers
        if (e.key.toLowerCase() === key.toLowerCase()) {
          callback(e);
        }
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [key, callback, ...deps]);
};

export default useKeyboardShortcut;

===============================
FILE: src/hooks/useLocalStorage.js
===============================


===============================
FILE: src/hooks/useDebounce.js
===============================
import { useState, useEffect } from 'react';

/**
 * Hook to debounce a value
 * @param {any} value - Value to debounce
 * @param {number} delay - Delay in milliseconds
 * @returns {any} Debounced value
 */
export const useDebounce = (value, delay = 500) => {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
};

export default useDebounce;

===============================
FILE: src/App.jsx
===============================
import React, { useState, useEffect } from "react";
import { I18nProvider } from "./i18n/i18nContext";
import LicenseActivation from "./pages/License/Activation";
import TopBar from "./components/layout/TopBar.jsx";
import Sidebar from "./components/layout/Sidebar.jsx";

import Dashboard from "./pages/Dashboard/index.jsx";
import Customers from "./pages/Customers/index.jsx";
import Products from "./pages/Products/index.jsx";
import Booking from "./pages/Booking/index.jsx";
import Invoices from "./pages/Invoices/index.jsx";
import Settings from "./pages/Settings/index.jsx";
import Reports from "./pages/Reports/index.jsx";
import Notes from "./pages/Notes/index.jsx";
import CalendarPage from "./pages/Calendar/index.jsx";

const AppContent = () => {
  const [activePage, setActivePage] = useState("dashboard");
  const env = import.meta.env.VITE_APP_ENV || "production";

  useEffect(() => {
    if (!window.xnoll) return;
    const cleanup = window.xnoll.onNavigate((page) => setActivePage(page));
    return cleanup; // Cleanup function
  }, []);

  const renderPage = () => {
    switch (activePage) {
      case "customers":
        return <Customers />;
      case "products":
        return <Products />;
      case "booking":
        return <Booking />;
      case "invoices":
        return <Invoices />;
      case "reports":
        return <Reports />;
      case "calendar":
        return <CalendarPage />;
      case "notes":
        return <Notes />;
      case "settings":
        return <Settings />;
      case "dashboard":
      default:
        return <Dashboard />;
    }
  };

  return (
    <div className="app-root">
      <TopBar env={env} onNavigate={setActivePage} />
      <div className="d-flex app-body">
        <Sidebar activePage={activePage} setActivePage={setActivePage} />
        <main className="app-main flex-grow-1 p-3">{renderPage()}</main>
      </div>
    </div>
  );
};

const App = () => {
  const [licenseValid, setLicenseValid] = useState(false);
  const [checking, setChecking] = useState(true);

  useEffect(() => {
    checkLicense();
  }, []);

  const checkLicense = async () => {
    // Skip license check for now - enable after full development
    console.log('License check disabled for development');
    setLicenseValid(true);
    setChecking(false);
    return;

    // Original license check code (commented out for now)
    /*
    const isDev = import.meta.env.MODE === 'development';
    
    if (isDev) {
      console.log('Development mode: Skipping license check');
      setLicenseValid(true);
      setChecking(false);
      return;
    }

    if (!window.xnoll) {
      console.error('Xnoll API not available');
      setLicenseValid(false);
      setChecking(false);
      return;
    }

    try {
      const result = await window.xnoll.licenseCheck();
      setLicenseValid(result.valid);
      setChecking(false);

      if (!result.valid) {
        console.log("License invalid:", result.error);
      } else {
        console.log("License valid. Days remaining:", result.daysRemaining);
      }
    } catch (error) {
      console.error('License check failed:', error);
      setLicenseValid(false);
      setChecking(false);
    }
    */
  };

  const handleLicenseActivated = () => {
    setLicenseValid(true);
  };

  if (checking) {
    return (
      <I18nProvider>
        <div className="min-vh-100 d-flex align-items-center justify-content-center">
          <div className="spinner-border text-primary" role="status">
            <span className="visually-hidden">Loading...</span>
          </div>
        </div>
      </I18nProvider>
    );
  }

  if (!licenseValid) {
    return (
      <I18nProvider>
        <LicenseActivation onActivated={handleLicenseActivated} />
      </I18nProvider>
    );
  }

  return (
    <I18nProvider>
      <AppContent />
    </I18nProvider>
  );
};

export default App;

===============================
FILE: src/styles/global.css
===============================
html, body, #root {
  height: 100%;
}

.app-root {
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.app-body {
  flex: 1;
  min-height: 0;
}

.sidebar {
  width: 230px;
  min-height: calc(100vh - 56px); /* navbar height */
}

.app-main {
  background-color: #f8fafc;
  overflow: auto;
}

/* Calendar Styles */
.calendar {
  background: white;
  border-radius: 8px;
}

.calendar-header {
  padding: 1rem;
  border-bottom: 1px solid #e9ecef;
  background: #f8fafc;
}

.calendar-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #495057;
}

/* Day View */
.calendar-day-view {
  padding: 1rem;
}

.calendar-day-grid {
  display: grid;
  grid-template-columns: 80px 1fr;
  gap: 1rem;
}

.calendar-hour-slot {
  display: grid;
  grid-template-columns: 80px 1fr;
  gap: 1rem;
  padding: 0.5rem 0;
  border-bottom: 1px solid #f1f3f4;
}

.calendar-hour-label {
  font-size: 0.875rem;
  color: #6c757d;
  text-align: right;
  padding-right: 1rem;
  padding-top: 0.25rem;
}

.calendar-hour-content {
  min-height: 60px;
  position: relative;
}

.calendar-booking-card {
  background: #007bff;
  color: white;
  padding: 0.5rem;
  border-radius: 4px;
  margin-bottom: 0.25rem;
  font-size: 0.875rem;
  cursor: pointer;
  transition: opacity 0.2s;
}

.calendar-booking-card:hover {
  opacity: 0.9;
}

.calendar-booking-card.confirmed {
  background: #28a745;
}

.calendar-booking-card.completed {
  background: #007bff;
}

.calendar-booking-card.cancelled {
  background: #dc3545;
}

.calendar-booking-card.pending {
  background: #ffc107;
  color: #212529;
}

.calendar-empty-slot {
  color: #6c757d;
  font-size: 0.875rem;
  padding: 0.5rem;
}

/* Week View */
.calendar-week-view {
  padding: 1rem;
}

.calendar-week-header {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  margin-bottom: 1px;
  background: #e9ecef;
  border-radius: 4px 4px 0 0;
  overflow: hidden;
}

.calendar-week-day-header {
  background: #f8fafc;
  padding: 0.75rem 0.5rem;
  text-align: center;
  border-right: 1px solid #e9ecef;
}

.calendar-week-day-header:last-child {
  border-right: none;
}

.calendar-week-day-name {
  font-size: 0.875rem;
  font-weight: 600;
  color: #495057;
  margin-bottom: 0.25rem;
}

.calendar-week-day-number {
  font-size: 1.25rem;
  font-weight: 700;
  color: #495057;
}

.calendar-week-day-number.today {
  color: #007bff;
  background: rgba(0, 123, 255, 0.1);
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.calendar-week-body {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: #e9ecef;
  border-radius: 0 0 4px 4px;
  overflow: hidden;
}

.calendar-week-day-column {
  background: white;
  min-height: 120px;
  padding: 0.5rem;
  cursor: pointer;
  transition: background-color 0.2s;
}

.calendar-week-day-column:hover {
  background: #f8fafc;
}

.calendar-week-booking {
  background: #007bff;
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 3px;
  margin-bottom: 0.25rem;
  font-size: 0.75rem;
  overflow: hidden;
}

.calendar-week-booking.confirmed {
  background: #28a745;
}

.calendar-week-booking.completed {
  background: #007bff;
}

.calendar-week-booking.cancelled {
  background: #dc3545;
}

.calendar-week-booking.pending {
  background: #ffc107;
  color: #212529;
}

.calendar-week-booking-time {
  font-weight: 600;
  margin-bottom: 0.125rem;
}

.calendar-week-booking-title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.2;
}

.calendar-week-more-bookings {
  color: #6c757d;
  font-size: 0.75rem;
  text-align: center;
  margin-top: 0.25rem;
}

.calendar-week-add-button {
  text-align: center;
  margin-top: 0.5rem;
}

/* Month View */
.calendar-month-view {
  padding: 1rem;
}

.calendar-month-header {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  margin-bottom: 1px;
  background: #e9ecef;
  border-radius: 4px 4px 0 0;
  overflow: hidden;
}

.calendar-month-day-name {
  background: #f8fafc;
  padding: 0.75rem 0.5rem;
  text-align: center;
  font-weight: 600;
  color: #495057;
  border-right: 1px solid #e9ecef;
}

.calendar-month-day-name:last-child {
  border-right: none;
}

.calendar-month-body {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: #e9ecef;
  border-radius: 0 0 4px 4px;
  overflow: hidden;
}

.calendar-month-day {
  background: white;
  min-height: 100px;
  padding: 0.5rem;
  cursor: pointer;
  transition: background-color 0.2s;
}

.calendar-month-day:hover {
  background: #f8fafc;
}

.calendar-month-day.other-month {
  background: #f8fafc;
  color: #adb5bd;
}

.calendar-month-day.today {
  background: rgba(0, 123, 255, 0.05);
}

.calendar-month-day.today .calendar-month-day-number {
  background: #007bff;
  color: white;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.calendar-month-day-number {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.calendar-month-day-bookings {
  flex: 1;
}

.calendar-month-booking-dot {
  background: #007bff;
  color: white;
  padding: 0.125rem 0.25rem;
  border-radius: 2px;
  margin-bottom: 0.125rem;
  font-size: 0.75rem;
  overflow: hidden;
}

.calendar-month-booking-dot.confirmed {
  background: #28a745;
}

.calendar-month-booking-dot.completed {
  background: #007bff;
}

.calendar-month-booking-dot.cancelled {
  background: #dc3545;
}

.calendar-month-booking-dot.pending {
  background: #ffc107;
  color: #212529;
}

.calendar-month-booking-title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.2;
}

.calendar-month-booking-time {
  font-size: 0.7rem;
  opacity: 0.8;
}

.calendar-month-more-bookings {
  color: #6c757d;
  font-size: 0.75rem;
  text-align: center;
  margin-top: 0.25rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .sidebar {
    width: 200px;
  }

  .calendar-week-header,
  .calendar-week-body,
  .calendar-month-header,
  .calendar-month-body {
    grid-template-columns: repeat(7, minmax(40px, 1fr));
  }

  .calendar-hour-label {
    font-size: 0.75rem;
  }
}


===============================
FILE: src/utils/format.js
===============================
// Currency formatting utilities
export const CURRENCY_SYMBOLS = {
  INR: 'â¹',
  USD: '$',
  EUR: 'â¬',
  GBP: 'Â£',
  JPY: 'Â¥',
  AUD: 'A$',
  CAD: 'C$',
};

export const formatCurrency = (amount, currency = 'INR') => {
  if (!amount && amount !== 0) return '';
  const symbol = CURRENCY_SYMBOLS[currency] || currency;
  return `${symbol}${Number(amount).toLocaleString()}`;
};

export const getCurrencySymbol = (currency = 'INR') => {
  return CURRENCY_SYMBOLS[currency] || currency;
};


===============================
FILE: src/utils/date.js
===============================


===============================
FILE: src/utils/validation.js
===============================


===============================
FILE: src/utils/constants.js
===============================


===============================
FILE: src/components/CustomField/FieldTypes.jsx
===============================


===============================
FILE: src/components/CustomField/Renderer.jsx
===============================


===============================
FILE: src/components/CustomField/CustomFieldRenderer.jsx
===============================
import React from 'react';

const CustomFieldRenderer = ({
  fields = [],
  values = {},         // controlled values object keyed by field.name
  onChange,            // function (fieldName, value)
  loading = false
}) => {

  // parse comma or newline separated options
  const parseOptions = (optionsString = '') => {
    return optionsString
      .split(/[\n,]/)
      .map(opt => opt.trim())
      .filter(Boolean);
  };

  // Handler invoked from inputs
  const handleFieldChange = (fieldName, value) => {
    if (typeof onChange === 'function') {
      onChange(fieldName, value);
    }
  };

  // read value from the controlled prop; only use default if undefined
  const getValue = (field) => {
    return values[field.name] !== undefined ? values[field.name] : (field.default_value ?? '');
  };

  if (!fields || fields.length === 0) return null;

  return (
    <div className="custom-fields-section">
      <h6 className="mb-3 text-muted small">Additional Information</h6>
      <div className="row g-3">
        {fields.map(field => (
          <div key={field.id} className="col-md-12">
            <label className="form-label">
              {field.label} {field.required === 1 && <span className="text-danger ms-1">*</span>}
            </label>

            {field.type === 'text' && (
              <input
                type="text"
                className="form-control"
                disabled={loading}
                required={field.required === 1}
                value={String(getValue(field))}
                onChange={(e) => handleFieldChange(field.name, e.target.value)}
              />
            )}

            {field.type === 'number' && (
              <input
                type="number"
                className="form-control"
                disabled={loading}
                required={field.required === 1}
                value={getValue(field) !== '' ? getValue(field) : ''}
                onChange={(e) => handleFieldChange(field.name, e.target.value)}
              />
            )}

            {field.type === 'date' && (
              <input
                type="date"
                className="form-control"
                disabled={loading}
                required={field.required === 1}
                value={String(getValue(field))}
                onChange={(e) => handleFieldChange(field.name, e.target.value)}
              />
            )}

            {field.type === 'select' && (
              <select
                className="form-select form-select-sm"
                disabled={loading}
                required={field.required === 1}
                value={String(getValue(field) ?? '')}
                onChange={(e) => handleFieldChange(field.name, e.target.value)}
                style={{ minHeight: '38px' }}
              >
                <option value="">Select {field.label.toLowerCase()}</option>
                {parseOptions(field.options).map((option, idx) => (
                  <option key={idx} value={option}>
                    {option}
                  </option>
                ))}
              </select>
            )}

            {field.type === 'file' && (
              <small className="text-muted">File upload not yet implemented</small>
            )}

            {/* fallback for unknown types */}
            {!['text','number','date','select','file'].includes(field.type) && (
              <input
                type="text"
                className="form-control"
                disabled={loading}
                required={field.required === 1}
                value={String(getValue(field))}
                onChange={(e) => handleFieldChange(field.name, e.target.value)}
              />
            )}
          </div>
        ))}
      </div>
    </div>
  );
};

export default CustomFieldRenderer;


===============================
FILE: src/components/CustomField/Builder.jsx
===============================


===============================
FILE: src/components/Calendar/WeekView.jsx
===============================
import React from 'react';
import dayjs from 'dayjs';
import Button from '../common/Button';

const WeekView = ({ bookings = [], current, onCreateBooking }) => {
  const weekStart = current.startOf('week');
  const weekDays = Array.from({ length: 7 }, (_, i) => weekStart.add(i, 'day'));

  const getBookingsForDay = (date) => {
    return bookings.filter(booking =>
      dayjs(booking.booking_date).isSame(date, 'day')
    );
  };

  const getStatusClass = (status) => {
    switch (status) {
      case 'confirmed': return 'bg-success';
      case 'completed': return 'bg-primary';
      case 'cancelled': return 'bg-danger';
      case 'pending':
      default: return 'bg-warning text-dark';
    }
  };

  return (
    <div className="calendar-week-view">
      <div className="calendar-week-header">
        {weekDays.map(day => (
          <div key={day.format('YYYY-MM-DD')} className="calendar-week-day-header">
            <div className="calendar-week-day-name">
              {day.format('ddd')}
            </div>
            <div className={`calendar-week-day-number ${day.isSame(dayjs(), 'day') ? 'today' : ''}`}>
              {day.format('D')}
            </div>
          </div>
        ))}
      </div>

      <div className="calendar-week-body">
        {weekDays.map(day => {
          const dayBookings = getBookingsForDay(day);

          return (
            <div key={day.format('YYYY-MM-DD')} className="calendar-week-day-column">
              {dayBookings.slice(0, 3).map(booking => (
                <div key={booking.id} className={`calendar-week-booking ${booking.status}`}>
                  <div className="calendar-week-booking-time">
                    {dayjs(booking.booking_date).format('HH:mm')}
                  </div>
                  <div className="calendar-week-booking-title">
                    {booking.service_name || booking.product_name}
                  </div>
                  <div className="calendar-week-booking-customer">
                    {booking.customer_name}
                  </div>
                  <div className="calendar-week-booking-status">
                    <span className={`badge badge-sm ${getStatusClass(booking.status)}`}>
                      {booking.status}
                    </span>
                  </div>
                </div>
              ))}

              {dayBookings.length > 3 && (
                <div className="calendar-week-more-bookings">
                  +{dayBookings.length - 3} more
                </div>
              )}

            </div>
          );
        })}
      </div>

      {bookings.length === 0 && (
        <div className="text-center text-muted mt-4">
          <p>No bookings for this week</p>
        </div>
      )}
    </div>
  );
};

export default WeekView;


===============================
FILE: src/components/Calendar/MonthView.jsx
===============================
import React from 'react';
import dayjs from 'dayjs';
import Button from '../common/Button';

const MonthView = ({ bookings = [], current, onCreateBooking }) => {
  const monthStart = current.startOf('month');
  const monthEnd = current.endOf('month');
  const calendarStart = monthStart.startOf('week');
  const calendarEnd = monthEnd.endOf('week');

  const days = [];
  let day = calendarStart;

  while (day.isBefore(calendarEnd) || day.isSame(calendarEnd, 'day')) {
    days.push(day);
    day = day.add(1, 'day');
  }

  const getBookingsForDay = (date) => {
    return bookings.filter(booking =>
      dayjs(booking.booking_date).isSame(date, 'day')
    );
  };

  const getStatusClass = (status) => {
    switch (status) {
      case 'confirmed': return 'bg-success';
      case 'completed': return 'bg-primary';
      case 'cancelled': return 'bg-danger';
      case 'pending':
      default: return 'bg-warning text-dark';
    }
  };

  return (
    <div className="calendar-month-view">
      <div className="calendar-month-header">
        {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
          <div key={day} className="calendar-month-day-name">
            {day}
          </div>
        ))}
      </div>

      <div className="calendar-month-body">
        {days.map(day => {
          const dayBookings = getBookingsForDay(day);
          const isCurrentMonth = day.isSame(current, 'month');
          const isToday = day.isSame(dayjs(), 'day');

          return (
            <div
              key={day.format('YYYY-MM-DD')}
              className={`calendar-month-day ${!isCurrentMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}`}
              onClick={() => onCreateBooking({ date: day.toISOString() })}
            >
              <div className="calendar-month-day-number">
                {day.format('D')}
              </div>

              <div className="calendar-month-day-bookings">
                {dayBookings.slice(0, 2).map(booking => (
                  <div key={booking.id} className={`calendar-month-booking-dot ${booking.status}`}>
                    <div className="calendar-month-booking-title">
                      {booking.service_name || booking.product_name}
                    </div>
                    <div className="calendar-month-booking-time">
                      {dayjs(booking.booking_date).format('HH:mm')}
                    </div>
                  </div>
                ))}

                {dayBookings.length > 2 && (
                  <div className="calendar-month-more-bookings">
                    +{dayBookings.length - 2}
                  </div>
                )}
              </div>
            </div>
          );
        })}
      </div>

      {bookings.length === 0 && (
        <div className="text-center text-muted mt-4">
          <p>No bookings for this month</p>
        </div>
      )}
    </div>
  );
};

export default MonthView;


===============================
FILE: src/components/Calendar/DayView.jsx
===============================
import React from 'react';
import dayjs from 'dayjs';
import Button from '../common/Button';

const DayView = ({ bookings = [], current, onCreateBooking }) => {
  const dayBookings = bookings.filter(booking =>
    dayjs(booking.booking_date).isSame(current, 'day')
  );

  const hours = Array.from({ length: 24 }, (_, i) => i);

  return (
    <div className="calendar-day-view">
      <div className="d-flex justify-content-between align-items-center mb-3">
        <h5 className="mb-0">{current.format('dddd, MMMM D, YYYY')}</h5>
      </div>

      <div className="calendar-day-grid">
        {hours.map(hour => {
          const hourBookings = dayBookings.filter(booking =>
            dayjs(booking.booking_date).hour() === hour
          );

          return (
            <div key={hour} className="calendar-hour-slot">
              <div className="calendar-hour-label">
                {hour === 0 ? '12 AM' : hour < 12 ? `${hour} AM` : hour === 12 ? '12 PM' : `${hour - 12} PM`}
              </div>
              <div className="calendar-hour-content">
                {hourBookings.map(booking => (
                  <div key={booking.id} className={`calendar-booking-card ${booking.status}`}>
                    <div className="calendar-booking-time">
                      {dayjs(booking.booking_date).format('HH:mm')}
                    </div>
                    <div className="calendar-booking-title">
                      {booking.service_name || booking.product_name}
                    </div>
                    <div className="calendar-booking-customer">
                      {booking.customer_name}
                    </div>
                    <div className="calendar-booking-status">
                      <span className={`badge ${getStatusClass(booking.status)}`}>
                        {booking.status}
                      </span>
                    </div>
                  </div>
                ))}
                {hourBookings.length === 0 && (
                  <div className="calendar-empty-slot">
                  </div>
                )}
              </div>
            </div>
          );
        })}
      </div>

      {dayBookings.length === 0 && (
        <div className="text-center text-muted mt-4">
          <p>No bookings for this day</p>
        </div>
      )}
    </div>
  );
};

const getStatusClass = (status) => {
  switch (status) {
    case 'confirmed': return 'bg-success';
    case 'completed': return 'bg-primary';
    case 'cancelled': return 'bg-danger';
    case 'pending':
    default: return 'bg-warning text-dark';
  }
};

export default DayView;


===============================
FILE: src/components/Calendar/CalendarShell.jsx
===============================
// src/components/Calendar/CalendarShell.jsx
import React, { useState, useEffect, useMemo } from 'react';
import PropTypes from 'prop-types';
import dayjs from 'dayjs';
import { useKeyboardShortcut } from '../../hooks/useKeyboardShortcut';
import Button from '../common/Button';
import DayView from './DayView';
import WeekView from './WeekView';
import MonthView from './MonthView';

const VIEWS = ['day', 'week', 'month'];

const CalendarShell = ({
  initialView = 'week',
  onCreateBooking,
}) => {
  const [view, setView] = useState(initialView);
  const [current, setCurrent] = useState(dayjs());
  const [bookings, setBookings] = useState([]);
  const [loading, setLoading] = useState(false);

  const range = useMemo(() => {
    if (view === 'day') {
      const start = current.startOf('day');
      const end = current.endOf('day');
      return { start, end };
    }
    if (view === 'week') {
      const start = current.startOf('week');
      const end = current.endOf('week');
      return { start, end };
    }
    const start = current.startOf('month');
    const end = current.endOf('month');
    return { start, end };
  }, [view, current]);

  const loadBookings = async () => {
    try {
      setLoading(true);
      const result = await window.xnoll.calendarGetBookings(
        range.start.toISOString(),
        range.end.toISOString()
      );
      if (result && result.success !== false) {
        setBookings(result || []);
      } else if (result && result.success === false) {
        console.error('Calendar load failed', result.error);
        setBookings([]);
      }
    } catch (e) {
      console.error('Calendar load error', e);
      setBookings([]);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadBookings();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [range.start.valueOf(), range.end.valueOf()]);

  const gotoToday = () => setCurrent(dayjs());
  const gotoPrev = () => {
    if (view === 'day') setCurrent(c => c.subtract(1, 'day'));
    else if (view === 'week') setCurrent(c => c.subtract(1, 'week'));
    else setCurrent(c => c.subtract(1, 'month'));
  };
  const gotoNext = () => {
    if (view === 'day') setCurrent(c => c.add(1, 'day'));
    else if (view === 'week') setCurrent(c => c.add(1, 'week'));
    else setCurrent(c => c.add(1, 'month'));
  };

  useKeyboardShortcut('Ctrl+1', () => setView('day'), [setView]);
  useKeyboardShortcut('Ctrl+2', () => setView('week'), [setView]);
  useKeyboardShortcut('Ctrl+3', () => setView('month'), [setView]);
  useKeyboardShortcut('Ctrl+N', () => {
    if (onCreateBooking) {
      onCreateBooking({ date: current.toISOString() });
    }
  }, [onCreateBooking, current]);

  const viewLabel = useMemo(() => {
    if (view === 'day') return current.format('DD MMM YYYY');
    if (view === 'week') {
      const s = range.start.format('DD MMM');
      const e = range.end.format('DD MMM YYYY');
      return `${s} - ${e}`;
    }
    return current.format('MMMM YYYY');
  }, [view, current, range]);

  const commonProps = { bookings, current, onCreateBooking };

  return (
    <div className="calendar">
      <div className="calendar-header d-flex justify-content-between align-items-center mb-3">
        <div className="d-flex gap-2">
          <Button variant="secondary" onClick={gotoPrev}>
            â¹
          </Button>
          <Button variant="secondary" onClick={gotoToday}>
            Today
          </Button>
          <Button variant="secondary" onClick={gotoNext}>
            âº
          </Button>
          <div className="calendar-title ms-3 fw-bold">
            {viewLabel}
          </div>
        </div>
        <div className="d-flex gap-2">
          {VIEWS.map(v => (
            <Button
              key={v}
              variant={v === view ? 'primary' : 'outline'}
              onClick={() => setView(v)}
            >
              {v.toUpperCase()}
            </Button>
          ))}
        </div>
      </div>

      {loading && (
        <div className="text-center text-muted mb-3">
          <div className="spinner-border text-primary" role="status">
            <span className="visually-hidden">Loading...</span>
          </div>
        </div>
      )}

      {!loading && view === 'day' && <DayView {...commonProps} />}
      {!loading && view === 'week' && <WeekView {...commonProps} />}
      {!loading && view === 'month' && <MonthView {...commonProps} />}
    </div>
  );
};

CalendarShell.propTypes = {
  initialView: PropTypes.oneOf(VIEWS),
  onCreateBooking: PropTypes.func,
  renderDayView: PropTypes.func,
  renderWeekView: PropTypes.func,
  renderMonthView: PropTypes.func,
};

export default CalendarShell;


===============================
FILE: src/components/common/Modal.jsx
===============================
import React, { useEffect } from 'react';
import Button from './Button';

/**
 * Reusable Modal Component
 * @param {boolean} show - Show/hide modal
 * @param {function} onClose - Close handler
 * @param {string} title - Modal title
 * @param {ReactNode} children - Modal content
 * @param {ReactNode} footer - Custom footer
 * @param {string} size - sm, md, lg, xl
 * @param {boolean} closeOnEscape - Close on ESC key
 * @param {boolean} closeOnBackdrop - Close on backdrop click
 */
const Modal = ({
  show = false,
  onClose,
  title = '',
  children,
  footer,
  size = 'md',
  closeOnEscape = true,
  closeOnBackdrop = true,
  className = ''
}) => {
  useEffect(() => {
    if (!show) return;

    // Handle ESC key
    const handleEscape = (e) => {
      if (closeOnEscape && e.key === 'Escape') {
        onClose();
      }
    };

    document.addEventListener('keydown', handleEscape);
    return () => document.removeEventListener('keydown', handleEscape);
  }, [show, closeOnEscape, onClose]);

  useEffect(() => {
    // Prevent body scroll when modal is open
    if (show) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = 'unset';
    }
    
    return () => {
      document.body.style.overflow = 'unset';
    };
  }, [show]);

  if (!show) return null;

  const sizeClass = {
    sm: 'modal-sm',
    md: '',
    lg: 'modal-lg',
    xl: 'modal-xl'
  }[size] || '';

  const handleBackdropClick = (e) => {
    if (closeOnBackdrop && e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <>
      <div
        className="modal fade show d-block"
        tabIndex="-1"
        role="dialog"
        style={{ zIndex: 1050 }}
        onClick={handleBackdropClick}
      >
        <div
          className={`modal-dialog modal-dialog-centered modal-dialog-scrollable ${sizeClass} ${className}`}
          onClick={(e) => e.stopPropagation()}
        >
          <div className="modal-content">
            {title && (
              <div className="modal-header">
                <h5 className="modal-title">{title}</h5>
                <button
                  type="button"
                  className="btn-close"
                  onClick={onClose}
                  aria-label="Close"
                />
              </div>
            )}
            <div className="modal-body">{children}</div>
            {footer && <div className="modal-footer">{footer}</div>}
          </div>
        </div>
      </div>
      <div
        className="modal-backdrop fade show"
        style={{ zIndex: 1040 }}
        onClick={handleBackdropClick}
      />
    </>
  );
};

export default Modal;

===============================
FILE: src/components/common/CheckboxGroup.jsx
===============================
// src/components/common/CheckboxGroup.jsx
import React from 'react';
import PropTypes from 'prop-types';

const CheckboxGroup = ({
  label,
  name,
  values = [],
  options,
  onChange,
  required = false,
  error,
  inline = false,
}) => {
  const handleToggle = optionValue => {
    const set = new Set(values || []);
    if (set.has(optionValue)) {
      set.delete(optionValue);
    } else {
      set.add(optionValue);
    }
    onChange({
      target: { name, value: Array.from(set) },
    });
  };

  const isChecked = v => (values || []).includes(v);

  return (
    <div className="form-group">
      {label && (
        <div className="form-label">
          {label} {required && <span className="text-danger">*</span>}
        </div>
      )}
      <div className={inline ? 'd-flex flex-wrap gap-3' : 'd-flex flex-column'}>
        {options.map(opt => (
          <label
            key={opt.value}
            className="checkbox"
            onClick={e => e.stopPropagation()}
          >
            <input
              type="checkbox"
              checked={isChecked(opt.value)}
              onChange={() => handleToggle(opt.value)}
            />
            <span className="checkbox-mark" />
            <span className="checkbox-label">{opt.label}</span>
          </label>
        ))}
      </div>
      {error && <div className="invalid-feedback d-block">{error}</div>}
    </div>
  );
};

CheckboxGroup.propTypes = {
  label: PropTypes.string,
  name: PropTypes.string.isRequired,
  values: PropTypes.array,
  options: PropTypes.arrayOf(
    PropTypes.shape({ value: PropTypes.any, label: PropTypes.string })
  ).isRequired,
  onChange: PropTypes.func.isRequired,
  required: PropTypes.bool,
  error: PropTypes.string,
  inline: PropTypes.bool,
};

export default CheckboxGroup;


===============================
FILE: src/components/common/FileUpload.jsx
===============================


===============================
FILE: src/components/common/Button.jsx
===============================

import React from 'react';

/**
 * Reusable Button Component
 * @param {string} variant - primary, secondary, success, danger, warning, info
 * @param {string} size - sm, md, lg
 * @param {boolean} loading - show loading spinner
 * @param {boolean} disabled - disable button
 * @param {string} shortcut - keyboard shortcut to display
 * @param {ReactNode} icon - icon component
 * @param {string} className - additional classes
 * @param {function} onClick - click handler
 * @param {string} type - button type (button, submit, reset)
 */
const Button = ({
  children,
  variant = 'primary',
  size = 'md',
  loading = false,
  disabled = false,
  shortcut = '',
  icon = null,
  className = '',
  onClick,
  type = 'button',
  fullWidth = false,
  ...props
}) => {
  const variantClasses = {
    primary: 'btn-primary',
    secondary: 'btn-outline-secondary',
    success: 'btn-success',
    danger: 'btn-danger',
    warning: 'btn-warning',
    info: 'btn-info',
    light: 'btn-light',
    dark: 'btn-dark',
    link: 'btn-link',
    'outline-primary': 'btn-outline-primary',
    'outline-secondary': 'btn-outline-secondary',
    'outline-success': 'btn-outline-success',
    'outline-danger': 'btn-outline-danger',
    'outline-warning': 'btn-outline-warning',
    'outline-info': 'btn-outline-info'
  };

  const sizeClasses = {
    sm: 'btn-sm',
    md: '',
    lg: 'btn-lg'
  };

  const baseClass = 'btn';
  const variantClass = variantClasses[variant] || variantClasses.primary;
  const sizeClass = sizeClasses[size] || '';
  const widthClass = fullWidth ? 'w-100' : '';
  const disabledClass = (disabled || loading) ? 'disabled' : '';

  const buttonClass = `${baseClass} ${variantClass} ${sizeClass} ${widthClass} ${disabledClass} ${className}`.trim();

  return (
    <button
      type={type}
      className={buttonClass}
      onClick={onClick}
      disabled={disabled || loading}
      {...props}
    >
      {loading && (
        <span className="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
      )}
      {!loading && icon && <span className="me-2">{icon}</span>}
      <span>{children}</span>
      {shortcut && (
        <kbd className="ms-2" style={{ fontSize: '0.75em', opacity: 0.7 }}>
          {shortcut}
        </kbd>
      )}
    </button>
  );
};

export default Button;

===============================
FILE: src/components/common/Textarea.jsx
===============================
import React from 'react';

/**
 * Reusable Textarea Component
 */
const Textarea = ({
  name,
  value,
  onChange,
  onBlur,
  label,
  placeholder,
  required = false,
  disabled = false,
  readOnly = false,
  error = '',
  helpText = '',
  rows = 3,
  maxLength,
  className = '',
  autoFocus = false,
  ...props
}) => {
  const errorClass = error ? 'is-invalid' : '';

  return (
    <div className={`mb-3 ${className}`}>
      {label && (
        <label htmlFor={name} className="form-label mb-1">
          {label}
          {required && <span className="text-danger ms-1">*</span>}
        </label>
      )}
      
      <textarea
        id={name}
        name={name}
        className={`form-control ${errorClass}`}
        value={value}
        onChange={onChange}
        onBlur={onBlur}
        placeholder={placeholder}
        required={required}
        disabled={disabled}
        readOnly={readOnly}
        rows={rows}
        maxLength={maxLength}
        autoFocus={autoFocus}
        {...props}
      />
      
      {maxLength && (
        <small className="form-text text-muted d-block text-end">
          {value?.length || 0} / {maxLength}
        </small>
      )}
      
      {error && (
        <div className="invalid-feedback d-block">
          {error}
        </div>
      )}
      
      {helpText && !error && (
        <small className="form-text text-muted d-block mt-1">
          {helpText}
        </small>
      )}
    </div>
  );
};

export default Textarea;

===============================
FILE: src/components/common/Select.jsx
===============================
// src/components/common/Select.jsx
import React, { useState, useMemo, useRef, useEffect } from 'react';
import PropTypes from 'prop-types';
import { useKeyboardShortcut } from '../../hooks/useKeyboardShortcut';

const Select = ({
  label,
  name,
  value,
  options,
  onChange,
  placeholder = '',
  error,
  required = false,
  disabled = false,
  allowClear = true,
  showSearch = true,
  autoFocus = false,
}) => {
  const [open, setOpen] = useState(false);
  const [query, setQuery] = useState('');
  const containerRef = useRef(null);
  const inputRef = useRef(null);

  const filteredOptions = useMemo(() => {
    if (!showSearch || !query.trim()) return options;
    const q = query.toLowerCase();
    return options.filter(
      o =>
        String(o.label).toLowerCase().includes(q) ||
        String(o.value).toLowerCase().includes(q),
    );
  }, [options, query, showSearch]);

  const selectedOption = options.find(o => o.value === value) || null;

  const handleSelect = option => {
    if (!option) return;
    onChange({ target: { name, value: option.value } });
    setOpen(false);
  };

  const handleClear = e => {
    e.stopPropagation();
    onChange({ target: { name, value: '' } });
    setQuery('');
  };

  // Click outside
  useEffect(() => {
    const handler = e => {
      if (containerRef.current && !containerRef.current.contains(e.target)) {
        setOpen(false);
      }
    };
    document.addEventListener('mousedown', handler);
    document.addEventListener('touchstart', handler);
    return () => {
      document.removeEventListener('mousedown', handler);
      document.removeEventListener('touchstart', handler);
    };
  }, []);

  // Keyboard: Enter to open, Esc to close
  useKeyboardShortcut('Enter', () => {
    if (!open) setOpen(true);
  }, [open]);

  useKeyboardShortcut('Escape', () => {
    if (open) setOpen(false);
  }, [open]);

  useEffect(() => {
    if (autoFocus && inputRef.current) {
      inputRef.current.focus();
    }
  }, [autoFocus]);

  return (
    <div className="form-group" ref={containerRef}>
      {label && (
        <label className="form-label" htmlFor={name}>
          {label} {required && <span className="text-danger">*</span>}
        </label>
      )}

      <div
        className={`select control ${disabled ? 'is-disabled' : ''} ${
          error ? 'is-invalid' : ''
        }`}
        onClick={() => !disabled && setOpen(o => !o)}
      >
        <div className="select-value">
          {selectedOption ? selectedOption.label : (
            <span className="text-muted">{placeholder}</span>
          )}
        </div>
        <div className="select-actions">
          {allowClear && value && (
            <button
              type="button"
              className="btn btn-ghost btn-xs"
              onClick={handleClear}
              tabIndex={-1}
            >
              Ã
            </button>
          )}
          <span className="select-arrow">â¾</span>
        </div>
      </div>

      {open && (
        <div className="select-dropdown">
          {showSearch && (
            <div className="select-search">
              <input
                ref={inputRef}
                type="text"
                className="form-control"
                value={query}
                onChange={e => setQuery(e.target.value)}
                placeholder="Search..."
                onClick={e => e.stopPropagation()}
              />
            </div>
          )}
          <div className="select-options">
            {filteredOptions.length === 0 && (
              <div className="select-option text-muted">
                No options
              </div>
            )}
            {filteredOptions.map(option => (
              <button
                key={option.value}
                type="button"
                className={`select-option ${
                  option.value === value ? 'is-selected' : ''
                }`}
                onClick={e => {
                  e.stopPropagation();
                  handleSelect(option);
                }}
              >
                {option.label}
              </button>
            ))}
          </div>
        </div>
      )}

      {error && <div className="invalid-feedback d-block">{error}</div>}
    </div>
  );
};

Select.propTypes = {
  label: PropTypes.string,
  name: PropTypes.string.isRequired,
  value: PropTypes.any,
  options: PropTypes.arrayOf(
    PropTypes.shape({ value: PropTypes.any, label: PropTypes.string })
  ).isRequired,
  onChange: PropTypes.func.isRequired,
  placeholder: PropTypes.string,
  error: PropTypes.string,
  required: PropTypes.bool,
  disabled: PropTypes.bool,
  allowClear: PropTypes.bool,
  showSearch: PropTypes.bool,
  autoFocus: PropTypes.bool,
};

export default Select;


===============================
FILE: src/components/common/SearchBar.jsx
===============================
import React, { useState, useEffect, useRef } from 'react';

/**
 * Reusable SearchBar Component with debouncing
 * @param {string} placeholder - placeholder text
 * @param {string} value - controlled value
 * @param {function} onChange - change handler
 * @param {number} debounce - debounce delay in ms
 * @param {function} onClear - clear handler
 * @param {boolean} autoFocus - auto focus on mount
 * @param {string} className - additional classes
 */
const SearchBar = ({
  placeholder = 'Search...',
  value = '',
  onChange,
  debounce = 300,
  onClear,
  autoFocus = false,
  className = '',
  size = 'md'
}) => {
  const [localValue, setLocalValue] = useState(value);
  const timerRef = useRef(null);
  const inputRef = useRef(null);

  useEffect(() => {
    setLocalValue(value);
  }, [value]);

  useEffect(() => {
    if (autoFocus && inputRef.current) {
      inputRef.current.focus();
    }
  }, [autoFocus]);

  // Register global keyboard shortcut (Ctrl+K or Cmd+K)
  useEffect(() => {
    const handleKeyDown = (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        if (inputRef.current) {
          inputRef.current.focus();
          inputRef.current.select();
        }
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, []);

  const handleChange = (e) => {
    const newValue = e.target.value;
    setLocalValue(newValue);

    if (timerRef.current) {
      clearTimeout(timerRef.current);
    }

    timerRef.current = setTimeout(() => {
      if (onChange) {
        onChange(newValue);
      }
    }, debounce);
  };

  const handleClear = () => {
    setLocalValue('');
    if (onChange) {
      onChange('');
    }
    if (onClear) {
      onClear();
    }
    if (inputRef.current) {
      inputRef.current.focus();
    }
  };

  const sizeClass = size === 'sm' ? 'form-control-sm' : size === 'lg' ? 'form-control-lg' : '';

  return (
    <div className={`position-relative ${className}`}>
      <div className="input-group">
        <span className="input-group-text bg-white border-end-0">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
        </span>
        <input
          ref={inputRef}
          type="text"
          className={`form-control border-start-0 ps-0 ${sizeClass}`}
          placeholder={placeholder}
          value={localValue}
          onChange={handleChange}
          style={{ boxShadow: 'none' }}
        />
        {localValue && (
          <button
            className="btn btn-link text-muted position-absolute end-0 top-50 translate-middle-y pe-3"
            onClick={handleClear}
            type="button"
            style={{ zIndex: 10 }}
          >
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
          </button>
        )}
      </div>
      <small className="text-muted d-block mt-1">
        Press <kbd>Ctrl+K</kbd> to focus search
      </small>
    </div>
  );
};

export default SearchBar;

===============================
FILE: src/components/common/DataTable.jsx
===============================
import React, { useMemo, useState } from 'react';
import SearchBar from './SearchBar';

const DataTable = ({ data = [], columns = [], onEdit, onDelete, pageSize = 10, filters = {} }) => {
  const [search, setSearch] = useState('');
  const [page, setPage] = useState(1);
  const [sortKey, setSortKey] = useState('id');
  const [sortDir, setSortDir] = useState('desc');

  const filteredData = useMemo(() => {
    let filtered = [...data];
    // Apply custom filters (e.g., from custom fields)
    Object.entries(filters).forEach(([key, val]) => {
      if (val) filtered = filtered.filter(row => String(row[key] || '').toLowerCase().includes(val.toLowerCase()));
    });
    // Search
    if (search) {
      filtered = filtered.filter(row => 
        columns.some(col => String(row[col.key] || '').toLowerCase().includes(search.toLowerCase()))
      );
    }
    // Sort
    filtered.sort((a, b) => {
      const va = a[sortKey] ?? '';
      const vb = b[sortKey] ?? '';
      return (va > vb ? 1 : -1) * (sortDir === 'asc' ? 1 : -1);
    });
    return filtered;
  }, [data, search, sortKey, sortDir, filters]);

  const totalPages = Math.ceil(filteredData.length / pageSize);
  const paginated = filteredData.slice((page - 1) * pageSize, page * pageSize);

  const handleSort = (key) => {
    if (sortKey === key) setSortDir(d => d === 'asc' ? 'desc' : 'asc');
    else { setSortKey(key); setSortDir('asc'); }
    setPage(1);
  };

  return (
    <div>
      <div className="d-flex justify-content-between mb-2">
        <SearchBar value={search} onChange={setSearch} onFocusShortcut={() => setPage(1)} />
        {Object.keys(filters).length > 0 && (
          <div className="d-flex gap-2">
            {Object.entries(filters).map(([key, val]) => (
              val ? <input key={key} className="form-control form-control-sm" placeholder={key} value={val} onChange={e => filters.onChange(key, e.target.value)} /> : null
            ))}
          </div>
        )}
      </div>
      <div className="table-responsive" style={{ maxHeight: '60vh', overflowY: 'auto' }}>
        <table className="table table-sm table-striped">
          <thead>
            <tr>
              {columns.map(col => (
                <th key={col.key} onClick={() => handleSort(col.key)} style={{ cursor: 'pointer' }}>
                  {col.label} {sortKey === col.key && (sortDir === 'asc' ? 'â²' : 'â¼')}
                </th>
              ))}
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {paginated.map(row => (
              <tr key={row.id}>
                {columns.map(col => <td key={col.key}>{row[col.key]}</td>)}
                <td>
                  <button className="btn btn-sm btn-outline-primary me-1" onClick={() => onEdit(row)}>Edit</button>
                  <button className="btn btn-sm btn-outline-danger" onClick={() => onDelete(row.id)}>Del</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      {totalPages > 1 && (
        <nav className="d-flex justify-content-between">
          <span>Page {page} of {totalPages}</span>
          <div>
            <button className="btn btn-sm" disabled={page === 1} onClick={() => setPage(p => p - 1)}>Prev</button>
            <button className="btn btn-sm" disabled={page === totalPages} onClick={() => setPage(p => p + 1)}>Next</button>
          </div>
        </nav>
      )}
    </div>
  );
};

export default DataTable;

===============================
FILE: src/components/common/Table.jsx
===============================
import React, { useState, useMemo } from 'react';
import Button from './Button';

/**
 * Reusable Table Component
 * @param {Array} columns - Column definitions [{ key, label, sortable, render, width }]
 * @param {Array} data - Table data
 * @param {number} pageSize - Items per page
 * @param {boolean} pagination - Enable pagination
 * @param {boolean} exportable - Show export button
 * @param {function} onRowClick - Row click handler
 * @param {string} emptyMessage - Message when no data
 * @param {boolean} striped - Striped rows
 * @param {boolean} hover - Hover effect
 */
const Table = ({
  columns = [],
  data = [],
  pageSize = 10,
  pagination = true,
  exportable = true,
  onRowClick,
  emptyMessage = 'No data available',
  striped = true,
  hover = true,
  loading = false,
  className = ''
}) => {
  const [currentPage, setCurrentPage] = useState(1);
  const [sortKey, setSortKey] = useState('');
  const [sortDir, setSortDir] = useState('asc');

  // Sorting logic
  const sortedData = useMemo(() => {
    if (!sortKey) return data;
    
    return [...data].sort((a, b) => {
      const aVal = a[sortKey] ?? '';
      const bVal = b[sortKey] ?? '';
      
      if (aVal < bVal) return sortDir === 'asc' ? -1 : 1;
      if (aVal > bVal) return sortDir === 'asc' ? 1 : -1;
      return 0;
    });
  }, [data, sortKey, sortDir]);

  // Pagination logic
  const totalPages = Math.max(1, Math.ceil(sortedData.length / pageSize));
  const safePage = Math.min(currentPage, totalPages);
  
  const paginatedData = useMemo(() => {
    if (!pagination) return sortedData;
    const start = (safePage - 1) * pageSize;
    return sortedData.slice(start, start + pageSize);
  }, [sortedData, safePage, pageSize, pagination]);

  const handleSort = (key) => {
    const column = columns.find(col => col.key === key);
    if (!column || column.sortable === false) return;
    
    if (sortKey === key) {
      setSortDir(sortDir === 'asc' ? 'desc' : 'asc');
    } else {
      setSortKey(key);
      setSortDir('asc');
    }
  };

  const getSortIcon = (key) => {
    if (sortKey !== key) return 'â¬';
    return sortDir === 'asc' ? 'â²' : 'â¼';
  };

  const goToPage = (page) => {
    if (page < 1 || page > totalPages) return;
    setCurrentPage(page);
  };

  // Export to CSV
  const exportToCSV = () => {
    const headers = columns.map(col => col.label).join(',');
    const rows = sortedData.map(row => 
      columns.map(col => {
        const value = row[col.key] ?? '';
        // Escape commas and quotes
        const escaped = String(value).replace(/"/g, '""');
        return `"${escaped}"`;
      }).join(',')
    );
    
    const csv = [headers, ...rows].join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', `export_${Date.now()}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  const stripedClass = striped ? 'table-striped' : '';
  const hoverClass = hover ? 'table-hover' : '';

  return (
    <div className={className}>
      {exportable && data.length > 0 && (
        <div className="d-flex justify-content-end mb-2">
          <Button
            variant="outline-secondary"
            size="sm"
            onClick={exportToCSV}
            icon={
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
              </svg>
            }
          >
            Export CSV
          </Button>
        </div>
      )}
      
      <div className="table-responsive" style={{ maxHeight: '60vh', overflowY: 'auto' }}>
        <table className={`table table-sm align-middle ${stripedClass} ${hoverClass}`}>
          <thead className="table-light sticky-top">
            <tr>
              {columns.map((col) => (
                <th
                  key={col.key}
                  style={{ 
                    width: col.width, 
                    cursor: col.sortable !== false ? 'pointer' : 'default' 
                  }}
                  onClick={() => handleSort(col.key)}
                >
                  {col.label}
                  {col.sortable !== false && (
                    <span className="ms-2 text-muted" style={{ fontSize: '0.8em' }}>
                      {getSortIcon(col.key)}
                    </span>
                  )}
                </th>
              ))}
            </tr>
          </thead>
          <tbody>
            {loading && (
              <tr>
                <td colSpan={columns.length} className="text-center py-4">
                  <div className="spinner-border text-primary" role="status">
                    <span className="visually-hidden">Loading...</span>
                  </div>
                </td>
              </tr>
            )}
            
            {!loading && paginatedData.length === 0 && (
              <tr>
                <td colSpan={columns.length} className="text-center text-muted py-4">
                  {emptyMessage}
                </td>
              </tr>
            )}
            
            {!loading && paginatedData.map((row, idx) => (
              <tr 
                key={row.id || idx}
                onClick={() => onRowClick && onRowClick(row)}
                style={{ cursor: onRowClick ? 'pointer' : 'default' }}
              >
                {columns.map((col) => (
                  <td key={col.key}>
                    {col.render ? col.render(row[col.key], row) : row[col.key]}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {pagination && totalPages > 1 && (
        <div className="d-flex justify-content-between align-items-center mt-3">
          <small className="text-muted">
            Showing {(safePage - 1) * pageSize + 1}â
            {Math.min(safePage * pageSize, sortedData.length)} of {sortedData.length}
          </small>
          <nav>
            <ul className="pagination pagination-sm mb-0">
              <li className={`page-item ${safePage === 1 ? 'disabled' : ''}`}>
                <button
                  className="page-link"
                  onClick={() => goToPage(safePage - 1)}
                  disabled={safePage === 1}
                >
                  Previous
                </button>
              </li>
              
              {[...Array(totalPages)].map((_, i) => {
                const page = i + 1;
                // Show first, last, current, and pages around current
                if (
                  page === 1 ||
                  page === totalPages ||
                  (page >= safePage - 1 && page <= safePage + 1)
                ) {
                  return (
                    <li
                      key={page}
                      className={`page-item ${page === safePage ? 'active' : ''}`}
                    >
                      <button className="page-link" onClick={() => goToPage(page)}>
                        {page}
                      </button>
                    </li>
                  );
                } else if (page === safePage - 2 || page === safePage + 2) {
                  return (
                    <li key={page} className="page-item disabled">
                      <span className="page-link">...</span>
                    </li>
                  );
                }
                return null;
              })}
              
              <li className={`page-item ${safePage === totalPages ? 'disabled' : ''}`}>
                <button
                  className="page-link"
                  onClick={() => goToPage(safePage + 1)}
                  disabled={safePage === totalPages}
                >
                  Next
                </button>
              </li>
            </ul>
          </nav>
        </div>
      )}
    </div>
  );
};

export default Table;

===============================
FILE: src/components/common/DateTimeInput.jsx
===============================
// src/components/common/DateTimeInput.jsx
import React from 'react';
import PropTypes from 'prop-types';

const DateTimeInput = ({
  label,
  name,
  value,
  onChange,
  required = false,
  error,
  min,
  max,
}) => {
  return (
    <div className="form-group">
      {label && (
        <label className="form-label" htmlFor={name}>
          {label} {required && <span className="text-danger">*</span>}
        </label>
      )}
      <input
        id={name}
        name={name}
        type="datetime-local"
        className={`form-control ${error ? 'is-invalid' : ''}`}
        value={value || ''}
        min={min}
        max={max}
        onChange={onChange}
      />
      {error && <div className="invalid-feedback">{error}</div>}
    </div>
  );
};

DateTimeInput.propTypes = {
  label: PropTypes.string,
  name: PropTypes.string.isRequired,
  value: PropTypes.string,
  onChange: PropTypes.func.isRequired,
  required: PropTypes.bool,
  error: PropTypes.string,
  min: PropTypes.string,
  max: PropTypes.string,
};

export default DateTimeInput;


===============================
FILE: src/components/common/Input.jsx
===============================
import React from 'react';

/**
 * Reusable Input Component
 * @param {string} type - text, number, email, tel, password, url
 * @param {string} name - input name
 * @param {string} value - input value
 * @param {function} onChange - change handler
 * @param {string} label - input label
 * @param {string} placeholder - placeholder text
 * @param {boolean} required - required field
 * @param {boolean} disabled - disabled state
 * @param {string} error - error message
 * @param {string} helpText - help text below input
 * @param {string} size - sm, md, lg
 * @param {ReactNode} icon - icon to display
 * @param {string} className - additional classes
 */
const Input = ({
  type = 'text',
  name,
  value,
  onChange,
  onBlur,
  label,
  placeholder,
  required = false,
  disabled = false,
  readOnly = false,
  error = '',
  helpText = '',
  size = 'md',
  icon = null,
  className = '',
  autoFocus = false,
  min,
  max,
  step,
  pattern,
  maxLength,
  ...props
}) => {
  const sizeClass = {
    sm: 'form-control-sm',
    md: '',
    lg: 'form-control-lg'
  }[size] || '';

  const errorClass = error ? 'is-invalid' : '';

  return (
    <div className={`mb-3 ${className}`}>
      {label && (
        <label htmlFor={name} className="form-label mb-1">
          {label}
          {required && <span className="text-danger ms-1">*</span>}
        </label>
      )}
      
      <div className={icon ? 'input-group' : ''}>
        {icon && (
          <span className="input-group-text">
            {icon}
          </span>
        )}
        
        <input
          type={type}
          id={name}
          name={name}
          className={`form-control ${sizeClass} ${errorClass}`}
          value={value}
          onChange={onChange}
          onBlur={onBlur}
          placeholder={placeholder}
          required={required}
          disabled={disabled}
          readOnly={readOnly}
          autoFocus={autoFocus}
          min={min}
          max={max}
          step={step}
          pattern={pattern}
          maxLength={maxLength}
          {...props}
        />
        
        {error && (
          <div className="invalid-feedback">
            {error}
          </div>
        )}
      </div>
      
      {helpText && !error && (
        <small className="form-text text-muted d-block mt-1">
          {helpText}
        </small>
      )}
    </div>
  );
};

export default Input;

===============================
FILE: src/components/common/Radio.jsx
===============================
// src/components/common/Radio.jsx
import React from 'react';
import PropTypes from 'prop-types';

export const Radio = ({
  label,
  name,
  value,
  checked,
  onChange,
  disabled = false,
}) => {
  return (
    <label className={`radio ${disabled ? 'is-disabled' : ''}`}>
      <input
        type="radio"
        name={name}
        value={value}
        checked={!!checked}
        disabled={disabled}
        onChange={e =>
          onChange({
            target: { name, value: e.target.value },
          })
        }
      />
      <span className="radio-mark" />
      <span className="radio-label">{label}</span>
    </label>
  );
};

Radio.propTypes = {
  label: PropTypes.string.isRequired,
  name: PropTypes.string.isRequired,
  value: PropTypes.any.isRequired,
  checked: PropTypes.bool,
  onChange: PropTypes.func.isRequired,
  disabled: PropTypes.bool,
};

export const RadioGroup = ({
  label,
  name,
  value,
  options,
  onChange,
  required = false,
  error,
  inline = false,
}) => {
  return (
    <div className="form-group">
      {label && (
        <div className="form-label">
          {label} {required && <span className="text-danger">*</span>}
        </div>
      )}
      <div className={inline ? 'd-flex flex-wrap gap-3' : 'd-flex flex-column'}>
        {options.map(opt => (
          <Radio
            key={opt.value}
            name={name}
            label={opt.label}
            value={opt.value}
            checked={opt.value === value}
            onChange={onChange}
          />
        ))}
      </div>
      {error && <div className="invalid-feedback d-block">{error}</div>}
    </div>
  );
};

RadioGroup.propTypes = {
  label: PropTypes.string,
  name: PropTypes.string.isRequired,
  value: PropTypes.any,
  options: PropTypes.arrayOf(
    PropTypes.shape({ value: PropTypes.any, label: PropTypes.string })
  ).isRequired,
  onChange: PropTypes.func.isRequired,
  required: PropTypes.bool,
  error: PropTypes.string,
  inline: PropTypes.bool,
};

export default RadioGroup;


===============================
FILE: src/components/common/DatePicker.jsx
===============================


===============================
FILE: src/components/common/FormField.jsx
===============================
import React, { useRef } from 'react';

const FormField = ({ label, type = 'text', name, value, onChange, required = false, error = '', options = [], withSearch = false }) => {
  const ref = useRef(null);

  const handleKey = (e) => {
    if (e.key === 'Enter') {
      ref.current?.form?.dispatchEvent(new Event('submit'));
    } else if (e.key === 'Escape') {
      ref.current?.blur();
    } else if (e.key === 'Tab') {
      // Auto-focus next
    }
  };

  const renderSelect = () => (
    <select ref={ref} name={name} value={value} onChange={onChange} onKeyDown={handleKey} required={required} className={error ? 'is-invalid' : ''}>
      <option value="">Select...</option>
      {options.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}
    </select>
  );

  return (
    <div className="mb-2">
      <label className="form-label small">{label} {required && '*'}</label>
      {type === 'select' ? renderSelect() : (
        <input
          ref={ref}
          type={type}
          name={name}
          value={value}
          onChange={onChange}
          onKeyDown={handleKey}
          className={`form-control form-control-sm ${error ? 'is-invalid' : ''}`}
          required={required}
          list={withSearch ? `${name}-list` : undefined}
        />
      )}
      {error && <div className="invalid-feedback">{error}</div>}
      {withSearch && options.length > 0 && (
        <datalist id={`${name}-list`}>
          {options.map(opt => <option key={opt.value} value={opt.value} />)}
        </datalist>
      )}
      <small className="text-muted">Tab/Enter to navigate, Esc to cancel</small>
    </div>
  );
};

export default FormField;

===============================
FILE: src/components/common/Pagination.jsx
===============================
import React from 'react';
import Button from './Button';

const Pagination = ({
  currentPage,
  totalPages,
  pageSize,
  pageSizeOptions = [10, 25, 50, 100],
  onPageChange,
  onPageSizeChange,
  totalItems,
  showInfo = true
}) => {
  const startItem = (currentPage - 1) * pageSize + 1;
  const endItem = Math.min(currentPage * pageSize, totalItems);

  const getVisiblePages = () => {
    const pages = [];
    const maxVisible = 5;

    if (totalPages <= maxVisible) {
      for (let i = 1; i <= totalPages; i++) {
        pages.push(i);
      }
    } else {
      if (currentPage <= 3) {
        for (let i = 1; i <= 4; i++) {
          pages.push(i);
        }
        pages.push('...');
        pages.push(totalPages);
      } else if (currentPage >= totalPages - 2) {
        pages.push(1);
        pages.push('...');
        for (let i = totalPages - 3; i <= totalPages; i++) {
          pages.push(i);
        }
      } else {
        pages.push(1);
        pages.push('...');
        for (let i = currentPage - 1; i <= currentPage + 1; i++) {
          pages.push(i);
        }
        pages.push('...');
        pages.push(totalPages);
      }
    }

    return pages;
  };

  if (totalPages <= 1) return null;

  return (
    <div className="d-flex flex-column flex-sm-row justify-content-between align-items-center gap-2 mt-3">
      {showInfo && (
        <div className="text-muted small">
          Showing {startItem}â{endItem} of {totalItems} entries
        </div>
      )}

      <div className="d-flex align-items-center gap-2">
        {/* Page Size Selector */}
        <div className="d-flex align-items-center gap-1">
          <span className="text-muted small">Show:</span>
          <select
            className="form-select form-select-sm"
            style={{ width: 'auto' }}
            value={pageSize}
            onChange={(e) => onPageSizeChange(Number(e.target.value))}
          >
            {pageSizeOptions.map(size => (
              <option key={size} value={size}>{size}</option>
            ))}
          </select>
        </div>

        {/* Pagination Controls */}
        <nav>
          <ul className="pagination pagination-sm mb-0">
            <li className={`page-item ${currentPage === 1 ? 'disabled' : ''}`}>
              <Button
                variant="outline-secondary"
                size="sm"
                onClick={() => onPageChange(currentPage - 1)}
                disabled={currentPage === 1}
                className="px-2"
              >
                â¹
              </Button>
            </li>

            {getVisiblePages().map((page, index) => (
              <li key={index} className={`page-item ${page === currentPage ? 'active' : ''} ${page === '...' ? 'disabled' : ''}`}>
                {page === '...' ? (
                  <span className="page-link">...</span>
                ) : (
                  <Button
                    variant={page === currentPage ? 'primary' : 'outline-secondary'}
                    size="sm"
                    onClick={() => onPageChange(page)}
                    className="px-3"
                  >
                    {page}
                  </Button>
                )}
              </li>
            ))}

            <li className={`page-item ${currentPage === totalPages ? 'disabled' : ''}`}>
              <Button
                variant="outline-secondary"
                size="sm"
                onClick={() => onPageChange(currentPage + 1)}
                disabled={currentPage === totalPages}
                className="px-2"
              >
                âº
              </Button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  );
};

export default Pagination;


===============================
FILE: src/components/common/Checkbox.jsx
===============================


===============================
FILE: src/components/ShortcutHelp.jsx
===============================


===============================
FILE: src/components/LanguageSwitcher.jsx
===============================
import React, { useState, useRef, useEffect } from 'react';
import { useTranslation } from '../i18n/i18nContext';

const LanguageSwitcher = ({ className = '' }) => {
  const { language, changeLanguage, availableLanguages } = useTranslation();
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef(null);

  const currentLang = availableLanguages.find(lang => lang.code === language);

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setIsOpen(false);
      }
    };

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen]);

  const handleLanguageChange = (langCode) => {
    changeLanguage(langCode);
    setIsOpen(false);
  };

  return (
    <div className={`dropdown ${className}`} ref={dropdownRef}>
      <button
        className="btn btn-sm btn-outline-secondary dropdown-toggle"
        type="button"
        onClick={() => setIsOpen(!isOpen)}
      >
        ð {currentLang?.nativeName || 'English'}
      </button>
      
      {isOpen && (
        <ul 
          className="dropdown-menu dropdown-menu-end show"
          style={{ position: 'absolute', right: 0 }}
        >
          {availableLanguages.map((lang) => (
            <li key={lang.code}>
              <button
                className={`dropdown-item ${lang.code === language ? 'active' : ''}`}
                onClick={() => handleLanguageChange(lang.code)}
              >
                {lang.nativeName}
                {lang.code === language && (
                  <span className="ms-2">â</span>
                )}
              </button>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
};

export default LanguageSwitcher;

===============================
FILE: src/components/GlobalSearch.jsx
===============================


===============================
FILE: src/components/ErrorBoundary.jsx
===============================
import React from 'react';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
    
    // Log to file
    if (window.xnoll) {
      window.xnoll.errorReport({
        error: error.toString(),
        stack: error.stack,
        componentStack: errorInfo.componentStack
      });
    }
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="min-vh-100 d-flex align-items-center justify-content-center">
          <div className="text-center">
            <h2>Something went wrong</h2>
            <p>{this.state.error?.message}</p>
            <button 
              className="btn btn-primary"
              onClick={() => window.location.reload()}
            >
              Reload App
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;

===============================
FILE: src/components/layout/TopBar.jsx
===============================
import React from "react";
import LanguageSwitcher from "../LanguageSwitcher";
import { useTranslation } from "../../i18n/i18nContext";

const TopBar = ({ env, onNavigate }) => {
  const isDev = env === "development";
  const { t } = useTranslation();

  return (
    <nav className="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
      <div className="container-fluid">
        <span className="navbar-brand fw-semibold d-flex align-items-center">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            className="me-2"
          >
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          Xnoll Booking Desktop
        </span>

        <div className="d-flex align-items-center gap-3">
          {isDev && <span className="badge bg-warning text-dark">DEV</span>}

          <small className="text-warning fw-semibold d-none d-md-inline">
            Offline
          </small>

          {/* <LanguageSwitcher /> */}

          <button
            className="btn btn-sm btn-outline-light"
            onClick={() => {
              if (onNavigate) onNavigate("settings");
            }}
            title={t("nav.settings")}
          >
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z" />
              <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z" />
            </svg>
          </button>
        </div>
      </div>
    </nav>
  );
};

export default TopBar;


===============================
FILE: src/components/layout/Sidebar.jsx
===============================
import React from "react";
import { useTranslation } from "../../i18n/i18nContext";

const Sidebar = ({ activePage, setActivePage }) => {
  const { t } = useTranslation();

  const itemClass = (key) =>
    "list-group-item list-group-item-action border-0 rounded-0 " +
    (activePage === key ? "active" : "");

  return (
    <aside className="sidebar border-end bg-white">
      <div className="p-3 border-bottom">
        <h6 className="mb-0 text-primary fw-bold">Xnoll Menu</h6>
        <small className="text-muted">Quick access</small>
      </div>
      <div className="list-group list-group-flush">
        <button
          className={itemClass("dashboard")}
          onClick={() => setActivePage("dashboard")}
        >
          ð {t('nav.dashboard')}
        </button>
        <button
          className={itemClass("calendar")}
          onClick={() => setActivePage("calendar")}
        >
          ðï¸ {t('nav.calendar')}
        </button>
        <button
          className={itemClass("booking")}
          onClick={() => setActivePage("booking")}
        >
          ð {t('nav.bookings')}
        </button>
        <button
          className={itemClass("customers")}
          onClick={() => setActivePage("customers")}
        >
          ð¥ {t('nav.customers')}
        </button>
        <button
          className={itemClass("products")}
          onClick={() => setActivePage("products")}
        >
          ð¦ {t('nav.products')}
        </button>
        <button
          className={itemClass("invoices")}
          onClick={() => setActivePage("invoices")}
        >
          ð§¾ {t('nav.invoices')}
        </button>
        <button
          className={itemClass("reports")}
          onClick={() => setActivePage("reports")}
        >
          ð {t('nav.reports')}
        </button>
        <button
          className={itemClass("notes")}
          onClick={() => setActivePage("notes")}
        >
          ð {t('nav.notes')}
        </button>

        <button
          className={itemClass("settings")}
          onClick={() => setActivePage("settings")}
        >
          âï¸ {t('nav.settings')}
        </button>
      </div>
    </aside>
  );
};

export default Sidebar;


===============================
FILE: src/index.jsx
===============================
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);


===============================
FILE: src/index.html
===============================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Xnoll Booking Desktop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS (free CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- FontAwesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/styles/global.css" />
  </head>
  <body>
    <div id="root"></div>

    <!-- Bootstrap JS bundle (for dropdowns, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="/index.jsx"></script>
  </body>
</html>


===============================
FILE: src/i18n/translations/index.js
===============================
// English translations (base)
const en = {
  common: {
    save: 'Save',
    cancel: 'Cancel',
    delete: 'Delete',
    edit: 'Edit',
    add: 'Add',
    search: 'Search',
    filter: 'Filter',
    export: 'Export',
    import: 'Import',
    refresh: 'Refresh',
    loading: 'Loading...',
    noData: 'No data available',
    confirm: 'Confirm',
    yes: 'Yes',
    no: 'No',
    close: 'Close',
    back: 'Back',
    next: 'Next',
    previous: 'Previous',
    submit: 'Submit',
    reset: 'Reset',
    clear: 'Clear',
    selectAll: 'Select All',
    deselectAll: 'Deselect All',
    actions: 'Actions',
    status: 'Status',
    active: 'Active',
    inactive: 'Inactive',
    required: 'Required',
    optional: 'Optional',
    total: 'Total',
    showing: 'Showing',
    of: 'of',
    page: 'Page',
    perPage: 'Per Page',
    sortBy: 'Sort By',
    ascending: 'Ascending',
    descending: 'Descending'
  },
  
  nav: {
    dashboard: 'Dashboard',
    customers: 'Customers',
    products: 'Products',
    bookings: 'Bookings',
    invoices: 'Invoices',
    calendar: 'Calendar',
    reports: 'Reports',
    notes: 'Notes',
    settings: 'Settings'
  },
  
  dashboard: {
    title: 'Dashboard',
    welcome: 'Welcome to Xnoll Booking Desktop',
    overview: 'Overview',
    todayBookings: 'Today\'s Bookings',
    upcomingBookings: 'Upcoming Bookings',
    recentCustomers: 'Recent Customers',
    revenue: 'Revenue',
    unpaidInvoices: 'Unpaid Invoices'
  },
  
  customers: {
    title: 'Customers',
    addNew: 'New Customer',
    editCustomer: 'Edit Customer',
    deleteConfirm: 'Are you sure you want to delete this customer?',
    name: 'Name',
    phone: 'Phone',
    email: 'Email',
    address: 'Address',
    notes: 'Notes',
    createdAt: 'Created At',
    totalCustomers: 'Total Customers'
  },
  
  products: {
    title: 'Products / Services',
    addNew: 'New Product',
    editProduct: 'Edit Product',
    deleteConfirm: 'Are you sure you want to delete this product?',
    sku: 'SKU',
    name: 'Name',
    description: 'Description',
    price: 'Price',
    unit: 'Unit',
    category: 'Category',
    inStock: 'In Stock',
    outOfStock: 'Out of Stock'
  },
  
  bookings: {
    title: 'Bookings',
    addNew: 'New Booking',
    editBooking: 'Edit Booking',
    deleteConfirm: 'Are you sure you want to delete this booking?',
    customer: 'Customer',
    service: 'Service',
    date: 'Date',
    time: 'Time',
    duration: 'Duration',
    status: 'Status',
    pending: 'Pending',
    confirmed: 'Confirmed',
    completed: 'Completed',
    cancelled: 'Cancelled',
    notes: 'Notes',
    generateInvoice: 'Generate Invoice'
  },
  
  invoices: {
    title: 'Invoices',
    addNew: 'New Invoice',
    editInvoice: 'Edit Invoice',
    deleteConfirm: 'Are you sure you want to delete this invoice?',
    invoiceNumber: 'Invoice Number',
    customer: 'Customer',
    date: 'Date',
    dueDate: 'Due Date',
    amount: 'Amount',
    paid: 'Paid',
    unpaid: 'Unpaid',
    partiallyPaid: 'Partially Paid',
    items: 'Items',
    subtotal: 'Subtotal',
    tax: 'Tax',
    discount: 'Discount',
    total: 'Total',
    print: 'Print',
    download: 'Download'
  },
  
  calendar: {
    title: 'Calendar',
    day: 'Day',
    week: 'Week',
    month: 'Month',
    today: 'Today',
    noBookings: 'No bookings for this period',
    createBooking: 'Create Booking'
  },
  
  reports: {
    title: 'Reports',
    salesReport: 'Sales Report',
    bookingStats: 'Booking Statistics',
    customerAnalytics: 'Customer Analytics',
    revenueReport: 'Revenue Report',
    dateRange: 'Date Range',
    from: 'From',
    to: 'To',
    generate: 'Generate Report',
    exportCSV: 'Export as CSV',
    exportPDF: 'Export as PDF'
  },
  
  notes: {
    title: 'Notes',
    addNew: 'New Note',
    editNote: 'Edit Note',
    deleteConfirm: 'Are you sure you want to delete this note?',
    noteTitle: 'Title',
    content: 'Content',
    tags: 'Tags',
    pinned: 'Pinned',
    color: 'Color',
    lastEdited: 'Last Edited'
  },
  
  settings: {
    title: 'Settings',
    general: 'General',
    company: 'Company Profile',
    language: 'Language',
    appearance: 'Appearance',
    customFields: 'Custom Fields',
    backup: 'Backup & Restore',
    license: 'License',
    about: 'About',
    
    companyName: 'Company Name',
    companyLogo: 'Company Logo',
    companyAddress: 'Address',
    companyPhone: 'Phone',
    companyEmail: 'Email',
    taxId: 'Tax ID',
    currency: 'Currency',
    timezone: 'Timezone',
    dateFormat: 'Date Format',
    timeFormat: 'Time Format',
    
    enableReminders: 'Enable Reminders',
    reminderTime: 'Reminder Time Before Appointment',
    soundNotification: 'Sound Notification',
    
    createBackup: 'Create Backup',
    restoreBackup: 'Restore from Backup',
    backupLocation: 'Backup Location',
    autoBackup: 'Automatic Backup',
    backupFrequency: 'Backup Frequency',
    
    licenseKey: 'License Key',
    activateLicense: 'Activate License',
    licenseStatus: 'License Status',
    licenseExpiry: 'License Expiry',
    
    autoGenerateSKU: 'Auto Generate SKU',
    skuPrefix: 'SKU Prefix',
    
    selectLanguage: 'Select Language',
    theme: 'Theme',
    lightMode: 'Light Mode',
    darkMode: 'Dark Mode'
  },
  
  customFields: {
    title: 'Custom Fields',
    addField: 'Add Custom Field',
    editField: 'Edit Custom Field',
    deleteConfirm: 'Are you sure you want to delete this custom field?',
    fieldName: 'Field Name',
    fieldLabel: 'Field Label',
    fieldType: 'Field Type',
    module: 'Module',
    isRequired: 'Required',
    displayInGrid: 'Display in Grid',
    displayInFilter: 'Display in Filter',
    isSortable: 'Sortable',
    isSearchable: 'Searchable',
    options: 'Options',
    defaultValue: 'Default Value',
    
    types: {
      text: 'Text',
      number: 'Number',
      // email: 'Email',
      // phone: 'Phone',
      // url: 'URL',
      textarea: 'Text Area',
      date: 'Date',
      // datetime: 'Date & Time',
      // checkbox: 'Checkbox',
      // checkboxGroup: 'Checkbox Group',
      // radio: 'Radio',
      // radioGroup: 'Radio Group',
      select: 'Select',
      // multiSelect: 'Multi Select',
      // file: 'File Upload'
    }
  },
  
  shortcuts: {
    title: 'Keyboard Shortcuts',
    global: 'Global',
    forms: 'Forms',
    navigation: 'Navigation',
    search: 'Search',
    
    ctrlK: 'Ctrl+K - Focus Search',
    ctrlS: 'Ctrl+S - Save Form',
    esc: 'ESC - Cancel / Close Modal',
    ctrlN: 'Ctrl+N - New Record',
    ctrlE: 'Ctrl+E - Edit Record',
    ctrlD: 'Ctrl+D - Delete Record',
    tab: 'Tab - Next Field',
    shiftTab: 'Shift+Tab - Previous Field',
    enter: 'Enter - Submit Form',
    ctrlP: 'Ctrl+P - Print',
    ctrlB: 'Ctrl+B - Create Backup'
  },
  
  errors: {
    required: 'This field is required',
    invalidEmail: 'Invalid email address',
    invalidPhone: 'Invalid phone number',
    invalidURL: 'Invalid URL',
    minLength: 'Minimum length is {{min}} characters',
    maxLength: 'Maximum length is {{max}} characters',
    minValue: 'Minimum value is {{min}}',
    maxValue: 'Maximum value is {{max}}',
    duplicate: 'This value already exists',
    saveFailed: 'Failed to save. Please try again.',
    deleteFailed: 'Failed to delete. Please try again.',
    loadFailed: 'Failed to load data. Please try again.',
    networkError: 'Network error. Please check your connection.',
    unknownError: 'An unknown error occurred.',
    invalidLicense: 'Invalid license key',
    licenseExpired: 'License has expired',
    backupFailed: 'Backup failed. Please try again.',
    restoreFailed: 'Restore failed. Please check the backup file.'
  },
  
  messages: {
    saveSuccess: 'Saved successfully',
    deleteSuccess: 'Deleted successfully',
    updateSuccess: 'Updated successfully',
    backupSuccess: 'Backup created successfully',
    restoreSuccess: 'Restore completed successfully',
    licenseActivated: 'License activated successfully',
    confirmDelete: 'Are you sure you want to delete this item?',
    unsavedChanges: 'You have unsaved changes. Do you want to leave?',
    noDataAvailable: 'No data available',
    selectCustomer: 'Please select a customer',
    selectProduct: 'Please select a product',
    selectDate: 'Please select a date'
  },
  
  license: {
    title: 'License Activation',
    enterKey: 'Enter your license key',
    activate: 'Activate',
    status: 'Status',
    activated: 'Activated',
    notActivated: 'Not Activated',
    expired: 'Expired',
    expiresOn: 'Expires on',
    machineId: 'Machine ID',
    contactSupport: 'Contact support for license issues',
    trialVersion: 'Trial Version',
    trialDaysLeft: '{{days}} days left in trial'
  }
};

// Hindi translations
const hi = {
  common: {
    save: 'à¤¸à¤¹à¥à¤à¥à¤',
    cancel: 'à¤°à¤¦à¥à¤¦ à¤à¤°à¥à¤',
    delete: 'à¤¹à¤à¤¾à¤à¤',
    edit: 'à¤¸à¤à¤ªà¤¾à¤¦à¤¿à¤¤ à¤à¤°à¥à¤',
    add: 'à¤à¥à¤¡à¤¼à¥à¤',
    search: 'à¤à¥à¤à¥à¤',
    filter: 'à¤«à¤¼à¤¿à¤²à¥à¤à¤°',
    export: 'à¤¨à¤¿à¤°à¥à¤¯à¤¾à¤¤',
    import: 'à¤à¤¯à¤¾à¤¤',
    refresh: 'à¤¤à¤¾à¤à¤¼à¤¾ à¤à¤°à¥à¤',
    loading: 'à¤²à¥à¤¡ à¤¹à¥ à¤°à¤¹à¤¾ à¤¹à¥...',
    noData: 'à¤à¥à¤ à¤¡à¥à¤à¤¾ à¤à¤ªà¤²à¤¬à¥à¤§ à¤¨à¤¹à¥à¤',
    confirm: 'à¤ªà¥à¤·à¥à¤à¤¿ à¤à¤°à¥à¤',
    yes: 'à¤¹à¤¾à¤',
    no: 'à¤¨à¤¹à¥à¤',
    close: 'à¤¬à¤à¤¦ à¤à¤°à¥à¤',
    back: 'à¤µà¤¾à¤ªà¤¸',
    next: 'à¤à¤à¤²à¤¾',
    previous: 'à¤ªà¤¿à¤à¤²à¤¾',
    submit: 'à¤à¤®à¤¾ à¤à¤°à¥à¤',
    reset: 'à¤°à¥à¤¸à¥à¤',
    clear: 'à¤¸à¤¾à¤«à¤¼ à¤à¤°à¥à¤'
  },
  
  nav: {
    dashboard: 'à¤¡à¥à¤¶à¤¬à¥à¤°à¥à¤¡',
    customers: 'à¤à¥à¤°à¤¾à¤¹à¤',
    products: 'à¤à¤¤à¥à¤ªà¤¾à¤¦',
    bookings: 'à¤¬à¥à¤à¤¿à¤à¤',
    invoices: 'à¤à¤¾à¤²à¤¾à¤¨',
    calendar: 'à¤à¥à¤²à¥à¤à¤¡à¤°',
    reports: 'à¤°à¤¿à¤ªà¥à¤°à¥à¤',
    notes: 'à¤¨à¥à¤à¥à¤¸',
    settings: 'à¤¸à¥à¤à¤¿à¤à¤à¥à¤¸'
  },
  
  dashboard: {
    title: 'à¤¡à¥à¤¶à¤¬à¥à¤°à¥à¤¡',
    welcome: 'Xnoll Booking Desktop à¤®à¥à¤ à¤à¤ªà¤à¤¾ à¤¸à¥à¤µà¤¾à¤à¤¤ à¤¹à¥',
    overview: 'à¤à¤µà¤²à¥à¤à¤¨'
  },
  
  customers: {
    title: 'à¤à¥à¤°à¤¾à¤¹à¤',
    addNew: 'à¤¨à¤¯à¤¾ à¤à¥à¤°à¤¾à¤¹à¤',
    name: 'à¤¨à¤¾à¤®',
    phone: 'à¤«à¤¼à¥à¤¨',
    email: 'à¤à¤®à¥à¤²'
  },
  
  settings: {
    title: 'à¤¸à¥à¤à¤¿à¤à¤à¥à¤¸',
    language: 'à¤­à¤¾à¤·à¤¾',
    selectLanguage: 'à¤­à¤¾à¤·à¤¾ à¤à¥à¤¨à¥à¤'
  }
};

// Gujarati translations
const gu = {
  common: {
    save: 'àª¸àª¾àªàªµà«',
    cancel: 'àª°àª¦ àªàª°à«',
    delete: 'àªàª¾àª¢à« àª¨àª¾àªà«',
    edit: 'àª¸àªàªªàª¾àª¦àª¿àª¤ àªàª°à«',
    add: 'àªàª®à«àª°à«',
    search: 'àª¶à«àª§à«'
  },
  
  nav: {
    dashboard: 'àª¡à«àª¶àª¬à«àª°à«àª¡',
    customers: 'àªà«àª°àª¾àª¹àªà«',
    products: 'àªàª¤à«àªªàª¾àª¦àª¨à«',
    bookings: 'àª¬à«àªàª¿àªàª',
    settings: 'àª¸à«àªàª¿àªàªà«àª¸'
  }
};

// Marathi translations
const mr = {
  common: {
    save: 'à¤à¤¤à¤¨ à¤à¤°à¤¾',
    cancel: 'à¤°à¤¦à¥à¤¦ à¤à¤°à¤¾',
    delete: 'à¤¹à¤à¤µà¤¾',
    edit: 'à¤¸à¤à¤ªà¤¾à¤¦à¤¿à¤¤ à¤à¤°à¤¾',
    add: 'à¤à¥à¤¡à¤¾',
    search: 'à¤¶à¥à¤§à¤¾'
  },
  
  nav: {
    dashboard: 'à¤¡à¥à¤¶à¤¬à¥à¤°à¥à¤¡',
    customers: 'à¤à¥à¤°à¤¾à¤¹à¤',
    products: 'à¤à¤¤à¥à¤ªà¤¾à¤¦à¤¨à¥',
    bookings: 'à¤¬à¥à¤à¤¿à¤à¤',
    settings: 'à¤¸à¥à¤à¤¿à¤à¤à¥à¤'
  }
};

// Tamil translations
const ta = {
  common: {
    save: 'à®à¯à®®à®¿',
    cancel: 'à®°à®¤à¯à®¤à¯ à®à¯à®¯à¯',
    delete: 'à®à®´à®¿',
    edit: 'à®¤à®¿à®°à¯à®¤à¯à®¤à¯',
    add: 'à®à¯à®°à¯',
    search: 'à®¤à¯à®à¯'
  },
  
  nav: {
    dashboard: 'à®®à¯à®à®ªà¯à®ªà¯',
    customers: 'à®µà®¾à®à®¿à®à¯à®à¯à®¯à®¾à®³à®°à¯à®à®³à¯',
    products: 'à®¤à®¯à®¾à®°à®¿à®ªà¯à®ªà¯à®à®³à¯',
    bookings: 'à®ªà®¤à®¿à®µà¯à®à®³à¯',
    settings: 'à®à®®à¯à®ªà¯à®ªà¯à®à®³à¯'
  }
};

// Telugu translations
const te = {
  common: {
    save: 'à°¸à±à°µà± à°à±à°¯à°à°¡à°¿',
    cancel: 'à°°à°¦à±à°¦à± à°à±à°¯à°à°¡à°¿',
    delete: 'à°¤à±à°²à°à°¿à°à°à±',
    edit: 'à°¸à°µà°°à°¿à°à°à±',
    add: 'à°à±à°¡à°¿à°à°à±',
    search: 'à°µà±à°¤à°à°à°¡à°¿'
  },
  
  nav: {
    dashboard: 'à°¡à°¾à°·à±âà°¬à±à°°à±à°¡à±',
    customers: 'à°à°¸à±à°à°®à°°à±à°²à±',
    products: 'à°à°¤à±à°ªà°¤à±à°¤à±à°²à±',
    bookings: 'à°¬à±à°à°¿à°à°à±âà°²à±',
    settings: 'à°¸à±à°à±à°à°¿à°à°à±à°²à±'
  }
};

const translations = {
  en,
  hi,
  gu,
  mr,
  ta,
  te
};

export default translations;

===============================
FILE: src/i18n/i18nContext.jsx
===============================
import React, { createContext, useContext, useState, useEffect } from 'react';
import translations from './translations';

const I18nContext = createContext();

export const useTranslation = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useTranslation must be used within I18nProvider');
  }
  return context;
};

export const I18nProvider = ({ children }) => {
  const [language, setLanguage] = useState('en');

  useEffect(() => {
    // Load saved language from localStorage
    const savedLang = localStorage.getItem('app_language');
    if (savedLang && translations[savedLang]) {
      setLanguage(savedLang);
    }
  }, []);

  const changeLanguage = (lang) => {
    if (translations[lang]) {
      setLanguage(lang);
      localStorage.setItem('app_language', lang);
      // Also save to settings if available
      if (window.xnoll) {
        window.xnoll.settingsSave({ language: lang });
      }
    }
  };

  const t = (key, params = {}) => {
    const keys = key.split('.');
    let value = translations[language];

    for (const k of keys) {
      if (value && value[k]) {
        value = value[k];
      } else {
        // Fallback to English
        value = translations.en;
        for (const k2 of keys) {
          if (value && value[k2]) {
            value = value[k2];
          } else {
            return key; // Return key if not found
          }
        }
        break;
      }
    }

    // Replace parameters
    if (typeof value === 'string') {
      Object.keys(params).forEach((param) => {
        value = value.replace(`{{${param}}}`, params[param]);
      });
    }

    return value || key;
  };

  const availableLanguages = [
    { code: 'en', name: 'English', nativeName: 'English' },
    { code: 'hi', name: 'Hindi', nativeName: 'à¤¹à¤¿à¤¨à¥à¤¦à¥' },
    { code: 'gu', name: 'Gujarati', nativeName: 'àªà«àªàª°àª¾àª¤à«' },
    { code: 'mr', name: 'Marathi', nativeName: 'à¤®à¤°à¤¾à¤ à¥' },
    { code: 'ta', name: 'Tamil', nativeName: 'à®¤à®®à®¿à®´à¯' },
    { code: 'te', name: 'Telugu', nativeName: 'à°¤à±à°²à±à°à±' }
  ];

  return (
    <I18nContext.Provider
      value={{
        language,
        changeLanguage,
        t,
        availableLanguages
      }}
    >
      {children}
    </I18nContext.Provider>
  );
};

===============================
FILE: src/pages/Booking/index.jsx
===============================
import React, { useEffect, useMemo, useRef, useState } from "react";
import CustomFieldRenderer from "../../components/CustomField/CustomFieldRenderer";

const STATUS_OPTIONS = ["pending", "confirmed", "completed", "cancelled"];
const PAGE_SIZE = 10;

const emptyForm = {
  id: null,
  customer_id: "",
  booking_date: "",
  status: "pending",
  items: [],
};

const BookingPage = () => {
  const [bookings, setBookings] = useState([]);
  const [customers, setCustomers] = useState([]);
  const [products, setProducts] = useState([]);
  const [invoices, setInvoices] = useState([]);
  const [customFields, setCustomFields] = useState([]);
  const [customFieldValues, setCustomFieldValues] = useState({});
  const [loading, setLoading] = useState(false);

  const [search, setSearch] = useState("");
  const [statusFilter, setStatusFilter] = useState("");
  const [page, setPage] = useState(1);
  const [sortKey, setSortKey] = useState("booking_date");
  const [sortDir, setSortDir] = useState("desc");

  const [showModal, setShowModal] = useState(false);
  const [form, setForm] = useState(emptyForm);
  const [isEditing, setIsEditing] = useState(false);
  const [customerSearch, setCustomerSearch] = useState("");
  const [showCustomerDropdown, setShowCustomerDropdown] = useState(false);

  const [showInvoiceModal, setShowInvoiceModal] = useState(false);
  const [selectedBooking, setSelectedBooking] = useState(null);

  const emptyItem = { product_id: "", qty: 1, unit_price: 0 };
  const [items, setItems] = useState([]);
  const customerInputRef = useRef(null);

  // Check for prefilled date from calendar
  useEffect(() => {
    const prefillDate = localStorage.getItem("prefillBookingDate");
    if (prefillDate) {
      localStorage.removeItem("prefillBookingDate");
      const dateObj = new Date(prefillDate);
      const formattedDate = dateObj.toISOString().slice(0, 16); // YYYY-MM-DDTHH:mm format

      setForm((prev) => ({
        ...prev,
        booking_date: formattedDate,
      }));
      setShowModal(true);
    }
  }, []);

  const loadAll = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const [
        bookingRows,
        customerRows,
        productRows,
        invoiceRows,
        customFieldsRows,
      ] = await Promise.all([
        window.xnoll.bookingsList(1, 20),
        window.xnoll.customersList(),
        window.xnoll.productsList(),
        window.xnoll.invoicesList(),
        window.xnoll.customFieldsList("bookings"),
      ]);
      setBookings(bookingRows);
      setCustomers(customerRows);
      setProducts(productRows);
      setInvoices(invoiceRows);
      // Ensure customFieldsRows is an array, even if the API call fails
      const safeCustomFields = Array.isArray(customFieldsRows)
        ? customFieldsRows
        : customFieldsRows &&
            typeof customFieldsRows === "object" &&
            Array.isArray(customFieldsRows)
          ? customFieldsRows
          : [];
      setCustomFields(safeCustomFields);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadAll();
  }, []);

  const filteredCustomers = useMemo(() => {
    const term = customerSearch.trim().toLowerCase();
    if (!term) return customers;
    return customers.filter((c) => {
      return (
        (c.name || "").toLowerCase().includes(term) ||
        (c.phone || "").toLowerCase().includes(term) ||
        String(c.id || "").includes(term)
      );
    });
  }, [customers, customerSearch]);

  // maps for quick lookup
  const customerMap = useMemo(() => {
    const m = {};
    customers.forEach((c) => {
      m[c.id] = c;
    });
    return m;
  }, [customers]);

  const invoiceMap = useMemo(() => {
    const m = {};
    invoices.forEach((inv) => {
      if (!m[inv.customer_id]) m[inv.customer_id] = [];
      m[inv.customer_id].push(inv);
    });
    return m;
  }, [invoices]);

  // attach display names
  const enrichedBookings = useMemo(
    () =>
      bookings.map((b) => {
        const cust = customerMap[b.customer_id];
        return {
          ...b,
          customer_name: cust ? cust.name : `#${b.customer_id || "-"}`,
        };
      }),
    [bookings, customerMap]
  );

  const productMap = useMemo(() => {
    const m = {};
    products.forEach((p) => {
      m[p.id] = p;
    });
    return m;
  }, [products]);

  const filtered = useMemo(() => {
    const term = search.trim().toLowerCase();
    let data = [...enrichedBookings];

    // status filter first
    if (statusFilter) {
      data = data.filter((b) => (b.status || "") === statusFilter);
    }

    // 1) Filter by term if present
    if (term) {
      data = data.filter((b) => {
        // 1ï¸â£ basic booking fields
        if (
          String(b.id || "").includes(term) ||
          (b.customer_name || "").toLowerCase().includes(term)
        ) {
          return true;
        }

        // 2ï¸â£ search in items â product names
        if (Array.isArray(b.items) && b.items.length) {
          for (const it of b.items) {
            const productName = productMap[it.product_id]?.name;
            if (productName && productName.toLowerCase().includes(term)) {
              return true;
            }
          }
        }

        // 3ï¸â£ custom fields
        if (b.custom_fields && Array.isArray(customFields)) {
          for (const field of customFields) {
            if (!field.searchable) continue;
            const value = b.custom_fields[field.name];
            if (
              value !== undefined &&
              String(value).toLowerCase().includes(term)
            ) {
              return true;
            }
          }
        }

        return false;
      });
    }

    // 2) Sorting â always apply
    const getSortValue = (row, key) => {
      if (!key) return "";

      let value = "";

      if (row[key] !== undefined && row[key] !== null) {
        value = row[key];
      } else if (row.custom_fields && row.custom_fields[key] !== undefined) {
        value = row.custom_fields[key];
      }

      // normalize
      if (value === null || value === undefined) return "";
      return value;
    };

    data.sort((a, b) => {
      let va = getSortValue(a, sortKey);
      let vb = getSortValue(b, sortKey);

      // numeric compare when both look numeric
      const na = parseFloat(va);
      const nb = parseFloat(vb);
      const bothNumbers =
        String(va).trim() !== "" &&
        String(vb).trim() !== "" &&
        !Number.isNaN(na) &&
        !Number.isNaN(nb);

      if (bothNumbers) {
        if (na < nb) return sortDir === "asc" ? -1 : 1;
        if (na > nb) return sortDir === "asc" ? 1 : -1;
        return 0;
      }

      va = String(va).toLowerCase();
      vb = String(vb).toLowerCase();

      if (va < vb) return sortDir === "asc" ? -1 : 1;
      if (va > vb) return sortDir === "asc" ? 1 : -1;
      return 0;
    });

    return data;
  }, [enrichedBookings, customFields, search, statusFilter, sortKey, sortDir]);

  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  const currentPage = Math.min(page, totalPages);

  const pageData = useMemo(() => {
    const start = (currentPage - 1) * PAGE_SIZE;
    return filtered.slice(start, start + PAGE_SIZE);
  }, [filtered, currentPage]);

  const formatDate = (dateStr) => {
    if (!dateStr) return "";
    return dateStr.slice(0, 10); // YYYY-MM-DD
  };

  const getStatusBadge = (status) => {
    const s = status || "pending";
    const cap = s.charAt(0).toUpperCase() + s.slice(1);
    let bgClass = "bg-secondary";
    if (s === "pending") bgClass = "bg-warning text-dark";
    else if (s === "confirmed") bgClass = "bg-info";
    else if (s === "completed") bgClass = "bg-success";
    else if (s === "cancelled") bgClass = "bg-danger";
    return <span className={`badge ${bgClass}`}>{cap}</span>;
  };

  const handleSort = (key) => {
    if (sortKey === key) {
      setSortDir((d) => (d === "asc" ? "desc" : "asc"));
    } else {
      setSortKey(key);
      setSortDir("asc");
    }
  };

  const sortIcon = (key) => {
    if (sortKey !== key) return "";
    return sortDir === "asc" ? "â²" : "â¼";
  };

  const goToPage = (p) => {
    if (p < 1 || p > totalPages) return;
    setPage(p);
  };

  const addItem = () => {
    setItems((prev) => [...prev, { product_id: "", qty: 1, unit_price: 0 }]);
  };

  const updateItem = (index, key, value) => {
    setItems((prev) => {
      const copy = [...prev];

      // if changing product, prevent duplicates
      if (key === "product_id") {
        const newPid = String(value);
        // check other items for same product
        const duplicateIndex = copy.findIndex(
          (it, i) =>
            i !== index && String(it.product_id) === newPid && newPid !== ""
        );
        if (duplicateIndex !== -1) {
          alert(
            "This product is already selected in another line. Please pick a different product."
          );
          return prev; // no change
        }
      }

      // update the item
      const existing = copy[index] || { product_id: "", qty: 1, unit_price: 0 };
      copy[index] = { ...existing, [key]: value };

      // when product selected, set unit price automatically
      if (key === "product_id") {
        const p = products.find((x) => String(x.id) === String(value));
        if (p) copy[index].unit_price = Number(p.price || 0);
        else copy[index].unit_price = 0;
      }

      // ensure qty stays a number (and at least 1)
      if (key === "qty") {
        const n = Number(value || 0);
        copy[index].qty = n <= 0 ? 1 : n;
      }

      return copy;
    });
  };

  const removeItem = (index) => {
    setItems((prev) => prev.filter((_, i) => i !== index));
  };

  // ---------- form / modal ----------
  const resetForm = () => {
    setForm(emptyForm);
    setItems([]);
    setIsEditing(false);
    setCustomFieldValues({});
  };

  const openNewModal = () => {
    resetForm();
    setCustomerSearch("");
    setShowModal(true);
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleCustomFieldChange = (fieldName, value) => {
    setCustomFieldValues((prev) => ({ ...prev, [fieldName]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;

    const payload = {
      id: form.id,
      customer_id: Number(form.customer_id) || null,
      booking_date: form.booking_date.trim(),
      status: form.status || "pending",
      items: items.map((i, idx) => ({
        product_id: Number(i.product_id),
        qty: Number(i.qty || 1),
        unit_price: Number(i.unit_price || 0),
        line_total: Number(i.unit_price || 0) * Number(i.qty || 1),
      })),
    };

    // Validation
    if (!payload.customer_id) {
      alert("Please select a customer.");
      return;
    }
    if (!payload.booking_date) {
      alert("Please select a date & time.");
      return;
    }
    if (!payload.items || payload.items.length === 0) {
      alert("Please add at least one item.");
      return;
    }

    // ensure no empty or duplicate product ids
    const seen = new Set();
    for (let idx = 0; idx < payload.items.length; idx++) {
      const it = payload.items[idx];
      if (!it.product_id) {
        alert(`Please select a product for item ${idx + 1}.`);
        return;
      }
      if (seen.has(it.product_id)) {
        alert(
          `Duplicate product selected for item ${idx + 1}. Please choose a different product.`
        );
        return;
      }
      seen.add(it.product_id);
    }

    setLoading(true);
    try {
      let result;
      if (isEditing && payload.id != null) {
        result = await window.xnoll.bookingsUpdate(payload);
      } else {
        result = await window.xnoll.bookingsCreate(payload);
      }

      // Save custom field values
      if (customFields.length > 0 && (result?.id || payload.id)) {
        const recordId = result?.id || payload.id;
        for (const field of customFields) {
          await window.xnoll.customFieldValuesSave({
            field_id: field.id,
            record_id: recordId,
            value: customFieldValues[field.name] ?? field.default_value ?? "",
          });
        }
      }

      resetForm();
      setShowModal(false);
      await loadAll();
    } catch (err) {
      console.error("Error saving booking:", err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = async (b) => {
    const full = await window.xnoll.getBookingsById(b.id);
    setForm({
      id: full.id,
      customer_id: full.customer_id || "",
      booking_date: full.booking_date || "",
      status: full.status || "pending",
    });

    setItems(
      Array.isArray(full.items)
        ? full.items.map((i) => ({
            product_id: i.product_id,
            qty: Number(i.qty || 1),
            unit_price: Number(i.unit_price || 0),
            line_total: Number(
              i.line_total || Number(i.unit_price || 0) * Number(i.qty || 1)
            ),
          }))
        : []
    );

    setCustomerSearch(
      full.customer_name
        ? `${full.customer_name} (ID: ${full.customer_id})`
        : ""
    );

    setIsEditing(true);
    setShowModal(true);
  };

  const handleDelete = async (id) => {
    if (!window.xnoll) return;
    if (!window.confirm("Delete this booking?")) return;

    setLoading(true);
    try {
      await window.xnoll.bookingsDelete(id);
      await loadAll();
    } catch (err) {
      console.error("Error deleting booking:", err);
    } finally {
      setLoading(false);
    }
  };

  const handleGenerateInvoice = (booking) => {
    setSelectedBooking(booking);
    setShowInvoiceModal(true);
  };

  const handleCreateInvoice = async () => {
    if (!window.xnoll || !selectedBooking) return;

    const amount = selectedBooking.items?.reduce(
      (sum, i) =>
        sum +
        Number(i.line_total || Number(i.unit_price || 0) * Number(i.qty || 1)),
      0
    );
    const today = new Date().toISOString().slice(0, 10); // yyyy-mm-dd

    if (!selectedBooking.customer_id) {
      alert("Booking has no customer selected.");
      return;
    }

    const existingInvoices = invoiceMap[selectedBooking.customer_id] || [];
    const existing = existingInvoices.find(
      (inv) => inv.booking_id === selectedBooking.id
    );
    if (existing) {
      alert(`Invoice already generated today (ID: ${existing.id}).`);
      setShowInvoiceModal(false);
      await loadAll();
      return;
    }

    setLoading(true);
    try {
      // Build invoice payload including items
      const invoicePayload = {
        invoice: {
          invoice_number: null, // will be generated or left null
          customer_id: selectedBooking.customer_id,
          booking_id: selectedBooking.id,
          total: amount,
          discount: 0,
          invoice_date: today,
          due_date: null,
          status: "unpaid",
          notes: "",
        },
        items: (selectedBooking.items || []).map((it) => ({
          product_id: it.product_id || null,
          description: productMap[it.product_id]?.name || "",
          qty: Number(it.qty || 1),
          unit_price: Number(it.unit_price || 0),
          line_total: Number(
            it.line_total || Number(it.unit_price || 0) * Number(it.qty || 1)
          ),
        })),
      };

      const newInvoice = await window.xnoll.invoicesCreate(invoicePayload);
      // mark booking completed
      await window.xnoll.bookingsUpdate({
        id: selectedBooking.id,
        booking_date: selectedBooking.booking_date,
        status: "completed",
      });
      await loadAll();
      alert("Invoice created and booking marked as completed.");
      setShowInvoiceModal(false);
    } catch (err) {
      console.error("Error generating invoice:", err);
      alert("Failed to generate invoice. See console for details.");
      await loadAll();
    } finally {
      setLoading(false);
    }
  };

  const closeModal = () => {
    setShowModal(false);
    resetForm();
    setCustomerSearch("");
    setShowCustomerDropdown(false);
  };

  const closeInvoiceModal = () => {
    setShowInvoiceModal(false);
    setSelectedBooking(null);
  };

  return (
    <div>
      <h4 className="mb-3">Bookings</h4>

      <div className="card shadow-sm border-0 mb-3">
        <div className="card-body d-flex flex-wrap gap-2 justify-content-between align-items-center">
          <div>
            <strong>Total:</strong> {total}{" "}
            <span className="text-muted small">
              (page {currentPage} of {totalPages})
            </span>
          </div>
          <div className="d-flex flex-wrap gap-2">
            <select
              className="form-select form-select-sm"
              style={{ width: 150 }}
              value={statusFilter}
              onChange={(e) => {
                setStatusFilter(e.target.value || "");
                setPage(1);
              }}
            >
              <option value="">All status</option>
              {STATUS_OPTIONS.map((s) => (
                <option key={s} value={s}>
                  {s.charAt(0).toUpperCase() + s.slice(1)}
                </option>
              ))}
            </select>
            <input
              type="text"
              className="form-control form-control-sm"
              placeholder="Search customer / service / ID"
              style={{ minWidth: 240 }}
              value={search}
              onChange={(e) => {
                setSearch(e.target.value);
                setPage(1);
              }}
            />
            <button
              className="btn btn-sm btn-primary"
              onClick={openNewModal}
              disabled={loading}
              title={
                !customers.length ? "Add customers and products first" : ""
              }
            >
              + New Booking
            </button>
          </div>
        </div>
      </div>

      <div className="card shadow-sm border-0">
        <div className="card-body">
          {loading && <div className="text-muted small mb-2">Loading...</div>}
          <div className="table-responsive" style={{ maxHeight: "60vh" }}>
            <table className="table table-sm table-striped align-middle">
              <thead className="table-light">
                <tr>
                  <th
                    style={{ width: "60px", cursor: "pointer" }}
                    onClick={() => handleSort("id")}
                  >
                    ID {sortIcon("id")}
                  </th>
                  <th
                    style={{ width: "180px", cursor: "pointer" }}
                    onClick={() => handleSort("customer_name")}
                  >
                    Customer {sortIcon("customer_name")}
                  </th>

                  <th
                    style={{ width: "170px", cursor: "pointer" }}
                    onClick={() => handleSort("booking_date")}
                  >
                    Date/Time {sortIcon("booking_date")}
                  </th>
                  <th
                    style={{ width: "110px", cursor: "pointer" }}
                    onClick={() => handleSort("status")}
                  >
                    Status {sortIcon("status")}
                  </th>
                  {(Array.isArray(customFields)
                    ? customFields.filter((f) => f.display_in_grid)
                    : []
                  ).map((f) => (
                    <th
                      key={f.id}
                      style={{ cursor: f.sortable ? "pointer" : "default" }}
                      onClick={() => f.sortable && handleSort(f.name)}
                    >
                      {f.label} {f.sortable && sortIcon(f.name)}
                    </th>
                  ))}
                  <th style={{ width: "140px" }} className="text-end">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody>
                {pageData.map((b) => {
                  const hasInvoiceToday = invoiceMap[b.customer_id]?.some(
                    (inv) => inv.booking_id === b.id
                  );

                  return (
                    <tr key={b.id}>
                      <td>{b.id}</td>
                      <td
                        style={{
                          maxWidth: "180px",
                          overflow: "hidden",
                          textOverflow: "ellipsis",
                          whiteSpace: "nowrap",
                        }}
                      >
                        {b.customer_name}
                      </td>
                      <td className="small text-muted">â</td>
                      <td>{formatDate(b.booking_date)}</td>
                      <td>{getStatusBadge(b.status)}</td>
                      {(Array.isArray(customFields)
                        ? customFields.filter((f) => f.display_in_grid)
                        : []
                      ).map((f) => (
                        <td key={f.id}>
                          {b.custom_fields?.[f.name] ?? f.default_value ?? "-"}
                        </td>
                      ))}
                      <td className="text-end">
                        <div className="d-flex justify-content-end gap-1 flex-wrap">
                          <button
                            className="btn btn-sm btn-outline-primary"
                            disabled={loading}
                            onClick={() => handleEdit(b)}
                          >
                            Edit
                          </button>
                          <button
                            className="btn btn-sm btn-outline-success"
                            disabled={loading || hasInvoiceToday}
                            onClick={() => handleGenerateInvoice(b)}
                            title={
                              hasInvoiceToday
                                ? "Invoice already generated today"
                                : ""
                            }
                          >
                            {hasInvoiceToday ? "Invoiced" : "Invoice"}
                          </button>
                          <button
                            className="btn btn-sm btn-outline-danger"
                            disabled={loading}
                            onClick={() => handleDelete(b.id)}
                          >
                            Del
                          </button>
                        </div>
                      </td>
                    </tr>
                  );
                })}
                {!pageData.length && !loading && (
                  <tr>
                    <td
                      colSpan={
                        6 +
                        (Array.isArray(customFields)
                          ? customFields.filter((f) => f.display_in_grid).length
                          : 0)
                      }
                      className="text-center text-muted"
                    >
                      No bookings found.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>

          {totalPages > 1 && (
            <div className="d-flex justify-content-between align-items-center mt-2">
              <small className="text-muted">
                Showing {(currentPage - 1) * PAGE_SIZE + 1}â
                {Math.min(currentPage * PAGE_SIZE, total)} of {total}
              </small>
              <nav>
                <ul className="pagination pagination-sm mb-0">
                  <li
                    className={`page-item ${
                      currentPage === 1 ? "disabled" : ""
                    }`}
                  >
                    <button
                      className="page-link"
                      onClick={() =>
                        currentPage > 1 && goToPage(currentPage - 1)
                      }
                      disabled={currentPage === 1}
                    >
                      Prev
                    </button>
                  </li>
                  <li className="page-item active">
                    <span className="page-link">{currentPage}</span>
                  </li>
                  <li
                    className={`page-item ${
                      currentPage === totalPages ? "disabled" : ""
                    }`}
                  >
                    <button
                      className="page-link"
                      onClick={() =>
                        currentPage < totalPages && goToPage(currentPage + 1)
                      }
                      disabled={currentPage === totalPages}
                    >
                      Next
                    </button>
                  </li>
                </ul>
              </nav>
            </div>
          )}
        </div>
      </div>

      {/* Booking Modal */}
      {showModal && (
        <>
          <div
            className="modal fade show d-block"
            tabIndex="-1"
            role="dialog"
            style={{ zIndex: 1050 }}
            onClick={closeModal}
          >
            <div
              className="modal-dialog modal-dialog-centered"
              style={{ maxWidth: "480px" }}
              onClick={(e) => e.stopPropagation()}
            >
              <div className="modal-content">
                <form onSubmit={handleSubmit}>
                  <div className="modal-header">
                    <h5 className="modal-title">
                      {isEditing ? "Edit Booking" : "New Booking"}
                    </h5>
                    <button
                      type="button"
                      className="btn-close"
                      onClick={closeModal}
                      disabled={loading}
                    />
                  </div>
                  <div className="modal-body">
                    <div className="mb-2">
                      <label className="form-label mb-0 small">
                        Customer *
                      </label>
                      <div className="position-relative mb-1">
                        <input
                          ref={customerInputRef}
                          type="text"
                          className="form-control form-control-sm"
                          placeholder="Search by name / phone / ID"
                          value={customerSearch}
                          onChange={(e) => {
                            setCustomerSearch(e.target.value);
                            setShowCustomerDropdown(true);
                          }}
                          onFocus={() => setShowCustomerDropdown(true)}
                          onBlur={() =>
                            setTimeout(
                              () => setShowCustomerDropdown(false),
                              150
                            )
                          }
                          disabled={loading || !customers.length}
                        />
                        {showCustomerDropdown &&
                          filteredCustomers.length > 0 && (
                            <div
                              className="position-absolute top-100 start-0 w-100 bg-white border shadow-sm"
                              style={{
                                zIndex: 10,
                                maxHeight: "150px",
                                overflowY: "auto",
                              }}
                            >
                              {filteredCustomers.slice(0, 10).map((c) => (
                                <div
                                  key={c.id}
                                  className="p-2 border-bottom small"
                                  style={{ cursor: "pointer" }}
                                  onMouseDown={(e) => e.preventDefault()}
                                  onClick={() => {
                                    setForm((prev) => ({
                                      ...prev,
                                      customer_id: c.id,
                                    }));
                                    setCustomerSearch(
                                      `${c.name}${
                                        c.phone ? ` - ${c.phone}` : ""
                                      } (ID: ${c.id})`
                                    );
                                    setShowCustomerDropdown(false);
                                  }}
                                >
                                  <div className="fw-bold">{c.name}</div>
                                  <small className="text-muted">
                                    {c.phone || "No phone"} â¢ ID: {c.id}
                                  </small>
                                </div>
                              ))}
                              {filteredCustomers.length > 10 && (
                                <div className="p-2 small text-muted">
                                  ... and {filteredCustomers.length - 10} more
                                </div>
                              )}
                            </div>
                          )}
                      </div>
                      <small className="text-muted">
                        {form.customer_id
                          ? `Selected: ${customerMap[form.customer_id]?.name || "Unknown"}`
                          : "No customer selected"}
                      </small>
                    </div>

                    <div className="mb-2">
                      <label className="form-label small">Items *</label>

                      {items.map((it, idx) => (
                        <div key={idx} className="d-flex gap-1 mb-1">
                          <select
                            className="form-select form-select-sm"
                            value={it.product_id}
                            onChange={(e) =>
                              updateItem(idx, "product_id", e.target.value)
                            }
                          >
                            <option value="">Select product</option>
                            {products.map((p) => (
                              <option key={p.id} value={p.id}>
                                {p.name} - â¹{p.price}
                              </option>
                            ))}
                          </select>

                          <input
                            type="number"
                            className="form-control form-control-sm"
                            value={it.qty}
                            min="1"
                            onChange={(e) =>
                              updateItem(idx, "qty", e.target.value)
                            }
                            readOnly
                            style={{ width: 70 }}
                          />

                          <button
                            type="button"
                            className="btn btn-sm btn-outline-danger"
                            onClick={() => removeItem(idx)}
                          >
                            Ã
                          </button>
                        </div>
                      ))}

                      <button
                        type="button"
                        className="btn btn-sm btn-outline-primary mt-1"
                        onClick={addItem}
                      >
                        + Add Item
                      </button>
                    </div>

                    <div className="mb-2">
                      <label className="form-label mb-0 small">
                        Date &amp; Time *
                      </label>
                      <input
                        type="datetime-local"
                        className="form-control form-control-sm"
                        name="booking_date"
                        value={form.booking_date}
                        onChange={handleChange}
                        required
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-0">
                      <label className="form-label mb-0 small">Status</label>
                      <select
                        className="form-select form-select-sm"
                        name="status"
                        value={form.status}
                        onChange={handleChange}
                        disabled={loading}
                      >
                        {STATUS_OPTIONS.map((s) => (
                          <option key={s} value={s}>
                            {s.charAt(0).toUpperCase() + s.slice(1)}
                          </option>
                        ))}
                      </select>
                    </div>

                    {customFields.length > 0 && (
                      <div className="mt-3">
                        <CustomFieldRenderer
                          fields={customFields}
                          values={customFieldValues}
                          onChange={(name, value) =>
                            setCustomFieldValues((prev) => ({
                              ...prev,
                              [name]: value,
                            }))
                          }
                          loading={loading}
                        />
                      </div>
                    )}
                  </div>
                  <div className="modal-footer">
                    <button
                      type="button"
                      className="btn btn-sm btn-outline-secondary"
                      onClick={closeModal}
                      disabled={loading}
                    >
                      Close
                    </button>
                    <button
                      type="submit"
                      className="btn btn-sm btn-primary"
                      disabled={loading}
                    >
                      {isEditing ? "Update" : "Save"}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div
            className="modal-backdrop fade show"
            style={{ zIndex: 1040 }}
            onClick={closeModal}
          />
        </>
      )}

      {/* Invoice Confirmation Modal */}
      {showInvoiceModal && selectedBooking && (
        <>
          <div
            className="modal fade show d-block"
            tabIndex="-1"
            role="dialog"
            style={{ zIndex: 1050 }}
            onClick={closeInvoiceModal}
          >
            <div
              className="modal-dialog modal-dialog-centered modal-sm"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="modal-content">
                <div className="modal-header">
                  <h5 className="modal-title">Generate Invoice</h5>
                  <button
                    type="button"
                    className="btn-close"
                    onClick={closeInvoiceModal}
                    disabled={loading}
                  />
                </div>
                <div className="modal-body">
                  <p>
                    <strong>Customer:</strong> {selectedBooking.customer_name}
                  </p>

                  <p>
                    <strong>Amount:</strong> â¹
                    {selectedBooking.items
                      ?.reduce((sum, i) => sum + Number(i.line_total || 0), 0)
                      .toFixed(2)}
                  </p>
                  <p className="small text-muted">
                    This will mark the booking as completed.
                  </p>
                </div>
                <div className="modal-footer">
                  <button
                    type="button"
                    className="btn btn-sm btn-outline-secondary"
                    onClick={closeInvoiceModal}
                    disabled={loading}
                  >
                    Cancel
                  </button>
                  <button
                    type="button"
                    className="btn btn-sm btn-primary"
                    onClick={handleCreateInvoice}
                    disabled={loading}
                  >
                    {loading ? "Generating..." : "Generate"}
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div
            className="modal-backdrop fade show"
            style={{ zIndex: 1040 }}
            onClick={closeInvoiceModal}
          />
        </>
      )}
    </div>
  );
};

export default BookingPage;


===============================
FILE: src/pages/Customers/index.jsx
===============================
import React, { useEffect, useMemo, useState } from "react";
import CustomFieldRenderer from "../../components/CustomField/CustomFieldRenderer";
import Pagination from "../../components/common/Pagination";

const emptyForm = { id: null, name: "", phone: "", email: "" };

const PAGE_SIZE = 10;

const Customers = () => {
  const [customers, setCustomers] = useState([]);
  const [customFields, setCustomFields] = useState([]);
  const [customFieldValues, setCustomFieldValues] = useState({});
  const [form, setForm] = useState(emptyForm);
  const [isEditing, setIsEditing] = useState(false);
  const [loading, setLoading] = useState(false);

  const [search, setSearch] = useState("");
  const [page, setPage] = useState(1);
  const [pageSize, setPageSize] = useState(10);
  const [sortKey, setSortKey] = useState("id");
  const [sortDir, setSortDir] = useState("desc"); // 'asc' | 'desc'

  const [showModal, setShowModal] = useState(false);

  const loadCustomers = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const [rows, fields] = await Promise.all([
        window.xnoll.customersList(),
        window.xnoll.customFieldsList("customers"),
      ]);
      setCustomers(rows || []);
      setCustomFields(fields || []);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadCustomers();
  }, []);

  // ----- Filters, sorting, pagination -----
  const getSortValue = (row, sortKey) => {
    if (!sortKey) return "";

    // 1ï¸â£ root column
    if (row[sortKey] !== undefined && row[sortKey] !== null) {
      return row[sortKey];
    }

    // 2ï¸â£ custom field
    if (row.custom_fields && row.custom_fields[sortKey] !== undefined) {
      return row.custom_fields[sortKey];
    }

    return "";
  };

  const filtered = useMemo(() => {
    const term = search.trim().toLowerCase();
    let data = [...customers];

    // 1) Filter by term if present
    if (term) {
      data = data.filter((c) => {
        // base fields
        const baseMatch =
          (c.name || "").toLowerCase().includes(term) ||
          (c.phone || "").toLowerCase().includes(term) ||
          (c.email || "").toLowerCase().includes(term);

        if (baseMatch) return true;

        // searchable custom fields
        if (c.custom_fields && Array.isArray(customFields)) {
          for (const field of customFields) {
            if (!field.searchable) continue;
            const value = c.custom_fields[field.name];
            if (
              value !== undefined &&
              String(value).toLowerCase().includes(term)
            ) {
              return true;
            }
          }
        }

        return false;
      });
    }

    // 2) Sorting â always apply sorting even when no search term
    const getSortValue = (row, key) => {
      if (!key) return "";

      // root property
      if (row[key] !== undefined && row[key] !== null) return row[key];

      // custom field fallback
      if (row.custom_fields && row.custom_fields[key] !== undefined) {
        return row.custom_fields[key];
      }

      return "";
    };

    data.sort((a, b) => {
      let va = getSortValue(a, sortKey);
      let vb = getSortValue(b, sortKey);

      // Try numeric compare when both are numeric-like
      const na = parseFloat(va);
      const nb = parseFloat(vb);
      const bothNumbers =
        String(va).trim() !== "" &&
        String(vb).trim() !== "" &&
        !Number.isNaN(na) &&
        !Number.isNaN(nb);

      if (bothNumbers) {
        if (na < nb) return sortDir === "asc" ? -1 : 1;
        if (na > nb) return sortDir === "asc" ? 1 : -1;
        return 0;
      }

      // String compare (case-insensitive)
      va = String(va).toLowerCase();
      vb = String(vb).toLowerCase();

      if (va < vb) return sortDir === "asc" ? -1 : 1;
      if (va > vb) return sortDir === "asc" ? 1 : -1;
      return 0;
    });

    return data;
  }, [customers, customFields, search, sortKey, sortDir]);

  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  const currentPage = Math.min(page, totalPages);

  const pageData = useMemo(() => {
    const start = (currentPage - 1) * pageSize;
    return filtered.slice(start, start + pageSize);
  }, [filtered, currentPage, pageSize]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const resetForm = () => {
    setForm(emptyForm);
    setCustomFieldValues({});
    setIsEditing(false);
  };

  const openNewModal = () => {
    resetForm();
    setShowModal(true);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;

    const payload = {
      id: form.id,
      name: form.name.trim(),
      phone: form.phone.trim(),
      email: form.email.trim(),
    };

    if (!payload.name) return;

    setLoading(true);
    try {
      let customerId;
      if (isEditing && payload.id != null) {
        await window.xnoll.customersUpdate(payload);
        customerId = payload.id;
      } else {
        const result = await window.xnoll.customersCreate(payload);
        customerId = result.id;
      }

      // Save custom field values
      if (customFields.length > 0 && customerId) {
        for (const field of customFields) {
          const value = customFieldValues[field.name];
          if (value !== undefined && value !== "") {
            await window.xnoll.customFieldValuesSave({
              field_id: field.id,
              record_id: customerId,
              value: String(value),
            });
          }
        }
      }

      resetForm();
      setShowModal(false);
      await loadCustomers();
    } catch (error) {
      console.error("Error saving customer:", error);
      // Optionally show user-facing error
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = async (customer) => {
    setForm({
      id: customer.id,
      name: customer.name || "",
      phone: customer.phone || "",
      email: customer.email || "",
    });

    // Load custom field values for this customer
    if (customFields.length > 0) {
      try {
        const values = {};
        for (const field of customFields) {
          const result = await window.xnoll.customFieldValuesGet(
            field.id,
            customer.id
          );
          if (result && result.value !== undefined) {
            values[field.name] = result.value;
          }
        }
        setCustomFieldValues(values);
      } catch (err) {
        console.error("Failed to load custom field values:", err);
      }
    }

    setIsEditing(true);
    setShowModal(true);
  };

  const handleDelete = async (id) => {
    if (!window.xnoll) return;
    if (!window.confirm("Delete this customer?")) return;

    setLoading(true);
    try {
      await window.xnoll.customersDelete(id);
      await loadCustomers();
    } catch (error) {
      console.error("Error deleting customer:", error);
      // Optionally show user-facing error
    } finally {
      setLoading(false);
    }
  };

  const handleSort = (key) => {
    if (sortKey === key) {
      setSortDir((d) => (d === "asc" ? "desc" : "asc"));
    } else {
      setSortKey(key);
      setSortDir("asc");
    }
  };

  const sortIcon = (key) => {
    if (sortKey !== key) return "";
    return sortDir === "asc" ? "â²" : "â¼";
  };

  const goToPage = (p) => {
    if (p < 1 || p > totalPages) return;
    setPage(p);
  };

  const closeModal = () => {
    setShowModal(false);
    resetForm();
  };

  return (
    <div>
      <h4 className="mb-3">Customers</h4>

      <div className="card shadow-sm border-0 mb-3">
        <div className="card-body d-flex flex-wrap gap-2 justify-content-between align-items-center">
          <div>
            <strong>Total:</strong> {total}{" "}
            <span className="text-muted small">
              (page {currentPage} of {totalPages})
            </span>
          </div>
          <div className="d-flex gap-2">
            <input
              type="text"
              className="form-control form-control-sm"
              placeholder="Search name / phone / email"
              style={{ minWidth: 220 }}
              value={search}
              onChange={(e) => {
                setSearch(e.target.value);
                setPage(1);
              }}
            />
            <button className="btn btn-sm btn-primary" onClick={openNewModal}>
              + New Customer
            </button>
          </div>
        </div>
      </div>

      <div className="card shadow-sm border-0">
        <div className="card-body">
          {loading && <div className="text-muted small mb-2">Loading...</div>}
          <div className="table-responsive" style={{ maxHeight: "60vh" }}>
            <table className="table table-sm table-striped align-middle">
              <thead className="table-light">
                <tr>
                  <th
                    style={{ width: "60px", cursor: "pointer" }}
                    onClick={() => handleSort("id")}
                  >
                    ID {sortIcon("id")}
                  </th>
                  <th
                    style={{ cursor: "pointer" }}
                    onClick={() => handleSort("name")}
                  >
                    Name {sortIcon("name")}
                  </th>
                  <th
                    style={{ width: "140px", cursor: "pointer" }}
                    onClick={() => handleSort("phone")}
                  >
                    Phone {sortIcon("phone")}
                  </th>
                  <th
                    style={{ width: "200px", cursor: "pointer" }}
                    onClick={() => handleSort("email")}
                  >
                    Email {sortIcon("email")}
                  </th>
                  {(Array.isArray(customFields)
                    ? customFields.filter((f) => f.display_in_grid)
                    : []
                  ).map((f) => (
                    <th
                      key={f.id}
                      style={{ cursor: f.sortable ? "pointer" : "default" }}
                      onClick={() => f.sortable && handleSort(f.name)}
                    >
                      {f.label} {f.sortable && sortIcon(f.name)}
                    </th>
                  ))}
                  <th style={{ width: "140px" }} className="text-end">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody>
                {pageData.map((c) => (
                  <tr key={c.id}>
                    <td>{c.id}</td>
                    <td>{c.name}</td>
                    <td>{c.phone}</td>
                    <td>{c.email}</td>
                    {(Array.isArray(customFields)
                      ? customFields.filter((f) => f.display_in_grid)
                      : []
                    ).map((f) => (
                      <td key={f.id}>
                        {c.custom_fields?.[f.name] ?? f.default_value ?? "-"}
                      </td>
                    ))}
                    <td className="text-end">
                      <button
                        className="btn btn-sm btn-outline-primary me-1"
                        onClick={() => handleEdit(c)}
                        disabled={loading}
                      >
                        Edit
                      </button>
                      <button
                        className="btn btn-sm btn-outline-danger"
                        onClick={() => handleDelete(c.id)}
                        disabled={loading}
                      >
                        Del
                      </button>
                    </td>
                  </tr>
                ))}
                {!pageData.length && !loading && (
                  <tr>
                    <td
                      colSpan={
                        5 +
                        (Array.isArray(customFields)
                          ? customFields.filter((f) => f.display_in_grid)
                          : []
                        ).length
                      }
                      className="text-center text-muted"
                    >
                      No customers found.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>

          {/* Pagination */}
          <Pagination
            currentPage={currentPage}
            totalPages={totalPages}
            pageSize={pageSize}
            onPageChange={goToPage}
            onPageSizeChange={(newSize) => {
              setPageSize(newSize);
              setPage(1); // Reset to first page when changing page size
            }}
            totalItems={total}
          />

          <small className="text-muted d-block mt-2">
            Data stored locally in SQLite.
          </small>
        </div>
      </div>

      {/* Modal for add/edit */}
      {showModal && (
        <>
          <div
            className="modal fade show d-block"
            tabIndex="-1"
            role="dialog"
            style={{ zIndex: 1050 }}
            onClick={closeModal}
          >
            <div
              className="modal-dialog modal-dialog-centered modal-sm"
              style={{ maxWidth: "420px" }}
              onClick={(e) => e.stopPropagation()}
            >
              <div className="modal-content">
                <form onSubmit={handleSubmit}>
                  <div className="modal-header">
                    <h5 className="modal-title">
                      {isEditing ? "Edit Customer" : "New Customer"}
                    </h5>
                    <button
                      type="button"
                      className="btn-close"
                      onClick={closeModal}
                      disabled={loading}
                    />
                  </div>
                  <div className="modal-body">
                    <div className="mb-2">
                      <label className="form-label mb-0 small">Name *</label>
                      <input
                        type="text"
                        className="form-control form-control-sm"
                        name="name"
                        value={form.name}
                        onChange={handleChange}
                        required
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-2">
                      <label className="form-label mb-0 small">Phone</label>
                      <input
                        type="text"
                        className="form-control form-control-sm"
                        name="phone"
                        value={form.phone}
                        onChange={handleChange}
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-0">
                      <label className="form-label mb-0 small">Email</label>
                      <input
                        type="email"
                        className="form-control form-control-sm"
                        name="email"
                        value={form.email}
                        onChange={handleChange}
                        disabled={loading}
                      />
                    </div>
                    {customFields.length > 0 && (
                      <div className="mt-3">
                        <CustomFieldRenderer
                          fields={customFields}
                          values={customFieldValues}
                          onChange={(name, value) =>
                            setCustomFieldValues((prev) => ({
                              ...prev,
                              [name]: value,
                            }))
                          }
                          module="customers"
                          loading={loading}
                        />
                      </div>
                    )}
                  </div>
                  <div className="modal-footer">
                    <button
                      type="button"
                      className="btn btn-sm btn-outline-secondary"
                      onClick={closeModal}
                      disabled={loading}
                    >
                      Close
                    </button>
                    <button
                      type="submit"
                      className="btn btn-sm btn-primary"
                      disabled={loading}
                    >
                      {isEditing ? "Update" : "Save"}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div
            className="modal-backdrop fade show"
            style={{ zIndex: 1040 }}
            onClick={closeModal}
          />
        </>
      )}
    </div>
  );
};

export default Customers;


===============================
FILE: src/pages/Invoices/index.jsx
===============================
import React, { useEffect, useMemo, useRef, useState } from "react";
import Pagination from "../../components/common/Pagination";
import { formatCurrency } from "../../utils/format";

const STATUS_OPTIONS = ["unpaid", "partially_paid", "paid", "cancelled"];
const PAGE_SIZE = 10;

const emptyForm = {
  id: null,
  customer_id: "",
  total: "",
  invoice_date: "",
  status: "unpaid",
};

const Invoices = () => {
  const [invoices, setInvoices] = useState([]);
  const [customers, setCustomers] = useState([]);
  const [loading, setLoading] = useState(false);

  const [search, setSearch] = useState("");
  const [statusFilter, setStatusFilter] = useState("");
  const [page, setPage] = useState(1);
  const [pageSize, setPageSize] = useState(10);
  const [sortKey, setSortKey] = useState("invoice_date");
  const [sortDir, setSortDir] = useState("desc");

  const [showModal, setShowModal] = useState(false);
  const [form, setForm] = useState(emptyForm);
  const [isEditing, setIsEditing] = useState(false);
  const [customerSearch, setCustomerSearch] = useState("");
  const [showCustomerDropdown, setShowCustomerDropdown] = useState(false);
  const [currency, setCurrency] = useState("INR");

  const customerInputRef = useRef(null);

  const loadInvoices = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const [invoiceRows, customerRows, settingsRes] = await Promise.all([
        window.xnoll.invoicesList(),
        window.xnoll.customersList(),
        window.xnoll.settingsGet(),
      ]);
      setInvoices(invoiceRows);
      setCustomers(customerRows);
      if (settingsRes?.success && settingsRes.settings) {
        setCurrency(settingsRes.settings.currency || "INR");
      }
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadInvoices();
  }, []);

  const filteredCustomers = useMemo(() => {
    const term = customerSearch.trim().toLowerCase();
    if (!term) return customers;
    return customers.filter((c) => {
      return (
        (c.name || "").toLowerCase().includes(term) ||
        (c.phone || "").toLowerCase().includes(term) ||
        String(c.id || "").includes(term)
      );
    });
  }, [customers, customerSearch]);

  // maps for quick lookup
  const customerMap = useMemo(() => {
    const m = {};
    customers.forEach((c) => {
      m[c.id] = c;
    });
    return m;
  }, [customers]);

  // attach display names
  const enrichedInvoices = useMemo(
    () =>
      invoices.map((inv) => {
        const cust = customerMap[inv.customer_id];
        return {
          ...inv,
          customer_name: cust ? cust.name : `#${inv.customer_id || "-"}`,
        };
      }),
    [invoices, customerMap]
  );

  const filtered = useMemo(() => {
    const term = search.trim().toLowerCase();
    let data = [...enrichedInvoices];

    if (statusFilter) {
      data = data.filter((inv) => (inv.status || "") === statusFilter);
    }

    if (term) {
      data = data.filter((inv) => {
        return (
          String(inv.id || "").includes(term) ||
          (inv.customer_name || "").toLowerCase().includes(term) ||
          String(inv.customer_id || "").includes(term)
        );
      });
    }

    data.sort((a, b) => {
      const va = a[sortKey] ?? "";
      const vb = b[sortKey] ?? "";
      if (va < vb) return sortDir === "asc" ? -1 : 1;
      if (va > vb) return sortDir === "asc" ? 1 : -1;
      return 0;
    });

    return data;
  }, [enrichedInvoices, search, statusFilter, sortKey, sortDir]);

  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  const currentPage = Math.min(page, totalPages);

  const pageData = useMemo(() => {
    const start = (currentPage - 1) * pageSize;
    return filtered.slice(start, start + pageSize);
  }, [filtered, currentPage, pageSize]);

  const formatDate = (dateStr) => {
    if (!dateStr) return "";
    const date = new Date(dateStr);
    if (isNaN(date.getTime())) return dateStr;
    return date.toLocaleDateString("en-GB", {
      day: "2-digit",
      month: "short",
      year: "numeric",
    });
  };

  const getStatusBadge = (status) => {
    const s = status || "unpaid";
    const cap = s.replace(/_/g, " ").replace(/\b\w/g, (l) => l.toUpperCase());
    let bgClass = "bg-secondary";
    if (s === "unpaid") bgClass = "bg-warning text-dark";
    else if (s === "partially_paid") bgClass = "bg-info";
    else if (s === "paid") bgClass = "bg-success";
    else if (s === "cancelled") bgClass = "bg-danger";
    return <span className={`badge ${bgClass}`}>{cap}</span>;
  };

  const handleSort = (key) => {
    if (sortKey === key) {
      setSortDir((d) => (d === "asc" ? "desc" : "asc"));
    } else {
      setSortKey(key);
      setSortDir("asc");
    }
  };

  const sortIcon = (key) => {
    if (sortKey !== key) return "";
    return sortDir === "asc" ? "â²" : "â¼";
  };

  const goToPage = (p) => {
    if (p < 1 || p > totalPages) return;
    setPage(p);
  };

  // -------- form / modal ----------
  const resetForm = () => {
    setForm(emptyForm);
    setIsEditing(false);
  };

  const openNewModal = () => {
    resetForm();
    setCustomerSearch("");
    setShowModal(true);
  };

  const closeModal = () => {
    setShowModal(false);
    resetForm();
    setCustomerSearch("");
    setShowCustomerDropdown(false);
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;

    const payload = {
      id: form.id,
      customer_id: Number(form.customer_id) || null,
      total: parseFloat(form.total || "0") || 0,
      invoice_date: form.invoice_date.trim(),
      status: form.status || "unpaid",
    };

    if (!payload.customer_id || !payload.invoice_date) {
      alert("Please fill all required fields.");
      return;
    }

    setLoading(true);
    try {
      if (isEditing && payload.id != null) {
        await window.xnoll.invoicesUpdate(payload);
      } else {
        await window.xnoll.invoicesCreate(payload);
      }
      resetForm();
      setShowModal(false);
      await loadInvoices();
    } catch (err) {
      console.error("Error saving invoice:", err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (inv) => {
    setForm({
      id: inv.id,
      customer_id: inv.customer_id || "",
      total: inv.total != null ? String(inv.total) : "",
      invoice_date: inv.invoice_date || "",
      status: inv.status || "unpaid",
    });
    const cust = customerMap[inv.customer_id];
    setCustomerSearch(cust ? `${cust.name} (ID: ${inv.customer_id})` : "");
    setIsEditing(true);
    setShowModal(true);
  };

  const handleDelete = async (id) => {
    if (!window.xnoll) return;
    if (!window.confirm("Delete this invoice?")) return;

    setLoading(true);
    try {
      await window.xnoll.invoicesDelete(id);
      await loadInvoices();
    } catch (err) {
      console.error("Error deleting invoice:", err);
    } finally {
      setLoading(false);
    }
  };

  const handlePrint = async (invoice) => {
    if (!window.xnoll) return;

    // Generate HTML for invoice
    const htmlContent = generateInvoiceHTML(invoice);

    try {
      await window.xnoll.print(htmlContent);
    } catch (err) {
      console.error("Error printing invoice:", err);
      alert("Print failed. Please try again.");
    }
  };

  const generateInvoiceHTML = (invoice) => {
    const customer = customers.find((c) => c.id === invoice.customer_id);
    const date = new Date(invoice.invoice_date).toLocaleDateString();
    const status = invoice.status
      .replace(/_/g, " ")
      .replace(/\b\w/g, (l) => l.toUpperCase());

    return `
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="UTF-8">
          <title>Invoice #${invoice.id}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
            .invoice-details { display: flex; justify-content: space-between; margin-bottom: 20px; }
            .customer-info { margin-bottom: 20px; }
            .amount { font-size: 24px; font-weight: bold; text-align: right; }
            .status { padding: 5px 10px; border-radius: 4px; color: white; }
            .status-unpaid { background-color: #dc3545; }
            .status-paid { background-color: #28a745; }
            .status-partially_paid { background-color: #ffc107; color: #000; }
            .status-cancelled { background-color: #6c757d; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Xnoll Invoice</h1>
            <h2>Invoice #${invoice.id}</h2>
          </div>

          <div class="invoice-details">
            <div>
              <strong>Date:</strong> ${date}<br>
              <strong>Status:</strong> <span class="status status-${invoice.status}">${status}</span>
            </div>
            <div class="amount">
{formatCurrency(invoice.total, currency)}
            </div>
          </div>

          ${
            customer
              ? `
            <div class="customer-info">
              <h3>Bill To:</h3>
              <p>
                ${customer.name}<br>
                ${customer.phone ? `Phone: ${customer.phone}<br>` : ""}
                ${customer.email ? `Email: ${customer.email}<br>` : ""}
              </p>
            </div>
          `
              : ""
          }

          <div style="margin-top: 40px; text-align: center; font-size: 12px; color: #666;">
            Thank you for your business!
          </div>
        </body>
      </html>
    `;
  };

  return (
    <div>
      <h4 className="mb-3">Invoices</h4>

      <div className="card shadow-sm border-0 mb-3">
        <div className="card-body d-flex flex-wrap gap-2 justify-content-between align-items-center">
          <div>
            <strong>Total:</strong> {total}{" "}
            <span className="text-muted small">
              (page {currentPage} of {totalPages})
            </span>
          </div>
          <div className="d-flex flex-wrap gap-2">
            <select
              className="form-select form-select-sm"
              style={{ width: 150 }}
              value={statusFilter}
              onChange={(e) => {
                setStatusFilter(e.target.value || "");
                setPage(1);
              }}
            >
              <option value="">All status</option>
              {STATUS_OPTIONS.map((s) => (
                <option key={s} value={s}>
                  {s
                    .replace(/_/g, " ")
                    .replace(/\b\w/g, (l) => l.toUpperCase())}
                </option>
              ))}
            </select>
            <input
              type="text"
              className="form-control form-control-sm"
              placeholder="Search customer / ID"
              style={{ minWidth: 220 }}
              value={search}
              onChange={(e) => {
                setSearch(e.target.value);
                setPage(1);
              }}
            />
            <button
              className="btn btn-sm btn-primary"
              onClick={openNewModal}
              disabled={loading || !customers.length}
              title={!customers.length ? "Add customers first" : ""}
            >
              + New Invoice
            </button>
          </div>
        </div>
      </div>

      <div className="card shadow-sm border-0">
        <div className="card-body">
          {loading && <div className="text-muted small mb-2">Loading...</div>}
          <div className="table-responsive" style={{ maxHeight: "60vh" }}>
            <table className="table table-sm table-striped align-middle">
              <thead className="table-light">
                <tr>
                  <th
                    style={{ width: "60px", cursor: "pointer" }}
                    onClick={() => handleSort("id")}
                  >
                    ID {sortIcon("id")}
                  </th>
                  <th
                    style={{ width: "180px", cursor: "pointer" }}
                    onClick={() => handleSort("customer_name")}
                  >
                    Customer {sortIcon("customer_name")}
                  </th>
                  <th
                    style={{ width: "140px", cursor: "pointer" }}
                    onClick={() => handleSort("invoice_date")}
                  >
                    Date {sortIcon("invoice_date")}
                  </th>
                  <th
                    style={{ width: "120px", cursor: "pointer" }}
                    onClick={() => handleSort("total")}
                  >
                    Total {sortIcon("total")}
                  </th>
                  <th
                    style={{ width: "120px", cursor: "pointer" }}
                    onClick={() => handleSort("status")}
                  >
                    Status {sortIcon("status")}
                  </th>
                  <th style={{ width: "140px" }} className="text-end">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody>
                {pageData.map((inv) => (
                  <tr key={inv.id}>
                    <td>{inv.id}</td>
                    <td
                      style={{
                        maxWidth: "180px",
                        overflow: "hidden",
                        textOverflow: "ellipsis",
                        whiteSpace: "nowrap",
                      }}
                    >
                      {inv.customer_name}
                    </td>
                    <td>{formatDate(inv.invoice_date)}</td>
                    <td>{formatCurrency(inv.total, currency)}</td>
                    <td>{getStatusBadge(inv.status)}</td>
                    <td className="text-end">
                      <div className="d-flex justify-content-end gap-1 flex-wrap">
                        <button
                          className="btn btn-sm btn-outline-info"
                          disabled={loading}
                          onClick={() => handlePrint(inv)}
                          title="Print Invoice"
                        >
                          ð¨ï¸
                        </button>
                        <button
                          className="btn btn-sm btn-outline-primary"
                          disabled={loading}
                          onClick={() => handleEdit(inv)}
                        >
                          Edit
                        </button>
                        <button
                          className="btn btn-sm btn-outline-danger"
                          disabled={loading}
                          onClick={() => handleDelete(inv.id)}
                        >
                          Del
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
                {!pageData.length && !loading && (
                  <tr>
                    <td colSpan="6" className="text-center text-muted">
                      No invoices found.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>

          <Pagination
            currentPage={currentPage}
            totalPages={totalPages}
            pageSize={pageSize}
            onPageChange={goToPage}
            onPageSizeChange={(newSize) => {
              setPageSize(newSize);
              setPage(1); // Reset to first page when changing page size
            }}
            totalItems={total}
          />

          <small className="text-muted d-block mt-2">
            Invoices are stored in local.
          </small>
        </div>
      </div>

      {/* Modal for add/edit invoice */}
      {showModal && (
        <>
          <div
            className="modal fade show d-block"
            tabIndex="-1"
            role="dialog"
            style={{ zIndex: 1050 }}
            onClick={closeModal}
          >
            <div
              className="modal-dialog modal-dialog-centered"
              style={{ maxWidth: "480px" }}
              onClick={(e) => e.stopPropagation()}
            >
              <div className="modal-content">
                <form onSubmit={handleSubmit}>
                  <div className="modal-header">
                    <h5 className="modal-title">
                      {isEditing ? "Edit Invoice" : "New Invoice"}
                    </h5>
                    <button
                      type="button"
                      className="btn-close"
                      onClick={closeModal}
                      disabled={loading}
                    />
                  </div>
                  <div className="modal-body">
                    <div className="mb-2">
                      <label className="form-label mb-0 small">
                        Customer *
                      </label>
                      <div className="position-relative mb-1">
                        <input
                          ref={customerInputRef}
                          type="text"
                          className="form-control form-control-sm"
                          placeholder="Search by name / phone / ID"
                          value={customerSearch}
                          onChange={(e) => {
                            setCustomerSearch(e.target.value);
                            setShowCustomerDropdown(true);
                          }}
                          onFocus={() => setShowCustomerDropdown(true)}
                          onBlur={() =>
                            setTimeout(
                              () => setShowCustomerDropdown(false),
                              150
                            )
                          }
                          disabled={loading || !customers.length}
                        />
                        {showCustomerDropdown &&
                          filteredCustomers.length > 0 && (
                            <div
                              className="position-absolute top-100 start-0 w-100 bg-white border shadow-sm"
                              style={{
                                zIndex: 10,
                                maxHeight: "150px",
                                overflowY: "auto",
                              }}
                            >
                              {filteredCustomers.slice(0, 10).map((c) => (
                                <div
                                  key={c.id}
                                  className="p-2 border-bottom small"
                                  style={{ cursor: "pointer" }}
                                  onMouseDown={(e) => e.preventDefault()}
                                  onClick={() => {
                                    setForm((prev) => ({
                                      ...prev,
                                      customer_id: c.id,
                                    }));
                                    setCustomerSearch(
                                      `${c.name}${
                                        c.phone ? ` - ${c.phone}` : ""
                                      } (ID: ${c.id})`
                                    );
                                    setShowCustomerDropdown(false);
                                  }}
                                >
                                  <div className="fw-bold">{c.name}</div>
                                  <small className="text-muted">
                                    {c.phone || "No phone"} â¢ ID: {c.id}
                                  </small>
                                </div>
                              ))}
                              {filteredCustomers.length > 10 && (
                                <div className="p-2 small text-muted">
                                  ... and {filteredCustomers.length - 10} more
                                </div>
                              )}
                            </div>
                          )}
                      </div>
                      <small className="text-muted">
                        {form.customer_id
                          ? `Selected: ${customerMap[form.customer_id]?.name || "Unknown"}`
                          : "No customer selected"}
                      </small>
                    </div>
                    <div className="mb-2">
                      <label className="form-label mb-0 small">
                        Invoice Date *
                      </label>
                      <input
                        type="date"
                        className="form-control form-control-sm"
                        name="invoice_date"
                        value={form.invoice_date}
                        onChange={handleChange}
                        required
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-2">
                      <label className="form-label mb-0 small">
                        Total Amount *
                      </label>
                      <input
                        type="number"
                        step="0.01"
                        min="0"
                        className="form-control form-control-sm"
                        name="total"
                        value={form.total}
                        onChange={handleChange}
                        required
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-0">
                      <label className="form-label mb-0 small">Status</label>
                      <select
                        className="form-select form-select-sm"
                        name="status"
                        value={form.status}
                        onChange={handleChange}
                        disabled={loading}
                      >
                        {STATUS_OPTIONS.map((s) => (
                          <option key={s} value={s}>
                            {s
                              .replace(/_/g, " ")
                              .replace(/\b\w/g, (l) => l.toUpperCase())}
                          </option>
                        ))}
                      </select>
                    </div>
                  </div>
                  <div className="modal-footer">
                    <button
                      type="button"
                      className="btn btn-sm btn-outline-secondary"
                      onClick={closeModal}
                      disabled={loading}
                    >
                      Close
                    </button>
                    <button
                      type="submit"
                      className="btn btn-sm btn-primary"
                      disabled={loading}
                    >
                      {isEditing ? "Update" : "Save"}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div
            className="modal-backdrop fade show"
            style={{ zIndex: 1040 }}
            onClick={closeModal}
          />
        </>
      )}
    </div>
  );
};

export default Invoices;


===============================
FILE: src/pages/Reports/index.jsx
===============================
import React, { useEffect, useState, useMemo } from "react";
import Button from "../../components/common/Button";
import { formatCurrency } from '../../utils/format';

const Reports = () => {
  const [loading, setLoading] = useState(false);
  const [activeTab, setActiveTab] = useState('overview');
  const [currency, setCurrency] = useState('INR');
  const [filters, setFilters] = useState({
    startDate: new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().slice(0, 10),
    endDate: new Date().toISOString().slice(0, 10),
    status: '',
    customer: '',
    product: ''
  });

  const [data, setData] = useState({
    customers: [],
    products: [],
    bookings: [],
    invoices: []
  });

  const loadData = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const [customers, products, bookings, invoices, settingsRes] = await Promise.all([
        window.xnoll.customersList(),
        window.xnoll.productsList(),
        window.xnoll.bookingsList(),
        window.xnoll.invoicesList(),
        window.xnoll.settingsGet()
      ]);

      setData({ customers, products, bookings, invoices });
      if (settingsRes?.success && settingsRes.settings) {
        setCurrency(settingsRes.settings.currency || 'INR');
      }
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadData();
  }, []);

  const filteredBookings = useMemo(() => {
    return data.bookings.filter(booking => {
      const bookingDate = booking.booking_date?.slice(0, 10);
      const matchesDate = (!filters.startDate || bookingDate >= filters.startDate) &&
                         (!filters.endDate || bookingDate <= filters.endDate);
      const matchesStatus = !filters.status || booking.status === filters.status;
      const matchesCustomer = !filters.customer ||
        booking.customer_name?.toLowerCase().includes(filters.customer.toLowerCase());
      const matchesProduct = !filters.product ||
        booking.product_name?.toLowerCase().includes(filters.product.toLowerCase());

      return matchesDate && matchesStatus && matchesCustomer && matchesProduct;
    });
  }, [data.bookings, filters]);

  const filteredInvoices = useMemo(() => {
    return data.invoices.filter(invoice => {
      const invoiceDate = invoice.invoice_date;
      const matchesDate = (!filters.startDate || invoiceDate >= filters.startDate) &&
                         (!filters.endDate || invoiceDate <= filters.endDate);
      const matchesStatus = !filters.status || invoice.status === filters.status;
      const matchesCustomer = !filters.customer ||
        invoice.customer_name?.toLowerCase().includes(filters.customer.toLowerCase());

      return matchesDate && matchesStatus && matchesCustomer;
    });
  }, [data.invoices, filters]);

  const summary = useMemo(() => {
    const todayStr = new Date().toISOString().slice(0, 10);
    const bookingsToday = data.bookings.filter(b => b.booking_date?.slice(0, 10) === todayStr).length;
    const bookingsUpcoming = data.bookings.filter(b => b.booking_date?.slice(0, 10) > todayStr).length;
    const invoicesUnpaid = data.invoices.filter(i => i.status !== 'paid').length;
    const totalRevenue = data.invoices.reduce((sum, i) => sum + (Number(i.total) || 0), 0);

    return {
      customers: data.customers.length,
      products: data.products.length,
      bookingsToday,
      bookingsUpcoming,
      invoicesUnpaid,
      totalRevenue
    };
  }, [data]);

  const exportToCSV = (data, filename) => {
    if (!data || data.length === 0) return;

    const headers = Object.keys(data[0]);
    const csvContent = [
      headers.join(','),
      ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  const handleFilterChange = (field, value) => {
    setFilters(prev => ({ ...prev, [field]: value }));
  };

  return (
    <div>
      <div className="d-flex justify-content-between align-items-center mb-3">
        <h4 className="mb-0">Reports & Analytics</h4>
        <Button variant="outline-primary" size="sm" onClick={loadData} disabled={loading}>
          {loading ? 'Loading...' : 'Refresh Data'}
        </Button>
      </div>

      {/* Tab Navigation */}
      <ul className="nav nav-tabs mb-3">
        <li className="nav-item">
          <button className={`nav-link ${activeTab === 'overview' ? 'active' : ''}`}
                  onClick={() => setActiveTab('overview')}>
            Overview
          </button>
        </li>
        <li className="nav-item">
          <button className={`nav-link ${activeTab === 'bookings' ? 'active' : ''}`}
                  onClick={() => setActiveTab('bookings')}>
            Bookings Report
          </button>
        </li>
        <li className="nav-item">
          <button className={`nav-link ${activeTab === 'invoices' ? 'active' : ''}`}
                  onClick={() => setActiveTab('invoices')}>
            Invoices Report
          </button>
        </li>
      </ul>

      {/* Filters */}
      <div className="card shadow-sm border-0 mb-3">
        <div className="card-body">
          <div className="row g-3">
            <div className="col-md-3">
              <label className="form-label small">Start Date</label>
              <input
                type="date"
                className="form-control form-control-sm"
                value={filters.startDate}
                onChange={(e) => handleFilterChange('startDate', e.target.value)}
              />
            </div>
            <div className="col-md-3">
              <label className="form-label small">End Date</label>
              <input
                type="date"
                className="form-control form-control-sm"
                value={filters.endDate}
                onChange={(e) => handleFilterChange('endDate', e.target.value)}
              />
            </div>
            <div className="col-md-3">
              <label className="form-label small">Status</label>
              <select
                className="form-select form-select-sm"
                value={filters.status}
                onChange={(e) => handleFilterChange('status', e.target.value)}
              >
                <option value="">All Statuses</option>
                <option value="pending">Pending</option>
                <option value="confirmed">Confirmed</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
                <option value="paid">Paid</option>
                <option value="unpaid">Unpaid</option>
              </select>
            </div>
            <div className="col-md-3">
              <label className="form-label small">Search</label>
              <input
                type="text"
                className="form-control form-control-sm"
                placeholder="Customer/Product name..."
                value={filters.customer || filters.product}
                onChange={(e) => {
                  handleFilterChange('customer', e.target.value);
                  handleFilterChange('product', e.target.value);
                }}
              />
            </div>
          </div>
        </div>
      </div>

      {/* Overview Tab */}
      {activeTab === 'overview' && (
      <div className="row g-3">
        <div className="col-md-3">
            <div className="card shadow-sm border-0 h-100">
              <div className="card-body text-center">
                <div className="text-primary mb-2">
                  <i className="fas fa-users fa-2x"></i>
                </div>
              <h3 className="mb-1">{summary.customers}</h3>
                <p className="text-muted small mb-0">Total Customers</p>
              </div>
            </div>
          </div>

          <div className="col-md-3">
            <div className="card shadow-sm border-0 h-100">
              <div className="card-body text-center">
                <div className="text-success mb-2">
                  <i className="fas fa-box fa-2x"></i>
                </div>
                <h3 className="mb-1">{summary.products}</h3>
                <p className="text-muted small mb-0">Products/Services</p>
            </div>
          </div>
        </div>

        <div className="col-md-3">
            <div className="card shadow-sm border-0 h-100">
              <div className="card-body text-center">
                <div className="text-info mb-2">
                  <i className="fas fa-calendar-day fa-2x"></i>
                </div>
                <h3 className="mb-1">{summary.bookingsToday}</h3>
                <p className="text-muted small mb-0">Today's Bookings</p>
              </div>
            </div>
          </div>

          <div className="col-md-3">
            <div className="card shadow-sm border-0 h-100">
              <div className="card-body text-center">
                <div className="text-warning mb-2">
                  <i className="fas fa-calendar-alt fa-2x"></i>
                </div>
                <h3 className="mb-1">{summary.bookingsUpcoming}</h3>
                <p className="text-muted small mb-0">Upcoming Bookings</p>
            </div>
          </div>
        </div>

        <div className="col-md-3">
            <div className="card shadow-sm border-0 h-100">
              <div className="card-body text-center">
                <div className="text-danger mb-2">
                  <i className="fas fa-file-invoice-dollar fa-2x"></i>
                </div>
                <h3 className="mb-1">{summary.invoicesUnpaid}</h3>
                <p className="text-muted small mb-0">Unpaid Invoices</p>
            </div>
          </div>
        </div>

        <div className="col-md-3">
            <div className="card shadow-sm border-0 h-100">
              <div className="card-body text-center">
                <div className="text-success mb-2">
                  <i className="fas fa-rupee-sign fa-2x"></i>
                </div>
                <h3 className="mb-1">{formatCurrency(summary.totalRevenue, currency)}</h3>
                <p className="text-muted small mb-0">Total Revenue</p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Bookings Report Tab */}
      {activeTab === 'bookings' && (
          <div className="card shadow-sm border-0">
          <div className="card-header d-flex justify-content-between align-items-center">
            <h6 className="mb-0">Bookings Report ({filteredBookings.length} records)</h6>
            <Button
              variant="outline-success"
              size="sm"
              onClick={() => exportToCSV(filteredBookings, `bookings-report-${filters.startDate}-to-${filters.endDate}.csv`)}
              disabled={filteredBookings.length === 0}
            >
              <i className="fas fa-download me-1"></i> Export CSV
            </Button>
          </div>
            <div className="card-body">
            <div className="table-responsive">
              <table className="table table-sm table-striped">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Customer</th>
                    <th>Service</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  {filteredBookings.map(booking => (
                    <tr key={booking.id}>
                      <td>{new Date(booking.booking_date).toLocaleDateString()}</td>
                      <td>{new Date(booking.booking_date).toLocaleTimeString()}</td>
                      <td>{booking.customer_name}</td>
                      <td>{booking.product_name || booking.service_name}</td>
                      <td>
                        <span className={`badge ${booking.status === 'confirmed' ? 'bg-success' :
                                                    booking.status === 'completed' ? 'bg-primary' :
                                                    booking.status === 'cancelled' ? 'bg-danger' : 'bg-warning text-dark'}`}>
                          {booking.status}
                        </span>
                      </td>
                    </tr>
                  ))}
                  {filteredBookings.length === 0 && (
                    <tr>
                      <td colSpan="5" className="text-center text-muted py-4">
                        No bookings found for the selected filters
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      )}

      {/* Invoices Report Tab */}
      {activeTab === 'invoices' && (
          <div className="card shadow-sm border-0">
          <div className="card-header d-flex justify-content-between align-items-center">
            <h6 className="mb-0">Invoices Report ({filteredInvoices.length} records)</h6>
            <Button
              variant="outline-success"
              size="sm"
              onClick={() => exportToCSV(filteredInvoices, `invoices-report-${filters.startDate}-to-${filters.endDate}.csv`)}
              disabled={filteredInvoices.length === 0}
            >
              <i className="fas fa-download me-1"></i> Export CSV
            </Button>
          </div>
            <div className="card-body">
            <div className="table-responsive">
              <table className="table table-sm table-striped">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Invoice #</th>
                    <th>Customer</th>
                    <th>Amount</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  {filteredInvoices.map(invoice => (
                    <tr key={invoice.id}>
                      <td>{new Date(invoice.invoice_date).toLocaleDateString()}</td>
                      <td>{invoice.id}</td>
                      <td>{invoice.customer_name}</td>
                      <td>{formatCurrency(invoice.total, currency)}</td>
                      <td>
                        <span className={`badge ${invoice.status === 'paid' ? 'bg-success' : 'bg-danger'}`}>
                          {invoice.status}
                        </span>
                      </td>
                    </tr>
                  ))}
                  {filteredInvoices.length === 0 && (
                    <tr>
                      <td colSpan="5" className="text-center text-muted py-4">
                        No invoices found for the selected filters
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default Reports;


===============================
FILE: src/pages/License/Activation.jsx
===============================
import React, { useState, useEffect } from 'react';
import Button from '../../components/common/Button';
import crypto from 'crypto';

const SECRET_KEY = "YOUR_OBFUSCATED_SECRET"; // Must match server's secret

const LicenseActivation = ({ onActivated }) => {
  const [licenseKey, setLicenseKey] = useState('');
  const [status, setStatus] = useState(null);
  const [machineId, setMachineId] = useState('');
  const [loading, setLoading] = useState(false);

  // Load machine ID once
  useEffect(() => {
    if (!window.xnoll) return;
    window.xnoll.licenseGetMachineId().then(res => {
      if (res.success) setMachineId(res.machineId);
    }).catch(console.error);
  }, []);

  // Check weekly Monday API ping
  useEffect(() => {
    const tryWeeklyPing = async () => {
      if (!navigator.onLine) return;

      const lastPing = localStorage.getItem('lastWeeklyPing');
      const today = new Date();
      const dayOfWeek = today.getDay(); // 1 = Monday

      if (dayOfWeek === 1 && lastPing !== today.toDateString()) {
        try {
          if (status?.valid) {
            await fetch(`https://xnoll.com/offline-desktop/xnoll-booking/${encodeURIComponent(licenseKey)}`, {
              method: 'GET',
            });
            localStorage.setItem('lastWeeklyPing', today.toDateString());
          }
        } catch (err) {
          console.warn('Weekly API ping failed', err);
        }
      }
    };

    tryWeeklyPing();
    const interval = setInterval(tryWeeklyPing, 1000 * 60 * 60); // check hourly
    return () => clearInterval(interval);
  }, [licenseKey, status]);

  // Validate license offline
  const validateLicense = (key) => {
    try {
      const parts = key.split('-');
      if (parts.length !== 4) return false;

      const prefix = parts[0];
      const username = parts[1];
      const expiry = parts[2];
      const signature = parts[3];

      if (prefix !== 'XN') return false;

      // Check expiry
      const year = parseInt(expiry.substring(0, 4));
      const month = parseInt(expiry.substring(4, 6)) - 1;
      const day = parseInt(expiry.substring(6, 8));
      const expiryDate = new Date(year, month, day);
      if (new Date() > expiryDate) return false;

      // Check HMAC
      const raw = `${username}|${expiry}`;
      const expected = crypto.createHmac('sha256', SECRET_KEY).update(raw).digest('hex').substring(0, 16);

      return expected === signature;
    } catch (err) {
      console.error('License validation failed', err);
      return false;
    }
  };

  const handleActivate = async (e) => {
    e.preventDefault();
    const key = licenseKey.trim().toUpperCase();
    if (!key) return;

    setLoading(true);
    const valid = validateLicense(key);

    if (valid) {
      setStatus({ valid: true, licenseKey: key });
      localStorage.setItem('activatedLicense', key);

      if (onActivated) onActivated({ licenseKey: key });
    } else {
      setStatus({ valid: false, error: 'Invalid or expired license' });
    }

    setLoading(false);
  };

  const handleLicenseKeyChange = (e) => {
    const value = e.target.value.replace(/[^A-Z0-9]/gi, '').toUpperCase();
    const formatted = value.match(/.{1,4}/g)?.join('-') || '';
    setLicenseKey(formatted);
  };

  // Load saved license on startup
  useEffect(() => {
    const saved = localStorage.getItem('activatedLicense');
    if (saved) setLicenseKey(saved);
    if (saved && validateLicense(saved)) setStatus({ valid: true, licenseKey: saved });
  }, []);

  return (
    <div className="min-vh-100 d-flex align-items-center justify-content-center bg-light">
      <div className="container">
        <div className="row justify-content-center">
          <div className="col-md-6 col-lg-5">
            <div className="card shadow-lg border-0">
              <div className="card-body p-5">
                <div className="text-center mb-4">
                  <h3 className="fw-bold">License Activation</h3>
                  <p className="text-muted">Enter your activation key to unlock the software.</p>
                </div>

                <form onSubmit={handleActivate}>
                  <div className="mb-3">
                    <label className="form-label fw-semibold">License Key *</label>
                    <input
                      type="text"
                      className={`form-control form-control-lg text-center font-monospace ${status?.valid === false ? 'is-invalid' : ''}`}
                      placeholder="XXXX-XXXX-XXXX-XXXX-XXXX"
                      value={licenseKey}
                      onChange={handleLicenseKeyChange}
                      maxLength={24}
                      disabled={loading}
                      autoFocus
                      style={{ letterSpacing: '0.1em' }}
                    />
                    {status?.valid === false && <div className="invalid-feedback">{status.error}</div>}
                  </div>

                  <div className="mb-3">
                    <label className="form-label fw-semibold">Machine ID</label>
                    <div className="input-group">
                      <input type="text" className="form-control font-monospace bg-light" value={machineId} readOnly />
                      <button type="button" className="btn btn-outline-secondary" onClick={() => { navigator.clipboard.writeText(machineId); alert('Copied!'); }}>Copy</button>
                    </div>
                    <small className="text-muted">Share this ID when requesting a license</small>
                  </div>

                  <Button type="submit" variant="primary" size="lg" fullWidth disabled={loading}>
                    {loading ? 'Checking...' : 'Activate'}
                  </Button>
                </form>

                {status?.valid && (
                  <div className="alert alert-success mt-3">
                    License activated successfully.
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LicenseActivation;


===============================
FILE: src/pages/Products/index.jsx
===============================
import React, { useEffect, useMemo, useState } from "react";
import CustomFieldRenderer from "../../components/CustomField/CustomFieldRenderer";
import Pagination from "../../components/common/Pagination";
import { formatCurrency } from "../../utils/format";

const emptyForm = { id: null, sku: "", name: "", unit: "", price: "" };
const PAGE_SIZE = 10;

const Products = () => {
  const [products, setProducts] = useState([]);
  const [customFields, setCustomFields] = useState([]);
  const [customFieldValues, setCustomFieldValues] = useState({});
  const [currency, setCurrency] = useState("INR");
  const [form, setForm] = useState(emptyForm);
  const [isEditing, setIsEditing] = useState(false);
  const [loading, setLoading] = useState(false);
  const [settings, setSettings] = useState({
    auto_generate_sku: 1,
    sku_prefix: "SKU",
  });

  const [search, setSearch] = useState("");
  const [page, setPage] = useState(1);
  const [pageSize, setPageSize] = useState(10);
  const [sortKey, setSortKey] = useState("id");
  const [sortDir, setSortDir] = useState("desc");

  const [showModal, setShowModal] = useState(false);

  const loadProducts = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      // temporary: direct select; later replace by window.xnoll.productsList()
      const [rows, fields, settingsRes] = await Promise.all([
        window.xnoll.productsList(),
        window.xnoll.customFieldsList("products"),
        window.xnoll.settingsGet(),
      ]);

      setProducts(rows || []);
      setCustomFields(fields || []);
      if (settingsRes?.success && settingsRes.settings) {
        setSettings((prev) => ({ ...prev, ...settingsRes.settings }));
        setCurrency(settingsRes.settings.currency || "INR");
      }
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadProducts();
  }, []);

  // ---------- filter + sort + paginate ----------
  const filtered = useMemo(() => {
    const term = search.trim().toLowerCase();
    let data = [...products];

    // 1) Filter by term if present
    if (term) {
      data = data.filter((p) => {
        const baseMatch =
          (p.name || "").toLowerCase().includes(term) ||
          (p.sku || "").toLowerCase().includes(term);

        if (baseMatch) return true;

        if (p.custom_fields && Array.isArray(customFields)) {
          for (const field of customFields) {
            if (!field.searchable) continue;
            const value = p.custom_fields[field.name];
            if (
              value !== undefined &&
              String(value).toLowerCase().includes(term)
            ) {
              return true;
            }
          }
        }

        return false;
      });
    }

    // 2) Sorting â always apply
    const getSortValue = (row, key) => {
      if (!key) return "";
      if (row[key] !== undefined && row[key] !== null) return row[key];
      if (row.custom_fields && row.custom_fields[key] !== undefined)
        return row.custom_fields[key];
      return "";
    };

    data.sort((a, b) => {
      let va = getSortValue(a, sortKey);
      let vb = getSortValue(b, sortKey);

      // numeric compare when both look numeric
      const na = parseFloat(va);
      const nb = parseFloat(vb);
      const bothNumbers =
        String(va).trim() !== "" &&
        String(vb).trim() !== "" &&
        !Number.isNaN(na) &&
        !Number.isNaN(nb);

      if (bothNumbers) {
        if (na < nb) return sortDir === "asc" ? -1 : 1;
        if (na > nb) return sortDir === "asc" ? 1 : -1;
        return 0;
      }

      va = String(va).toLowerCase();
      vb = String(vb).toLowerCase();

      if (va < vb) return sortDir === "asc" ? -1 : 1;
      if (va > vb) return sortDir === "asc" ? 1 : -1;
      return 0;
    });

    return data;
  }, [products, customFields, search, sortKey, sortDir]);

  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  const currentPage = Math.min(page, totalPages);

  const pageData = useMemo(() => {
    const start = (currentPage - 1) * pageSize;
    return filtered.slice(start, start + pageSize);
  }, [filtered, currentPage, pageSize]);

  const handleSort = (key) => {
    if (sortKey === key) {
      setSortDir((d) => (d === "asc" ? "desc" : "asc"));
    } else {
      setSortKey(key);
      setSortDir("asc");
    }
  };

  const sortIcon = (key) => {
    if (sortKey !== key) return "";
    return sortDir === "asc" ? "â²" : "â¼";
  };

  const goToPage = (p) => {
    if (p < 1 || p > totalPages) return;
    setPage(p);
  };

  // ---------- form / modal handlers ----------
  const resetForm = () => {
    setForm(emptyForm);
    setCustomFieldValues({});
    setIsEditing(false);
  };

  const openNewModal = () => {
    resetForm();
    setShowModal(true);
    // Auto-generate SKU if enabled
    if (settings.auto_generate_sku && window.xnoll) {
      window.xnoll
        .skuGenerate(settings.sku_prefix || "SKU")
        .then((resp) => {
          if (resp?.sku) {
            setForm((prev) => ({ ...prev, sku: resp.sku }));
          }
        })
        .catch(() => {});
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
    if (name === "name" && settings.auto_generate_sku && !form.sku) {
      const trimmed = value.trim();
      if (trimmed.length >= 2 && window.xnoll) {
        window.xnoll
          .skuGenerate(settings.sku_prefix || "SKU")
          .then((resp) => {
            if (resp?.sku) setForm((prev) => ({ ...prev, sku: resp.sku }));
          })
          .catch(() => {});
      }
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;

    const payload = {
      id: form.id,
      sku: form.sku.trim(),
      name: form.name.trim(),
      unit: form.unit.trim(),
      price: parseFloat(form.price || "0") || 0,
    };

    if (!payload.name) return;

    setLoading(true);
    try {
      let productId;
      if (isEditing && payload.id != null) {
        await window.xnoll.productsUpdate(payload);
        productId = payload.id;
      } else {
        const result = await window.xnoll.productsCreate(payload);
        productId = result.id;
      }

      // Save custom field values
      if (customFields.length > 0 && productId) {
        for (const field of customFields) {
          const value = customFieldValues[field.name];
          if (value !== undefined && value !== "") {
            await window.xnoll.customFieldValuesSave({
              field_id: field.id,
              record_id: productId,
              value: String(value),
            });
          }
        }
      }

      resetForm();
      setShowModal(false);
      await loadProducts();
    } catch (error) {
      console.error("Error saving product:", error);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = async (p) => {
    setForm({
      id: p.id,
      sku: p.sku || "",
      name: p.name || "",
      unit: p.unit || "",
      price: p.price != null ? String(p.price) : "",
    });

    // Load custom field values for this product
    if (customFields.length > 0) {
      try {
        const values = {};
        for (const field of customFields) {
          const result = await window.xnoll.customFieldValuesGet(
            field.id,
            p.id
          );
          if (result && result.value !== undefined) {
            values[field.name] = result.value;
          }
        }
        setCustomFieldValues(values);
      } catch (err) {
        console.error("Failed to load custom field values:", err);
      }
    }

    setIsEditing(true);
    setShowModal(true);
  };

  const handleDelete = async (id) => {
    if (!window.xnoll) return;
    if (!window.confirm("Delete this product?")) return;

    setLoading(true);
    try {
      await window.xnoll.productsDelete(id);
      await loadProducts();
    } catch (error) {
      console.error("Error deleting product:", error);
    } finally {
      setLoading(false);
    }
  };

  const closeModal = () => {
    setShowModal(false);
    resetForm();
  };

  return (
    <div>
      <h4 className="mb-3">Products / Services</h4>

      <div className="card shadow-sm border-0 mb-3">
        <div className="card-body d-flex flex-wrap gap-2 justify-content-between align-items-center">
          <div>
            <strong>Total:</strong> {total}{" "}
            <span className="text-muted small">
              (page {currentPage} of {totalPages})
            </span>
          </div>
          <div className="d-flex gap-2">
            <input
              type="text"
              className="form-control form-control-sm"
              placeholder="Search name / SKU"
              style={{ minWidth: 220 }}
              value={search}
              onChange={(e) => {
                setSearch(e.target.value);
                setPage(1);
              }}
            />
            <button className="btn btn-sm btn-primary" onClick={openNewModal}>
              + New Product
            </button>
          </div>
        </div>
      </div>

      <div className="card shadow-sm border-0">
        <div className="card-body">
          {loading && <div className="text-muted small mb-2">Loading...</div>}
          <div className="table-responsive" style={{ maxHeight: "60vh" }}>
            <table className="table table-sm table-striped align-middle">
              <thead className="table-light">
                <tr>
                  <th
                    style={{ width: "60px", cursor: "pointer" }}
                    onClick={() => handleSort("id")}
                  >
                    ID {sortIcon("id")}
                  </th>
                  <th
                    style={{ width: "140px", cursor: "pointer" }}
                    onClick={() => handleSort("sku")}
                  >
                    SKU {sortIcon("sku")}
                  </th>
                  <th
                    style={{ cursor: "pointer" }}
                    onClick={() => handleSort("name")}
                  >
                    Name {sortIcon("name")}
                  </th>
                  <th style={{ width: "80px" }}>Unit</th>
                  <th
                    style={{ width: "100px", cursor: "pointer" }}
                    onClick={() => handleSort("price")}
                  >
                    Price {sortIcon("price")}
                  </th>
                  {(Array.isArray(customFields)
                    ? customFields.filter((f) => f.display_in_grid)
                    : []
                  ).map((f) => (
                    <th
                      key={f.id}
                      style={{ cursor: f.sortable ? "pointer" : "default" }}
                      onClick={() => f.sortable && handleSort(f.name)}
                    >
                      {f.label} {f.sortable && sortIcon(f.name)}
                    </th>
                  ))}
                  <th style={{ width: "140px" }} className="text-end">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody>
                {pageData.map((p) => (
                  <tr key={p.id}>
                    <td>{p.id}</td>
                    <td>{p.sku}</td>
                    <td>{p.name}</td>
                    <td>{p.unit}</td>
                    <td>{formatCurrency(p.price, currency)}</td>
                    {(Array.isArray(customFields)
                      ? customFields.filter((f) => f.display_in_grid)
                      : []
                    ).map((f) => (
                      <td key={f.id}>
                        {p.custom_fields?.[f.name] ?? f.default_value ?? "-"}
                      </td>
                    ))}
                    <td className="text-end">
                      <button
                        className="btn btn-sm btn-outline-primary me-1"
                        onClick={() => handleEdit(p)}
                        disabled={loading}
                      >
                        Edit
                      </button>
                      <button
                        className="btn btn-sm btn-outline-danger"
                        onClick={() => handleDelete(p.id)}
                        disabled={loading}
                      >
                        Del
                      </button>
                    </td>
                  </tr>
                ))}
                {!pageData.length && !loading && (
                  <tr>
                    <td
                      colSpan={
                        6 +
                        (Array.isArray(customFields)
                          ? customFields.filter((f) => f.display_in_grid)
                          : []
                        ).length
                      }
                      className="text-center text-muted"
                    >
                      No products found.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>

          <Pagination
            currentPage={currentPage}
            totalPages={totalPages}
            pageSize={pageSize}
            onPageChange={goToPage}
            onPageSizeChange={(newSize) => {
              setPageSize(newSize);
              setPage(1); // Reset to first page when changing page size
            }}
            totalItems={total}
          />

          <small className="text-muted d-block mt-2">
            Products/services stored locally in SQLite and used later in Booking
            & Invoices.
          </small>
        </div>
      </div>

      {/* Modal */}
      {showModal && (
        <>
          <div
            className="modal fade show d-block"
            tabIndex="-1"
            role="dialog"
            style={{ zIndex: 1050 }}
            onClick={closeModal}
          >
            <div
              className="modal-dialog modal-dialog-centered modal-sm"
              style={{ maxWidth: "420px" }}
              onClick={(e) => e.stopPropagation()}
            >
              <div className="modal-content">
                <form onSubmit={handleSubmit}>
                  <div className="modal-header">
                    <h5 className="modal-title">
                      {isEditing ? "Edit Product" : "New Product / Service"}
                    </h5>
                    <button
                      type="button"
                      className="btn-close"
                      onClick={closeModal}
                      disabled={loading}
                    />
                  </div>
                  <div className="modal-body">
                    <div className="mb-2">
                      <label className="form-label mb-0 small">
                        SKU / Code
                      </label>
                      <input
                        type="text"
                        className="form-control form-control-sm"
                        name="sku"
                        value={form.sku}
                        onChange={handleChange}
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-2">
                      <label className="form-label mb-0 small">Name *</label>
                      <input
                        type="text"
                        className="form-control form-control-sm"
                        name="name"
                        value={form.name}
                        onChange={handleChange}
                        required
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-2">
                      <label className="form-label mb-0 small">Unit</label>
                      <input
                        type="text"
                        className="form-control form-control-sm"
                        name="unit"
                        placeholder="pcs / hr / service"
                        value={form.unit}
                        onChange={handleChange}
                        disabled={loading}
                      />
                    </div>
                    <div className="mb-0">
                      <label className="form-label mb-0 small">Price</label>
                      <input
                        type="number"
                        step="0.01"
                        className="form-control form-control-sm"
                        name="price"
                        value={form.price}
                        onChange={handleChange}
                        disabled={loading}
                      />
                    </div>
                    {/* Place Custom Fields here */}
                    {customFields.length > 0 && (
                      <div className="mt-3">
                        <CustomFieldRenderer
                          fields={customFields}
                          values={customFieldValues}
                          onChange={(name, value) =>
                            setCustomFieldValues((prev) => ({
                              ...prev,
                              [name]: value,
                            }))
                          }
                          module="products"
                          loading={loading}
                        />
                      </div>
                    )}
                  </div>
                  <div className="modal-footer">
                    <button
                      type="button"
                      className="btn btn-sm btn-outline-secondary"
                      onClick={closeModal}
                      disabled={loading}
                    >
                      Close
                    </button>
                    <button
                      type="submit"
                      className="btn btn-sm btn-primary"
                      disabled={loading}
                    >
                      {isEditing ? "Update" : "Save"}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div
            className="modal-backdrop fade show"
            style={{ zIndex: 1040 }}
            onClick={closeModal}
          />
        </>
      )}
    </div>
  );
};

export default Products;


===============================
FILE: src/pages/Calendar/index.jsx
===============================
// src/pages/Calendar/index.jsx
import React from 'react';
import CalendarShell from '../../components/Calendar/CalendarShell';

const CalendarPage = () => {
  const handleCreateBooking = ({ date }) => {
    // Navigate to booking page with prefilled date
    if (window.xnoll && window.xnoll.onNavigate) {
      window.xnoll.onNavigate('booking');
      // Pass the date somehow - could use localStorage or URL params
      localStorage.setItem('prefillBookingDate', date);
    } else {
      // Fallback navigation
      window.dispatchEvent(new CustomEvent('navigate', {
        detail: { page: 'booking', date },
      }));
    }
  };

  return (
    <div className="page page-calendar">
      <div className="container-fluid">
        <div className="row">
          <div className="col-12">
            <div className="card shadow-sm border-0">
              <div className="card-body p-0">
                <CalendarShell
                  initialView="week"
                  onCreateBooking={handleCreateBooking}
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default CalendarPage;


===============================
FILE: src/pages/Settings/Company.jsx
===============================
import React, { useEffect, useState } from 'react';
import Button from '../../components/common/Button';

const empty = {
  name: '',
  address: '',
  phone: '',
  email: '',
  tax_id: '',
  website: '',
};

const CompanySettings = () => {
  const [form, setForm] = useState(empty);
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');

  const loadCompany = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const res = await window.xnoll.companyGet();
      if (res?.success && res.company) {
        setForm({
          name: res.company.name || '',
          address: res.company.address || '',
          phone: res.company.phone || '',
          email: res.company.email || '',
          website: res.company.website || '',
          tax_id: res.company.tax_id || '',
          logo_path: res.company.logo_path || ''
        });
      }
    } catch (err) {
      console.error('Load company failed', err);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadCompany();
  }, []);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((f) => ({ ...f, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;
    setLoading(true);
    setMessage('');
    try {
      const res = await window.xnoll.companySave(form);
      if (res?.success) {
        setMessage('Saved');
      } else {
        setMessage(res?.error || 'Save failed');
      }
    } catch (err) {
      setMessage('Save failed');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="card shadow-sm border-0">
      <div className="card-body">
        <h6 className="mb-3">Company / Organization Profile</h6>
        <div className="row g-3">
          <div className="col-md-6">
            <label className="form-label small mb-0">Name *</label>
            <input
              className="form-control form-control-sm"
              name="name"
              value={form.name}
              onChange={handleChange}
              required
            />
          </div>
          <div className="col-md-6">
            <label className="form-label small mb-0">Phone</label>
            <input
              className="form-control form-control-sm"
              name="phone"
              value={form.phone}
              onChange={handleChange}
            />
          </div>
          <div className="col-md-6">
            <label className="form-label small mb-0">Email</label>
            <input
              type="email"
              className="form-control form-control-sm"
              name="email"
              value={form.email}
              onChange={handleChange}
            />
          </div>
          <div className="col-md-6">
            <label className="form-label small mb-0">Website</label>
            <input
              className="form-control form-control-sm"
              name="website"
              value={form.website}
              onChange={handleChange}
              placeholder="https://"
            />
          </div>
          <div className="col-md-6">
            <label className="form-label small mb-0">Tax ID</label>
            <input
              className="form-control form-control-sm"
              name="tax_id"
              value={form.tax_id}
              onChange={handleChange}
            />
          </div>
          <div className="col-12">
            <label className="form-label small mb-0">Address</label>
            <textarea
              className="form-control form-control-sm"
              rows="3"
              name="address"
              value={form.address}
              onChange={handleChange}
            />
          </div>
        </div>
        {message && <div className="alert alert-info py-2 mt-3">{message}</div>}
        <div className="d-flex justify-content-end mt-2">
          <Button variant="primary" type="submit" disabled={loading} size="sm">
            {loading ? 'Saving...' : 'Save Company'}
          </Button>
        </div>
      </div>
    </form>
  );
};

export default CompanySettings;



===============================
FILE: src/pages/Settings/General.jsx
===============================
import React, { useEffect, useState } from 'react';
import Button from '../../components/common/Button';

const GeneralSettings = () => {
  const [form, setForm] = useState({
    auto_generate_sku: 1,
    sku_prefix: 'SKU',
    currency: 'INR',
  });
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');

  const loadSettings = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const result = await window.xnoll.settingsGet();
      if (result?.success && result.settings) {
        setForm((prev) => ({
          ...prev,
          ...result.settings,
        }));
      }
    } catch (err) {
      console.error('Load settings failed', err);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadSettings();
  }, []);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setForm((f) => ({
      ...f,
      [name]: type === 'checkbox' ? (checked ? 1 : 0) : value,
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;
    setLoading(true);
    setMessage('');
    try {
      const res = await window.xnoll.settingsSave(form);
      if (res?.success) setMessage('Saved');
      else setMessage(res?.error || 'Save failed');
    } catch (err) {
      setMessage('Save failed');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="card shadow-sm border-0">
      <div className="card-body">
        <h6 className="mb-3">General</h6>
        <div className="form-check form-switch mb-3">
          <input
            className="form-check-input"
            type="checkbox"
            id="autoSku"
            name="auto_generate_sku"
            checked={!!form.auto_generate_sku}
            onChange={handleChange}
          />
          <label className="form-check-label" htmlFor="autoSku">
            Auto generate SKU for products/services
          </label>
        </div>
        <div className="mb-3">
          <label className="form-label small mb-0">SKU Prefix</label>
          <input
            className="form-control form-control-sm"
            name="sku_prefix"
            value={form.sku_prefix || ''}
            onChange={handleChange}
            placeholder="SKU"
          />
          <small className="text-muted">Used when auto generating SKUs.</small>
        </div>
        <div className="mb-3">
          <label className="form-label small mb-0">Currency</label>
          <select
            className="form-select form-select-sm"
            name="currency"
            value={form.currency || 'INR'}
            onChange={handleChange}
          >
            <option value="INR">INR (â¹)</option>
            <option value="USD">USD ($)</option>
            <option value="EUR">EUR (â¬)</option>
            <option value="GBP">GBP (Â£)</option>
            <option value="JPY">JPY (Â¥)</option>
            <option value="AUD">AUD (A$)</option>
            <option value="CAD">CAD (C$)</option>
          </select>
          <small className="text-muted">Default currency for the application.</small>
        </div>
        {message && <div className="alert alert-info py-2">{message}</div>}
        <div className="d-flex justify-content-end">
          <Button variant="primary" type="submit" disabled={loading} size="sm">
            {loading ? 'Saving...' : 'Save Settings'}
          </Button>
        </div>
      </div>
    </form>
  );
};

export default GeneralSettings;



===============================
FILE: src/pages/Settings/CustomFields.jsx
===============================
import React, { useEffect, useMemo, useState } from 'react';
import Button from '../../components/common/Button';
import Modal from '../../components/common/Modal';
import SearchBar from '../../components/common/SearchBar';

const modules = [
  { value: 'customers', label: 'Customers' },
  { value: 'products', label: 'Products' },
  { value: 'bookings', label: 'Bookings' },
];

const fieldTypes = [
  'text',
  'number',
  'date',
  'select',
];

const emptyForm = {
  id: null,
  name: '',
  label: '',
  module: 'customers',
  type: 'text',
  required: 0,
  display_in_grid: 1,
  display_in_filter: 0,
  sortable: 1,
  searchable: 1,
  options: '',
  default_value: '',
};

const CustomFields = () => {
  const [fields, setFields] = useState([]);
  const [search, setSearch] = useState('');
  const [showModal, setShowModal] = useState(false);
  const [form, setForm] = useState(emptyForm);
  const [loading, setLoading] = useState(false);
  const [moduleFilter, setModuleFilter] = useState('all');
  const [isEditing, setIsEditing] = useState(false);

  const loadFields = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const res =
        moduleFilter === 'all'
          ? await window.xnoll.customFieldsList()
          : await window.xnoll.customFieldsList(moduleFilter);
      setFields(res || []);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadFields();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [moduleFilter]);

  const filtered = useMemo(() => {
    const term = search.trim().toLowerCase();
    let data = [...fields];
    if (term) {
      data = data.filter(
        (f) =>
          (f.label || '').toLowerCase().includes(term) ||
          (f.name || '').toLowerCase().includes(term) ||
          (f.module || '').toLowerCase().includes(term)
      );
    }
    return data;
  }, [fields, search]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;
    setLoading(true);
    // Auto-generate name if empty
    let name = form.name;
    if (!name && form.label) {
      name = form.label
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '_')
        .replace(/^_+|_+$/g, '');
    }
    // Disallow default_value for date/datetime
    let payload = {
      ...form,
      name,
      required: form.required ? 1 : 0,
      display_in_grid: form.display_in_grid ? 1 : 0,
      display_in_filter: form.display_in_filter ? 1 : 0,
      sortable: form.sortable ? 1 : 0,
      searchable: form.searchable ? 1 : 0,
    };
    if (["date","datetime"].includes(form.type)) {
      payload.default_value = '';
    }
    try {
      if (isEditing && form.id != null) {
        await window.xnoll.customFieldsUpdate(payload);
      } else {
        await window.xnoll.customFieldsCreate(payload);
      }
      await loadFields();
      setShowModal(false);
      setForm(emptyForm);
      setIsEditing(false);
    } catch (err) {
      console.error('Save custom field failed', err);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id) => {
    if (!window.xnoll) return;
    if (!window.confirm('Delete this custom field?')) return;
    setLoading(true);
    try {
      await window.xnoll.customFieldsDelete(id);
      await loadFields();
    } finally {
      setLoading(false);
    }
  };

  const openEdit = (field) => {
    setForm({
      ...field,
      required: !!field.required,
      display_in_grid: !!field.display_in_grid,
      display_in_filter: !!field.display_in_filter,
      sortable: !!field.sortable,
      searchable: !!field.searchable,
      options: field.options || '',
    });
    setIsEditing(true);
    setShowModal(true);
  };

  const openNew = () => {
    setForm(emptyForm);
    setIsEditing(false);
    setShowModal(true);
  };

  return (
    <div>
      <div className="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3">
        <div>
          <h6 className="mb-0">Custom Fields</h6>
          <small className="text-muted">Build per-module fields with grid/filter flags.</small>
        </div>
        <div className="d-flex gap-2 flex-wrap">
          <select
            className="form-select form-select-sm"
            value={moduleFilter}
            onChange={(e) => setModuleFilter(e.target.value)}
          >
            <option value="all">All modules</option>
            {modules.map((m) => (
              <option key={m.value} value={m.value}>
                {m.label}
              </option>
            ))}
          </select>
          <SearchBar value={search} onChange={setSearch} size="sm" />
          <Button variant="primary" size="sm" onClick={openNew}>
            + Add Field
          </Button>
        </div>
      </div>

      <div className="table-responsive">
        <table className="table table-sm table-striped align-middle">
          <thead className="table-light">
            <tr>
              <th>Label</th>
              <th>Module</th>
              <th>Type</th>
              <th>Grid</th>
              <th>Filter</th>
              <th>Required</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {filtered.map((field) => (
              <tr key={field.id}>
                <td>{field.label}</td>
                <td className="text-capitalize">{field.module}</td>
                <td>{field.type}</td>
                <td>{field.display_in_grid ? 'Yes' : 'No'}</td>
                <td>{field.display_in_filter ? 'Yes' : 'No'}</td>
                <td>{field.required ? 'Yes' : 'No'}</td>
                <td>
                  <div className="btn-group btn-group-sm">
                    <button className="btn btn-outline-primary" onClick={() => openEdit(field)}>
                      Edit
                    </button>
                    <button className="btn btn-outline-danger" onClick={() => handleDelete(field.id)}>
                      Del
                    </button>
                  </div>
                </td>
              </tr>
            ))}
            {!filtered.length && (
              <tr>
                <td colSpan="7" className="text-center text-muted">
                  No custom fields yet.
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>

      <Modal
        show={showModal}
        onClose={() => setShowModal(false)}
        title={isEditing ? 'Edit Custom Field' : 'Add Custom Field'}
        size="lg"
      >
        <form onSubmit={handleSubmit}>
          <div className="row g-3">
            <div className="col-md-4">
              <label className="form-label small mb-0">Label *</label>
              <input
                className="form-control form-control-sm"
                value={form.label}
                onChange={(e) => {
                  const val = e.target.value;
                  setForm((f) => ({
                    ...f,
                    label: val,
                    name:
                      f.name && f.name !== ''
                        ? f.name
                        : val
                            .toLowerCase()
                            .replace(/[^a-z0-9]+/g, '_')
                            .replace(/^_+|_+$/g, ''),
                  }));
                }}
                required
              />
            </div>
            <div className="col-md-4">
              <label className="form-label small mb-0">Name (key) *</label>
              <input
                className="form-control form-control-sm"
                value={form.name}
                onChange={(e) => setForm((f) => ({ ...f, name: e.target.value }))}
                required
                placeholder="unique_key"
              />
            </div>
            <div className="col-md-4">
              <label className="form-label small mb-0">Module</label>
              <select
                className="form-select form-select-sm"
                value={form.module}
                onChange={(e) => setForm((f) => ({ ...f, module: e.target.value }))}
              >
                {modules.map((m) => (
                  <option key={m.value} value={m.value}>
                    {m.label}
                  </option>
                ))}
              </select>
            </div>
            <div className="col-md-4">
              <label className="form-label small mb-0">Type</label>
              <select
                className="form-select form-select-sm"
                value={form.type}
                onChange={(e) => setForm((f) => ({ ...f, type: e.target.value }))}
              >
                {fieldTypes.map((t) => (
                  <option key={t} value={t}>
                    {t.replace('_', ' ')}
                  </option>
                ))}
              </select>
            </div>
            <div className="col-md-4">
              <label className="form-label small mb-0">Options (comma separated)</label>
              <input
                className="form-control form-control-sm"
                value={form.options}
                onChange={(e) => setForm((f) => ({ ...f, options: e.target.value }))}
                placeholder="option1,option2"
                disabled={!['select'].includes(form.type)}
              />
            </div>
            <div className="col-md-4">
              <label className="form-label small mb-0">Default value</label>
              <input
                className="form-control form-control-sm"
                value={form.default_value}
                onChange={(e) => setForm((f) => ({ ...f, default_value: e.target.value }))}
                disabled={['date', 'datetime'].includes(form.type)}
                placeholder={['date', 'datetime'].includes(form.type) ? 'Not allowed for dates' : ''}
              />
            </div>
            <div className="col-12">
              <div className="d-flex flex-wrap gap-3">
                <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="cfRequired"
                    checked={!!form.required}
                    onChange={(e) => setForm((f) => ({ ...f, required: e.target.checked }))}
                  />
                  <label className="form-check-label" htmlFor="cfRequired">
                    Required
                  </label>
                </div>
                <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="cfGrid"
                    checked={!!form.display_in_grid}
                    onChange={(e) => setForm((f) => ({ ...f, display_in_grid: e.target.checked }))}
                  />
                  <label className="form-check-label" htmlFor="cfGrid">
                    Show in grid
                  </label>
                </div>
                {/* <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="cfFilter"
                    checked={!!form.display_in_filter}
                    onChange={(e) => setForm((f) => ({ ...f, display_in_filter: e.target.checked }))}
                  />
                  <label className="form-check-label" htmlFor="cfFilter">
                    Filterable
                  </label>
                </div> */}
                <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="cfSortable"
                    checked={!!form.sortable}
                    onChange={(e) => setForm((f) => ({ ...f, sortable: e.target.checked }))}
                  />
                  <label className="form-check-label" htmlFor="cfSortable">
                    Sortable
                  </label>
                </div>
                <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="cfSearch"
                    checked={!!form.searchable}
                    onChange={(e) => setForm((f) => ({ ...f, searchable: e.target.checked }))}
                  />
                  <label className="form-check-label" htmlFor="cfSearch">
                    Searchable
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div className="d-flex justify-content-end gap-2 mt-3">
            <Button variant="outline-secondary" type="button" size="sm" onClick={() => setShowModal(false)}>
              Cancel
            </Button>
            <Button variant="primary" type="submit" size="sm" disabled={loading}>
              {loading ? 'Saving...' : 'Save Field'}
            </Button>
          </div>
        </form>
      </Modal>
    </div>
  );
};

export default CustomFields;



===============================
FILE: src/pages/Settings/index.jsx
===============================
import React, { useState } from 'react';
import General from './General';
import Company from './Company';
import Language from './Language';
import Backup from './Backup';
import CustomFields from './CustomFields';
import CodeGenerator from './CodeGenerator';

const tabs = [
  { key: 'general', label: 'General' },
  { key: 'company', label: 'Company' },
  // { key: 'language', label: 'Language' },
  { key: 'custom', label: 'Custom Fields' },
  // { key: 'backup', label: 'Backup & Restore' },
  // { key: 'code-generator', label: 'Code Generator' },
];

const Settings = () => {
  const [active, setActive] = useState('general');

  const renderTab = () => {
    switch (active) {
      case 'general':
        return <General />;
      case 'company':
        return <Company />;
      // case 'language':
      //   return <Language />;
      case 'custom':
        return <CustomFields />;
      case 'backup':
        return <Backup />;
      case 'license':
        return <License />;
      case 'code-generator':
        return <CodeGenerator />;
      default:
        return <General />;
    }
  };

  return (
    <div>
      <h4 className="mb-3">Settings</h4>
      <div className="d-flex flex-wrap gap-2 mb-3">
        {tabs.map((tab) => (
          <button
            key={tab.key}
            className={`btn btn-sm ${active === tab.key ? 'btn-primary' : 'btn-outline-secondary'}`}
            onClick={() => setActive(tab.key)}
          >
            {tab.label}
          </button>
        ))}
      </div>
      {renderTab()}
    </div>
  );
};

export default Settings;


===============================
FILE: src/pages/Settings/Backup.jsx
===============================
import React, { useState, useEffect } from 'react';
import Button from '../../components/common/Button';

const BackupSettings = () => {
  const [status, setStatus] = useState('');
  const [loading, setLoading] = useState(false);
  const [backups, setBackups] = useState([]);

  const loadBackups = async () => {
    try {
      const backups = await window.xnoll.backupList();
      setBackups(backups || []);
    } catch (err) {
      console.error('Failed to load backups:', err);
      setBackups([]);
    }
  };

  useEffect(() => {
    loadBackups();
  }, []);

  const handleBackup = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    setStatus('');
    try {
      const dir = await window.xnoll.selectDirectory();
      if (!dir) {
        setLoading(false);
        return;
      }
      const res = await window.xnoll.backupCreate(dir);
      if (res?.success) {
        setStatus(`â Backup created successfully at ${res.backupPath || dir}`);
        loadBackups(); // Refresh backup list
      } else {
        setStatus(`â Backup failed: ${res?.error || 'Unknown error'}`);
      }
    } catch (err) {
      setStatus(`â Backup failed: ${err.message}`);
    } finally {
      setLoading(false);
    }
  };

  const handleRestore = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    setStatus('');
    try {
      const file = await window.xnoll.selectFile({
        filters: [{ name: 'SQLite Database', extensions: ['db', 'sqlite'] }]
      });
      if (!file) {
        setLoading(false);
        return;
      }

      // Show confirmation dialog
      const confirmed = window.confirm(
        'â ï¸ Warning: Restoring from backup will replace all current data. ' +
        'Make sure you have a recent backup of your current data. Continue?'
      );

      if (!confirmed) {
        setLoading(false);
        return;
      }

      const res = await window.xnoll.backupRestore(file);
      if (res?.success) {
        setStatus('â Restore completed successfully. Please restart the application.');
      } else {
        setStatus(`â Restore failed: ${res?.error || 'Unknown error'}`);
      }
    } catch (err) {
      setStatus(`â Restore failed: ${err.message}`);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="card shadow-sm border-0">
      <div className="card-body">
        <h6 className="mb-3">Backup & Restore</h6>
        <div className="d-flex gap-2 flex-wrap">
          <Button variant="primary" size="sm" onClick={handleBackup} disabled={loading}>
            {loading ? 'Working...' : 'Create Backup'}
          </Button>
          <Button variant="outline-secondary" size="sm" onClick={handleRestore} disabled={loading}>
            Restore from file
          </Button>
        </div>
        <small className="text-muted d-block mt-2">
          Backups are stored locally. Keep a copy on external drive/cloud.
        </small>
        {status && <div className="alert alert-info py-2 mt-3">{status}</div>}
      </div>
    </div>
  );
};

export default BackupSettings;



===============================
FILE: src/pages/Settings/CodeGenerator.jsx
===============================
// src/pages/Settings/CodeGenerator.jsx
import React, { useState } from "react";

function CodeGenerator() {
  const [loading, setLoading] = useState(false);
  const [log, setLog] = useState("");  // Will append lines

  const appendLog = (newLog) => {
    setLog((prev) => prev + (prev ? "\n" : "") + newLog);
  };

  const runSeeder = async () => {
    if (loading) return;
    setLoading(true);
    setLog("Running seeder... please wait.\n");  // Initial log

    // Subscribe to real-time logs
    const logCleanup = window.xnoll.onSeederLog(appendLog);
    const finishedCleanup = window.xnoll.onSeederFinished((code) => {
      const finalMsg = code === 0 ? "Seeder completed successfully!" : `Seeder failed with code ${code}`;
      appendLog(finalMsg);
      setLoading(false);
      // Clean up listeners after delay
      setTimeout(() => {
        logCleanup();
        finishedCleanup();
      }, 1000);
    });

    try {
      const result = await window.api.runSeeder();  // Now awaits the promise
      if (result?.success) {
        appendLog("â Data generation complete. Refresh Dashboard to see changes.");
      } else {
        appendLog("â Seeder failed. Check logs above.");
      }
    } catch (err) {
      appendLog(`â Error: ${err.message}`);
    } finally {
      setLoading(false);
      // Ensure cleanup
      logCleanup();
      finishedCleanup();
    }
  };

  if (import.meta.env.MODE !== "development") {
    return null; // hide in production
  }

  return (
    <div style={{ padding: "20px" }}>
      <h2>Developer Tools</h2>

      <button
        onClick={runSeeder}
        disabled={loading}
        style={{
          padding: "10px 20px",
          background: loading ? "#999" : "#28a745",
          color: "white",
          border: "none",
          borderRadius: "4px",
          cursor: loading ? "not-allowed" : "pointer",
          marginTop: "10px"
        }}
      >
        {loading ? "Generating Dummy Data..." : "Generate Dummy Data"}
      </button>

      <pre style={{ marginTop: "20px", background: "#f4f4f4", padding: "15px", maxHeight: "400px", overflowY: "auto" }}>
        {log || "Click button to start..."}
      </pre>
    </div>
  );
}

export default CodeGenerator;

===============================
FILE: src/pages/Settings/Language.jsx
===============================
import React from 'react';
import { useTranslation } from '../../i18n/i18nContext';

const LanguageSettings = () => {
  const { language, changeLanguage, availableLanguages } = useTranslation();

  return (
    <div className="card shadow-sm border-0">
      <div className="card-body">
        <h6 className="mb-3">Language</h6>
        <div className="row g-3">
          {availableLanguages.map((lang) => (
            <div className="col-md-4" key={lang.code}>
              <div className={`card border ${language === lang.code ? 'border-primary' : 'border-light'}`}>
                <div className="card-body d-flex justify-content-between align-items-center">
                  <div>
                    <div className="fw-semibold">{lang.name}</div>
                    <small className="text-muted">{lang.nativeName}</small>
                  </div>
                  <input
                    type="radio"
                    name="language"
                    checked={language === lang.code}
                    onChange={() => changeLanguage(lang.code)}
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
        <small className="text-muted d-block mt-3">
          Language is stored locally and applied instantly.
        </small>
      </div>
    </div>
  );
};

export default LanguageSettings;



===============================
FILE: src/pages/Dashboard/index.jsx
===============================
import React, { useEffect, useState } from "react";

const Dashboard = () => {
  const [loading, setLoading] = useState(false);
  const [cards, setCards] = useState({
    customers: 0,
    products: 0,
    bookingsToday: 0,
    bookingsUpcoming: 0,
    invoicesUnpaid: 0,
    invoicesTodayTotal: 0,
  });

  const [recentBookings, setRecentBookings] = useState([]);
  const [recentInvoices, setRecentInvoices] = useState([]);

  const getBookingBadge = (status) => {
    switch ((status || "").toLowerCase()) {
      case "pending":
        return "badge bg-warning text-dark";
      case "confirmed":
        return "badge bg-primary";
      case "completed":
        return "badge bg-success";
      case "cancelled":
        return "badge bg-danger";
      default:
        return "badge bg-secondary";
    }
  };

  const getInvoiceBadge = (status) => {
    switch ((status || "").toLowerCase()) {
      case "paid":
        return "badge bg-success";
      case "unpaid":
        return "badge bg-danger";
      case "partial":
        return "badge bg-warning text-dark";
      default:
        return "badge bg-secondary";
    }
  };

  const loadData = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const [customers, products, bookings, invoices] = await Promise.all([
        window.xnoll.customersList(),
        window.xnoll.productsList(),
        window.xnoll.bookingsList(),
        window.xnoll.invoicesList(),
      ]);

      const todayStr = new Date().toISOString().slice(0, 10);

      const bookingsToday = bookings.filter(
        (b) => (b.booking_date || "").slice(0, 10) === todayStr
      ).length;

      const bookingsUpcoming = bookings.filter((b) => {
        const d = (b.booking_date || "").slice(0, 10);
        return d > todayStr;
      }).length;

      const invoicesUnpaid = invoices.filter(
        (i) => (i.status || "unpaid") !== "paid"
      ).length;

      const invoicesTodayTotal = invoices
        .filter((i) => (i.invoice_date || "").slice(0, 10) === todayStr)
        .reduce((sum, i) => sum + (Number(i.total) || 0), 0);

      // Sort bookings by date desc and take last 5
      const recentB = [...bookings]
        .sort((a, b) =>
          (b.booking_date || "").localeCompare(a.booking_date || "")
        )
        .slice(0, 5);

      // Sort invoices by date desc and take last 5
      const recentI = [...invoices]
        .sort((a, b) =>
          (b.invoice_date || "").localeCompare(a.invoice_date || "")
        )
        .slice(0, 5);

      setCards({
        customers: customers.length,
        products: products.length,
        bookingsToday,
        bookingsUpcoming,
        invoicesUnpaid,
        invoicesTodayTotal,
      });
      setRecentBookings(recentB);
      setRecentInvoices(recentI);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadData();
  }, []);

  return (
    <div>
      <h4 className="mb-3">Dashboard</h4>

      <div className="card shadow-sm border-0 mb-3">
        <div className="card-body d-flex justify-content-between align-items-center">
          <div>
            <p className="mb-0 text-muted small">
              Quick overview of your local data.
            </p>
          </div>
          <button
            className="btn btn-sm btn-outline-primary"
            onClick={loadData}
            disabled={loading}
          >
            {loading ? "Refreshing..." : "Refresh"}
          </button>
        </div>
      </div>

      {/* Top summary cards */}
      <div className="row g-3 mb-3">
        <div className="col-md-3">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <h6 className="text-muted mb-1">Customers</h6>
              <h3 className="mb-1">{cards.customers}</h3>
              <small className="text-success">Total customers in system</small>
            </div>
          </div>
        </div>

        <div className="col-md-3">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <h6 className="text-muted mb-1">Products / Services</h6>
              <h3 className="mb-1">{cards.products}</h3>
              <small className="text-success">Active items in catalog</small>
            </div>
          </div>
        </div>

        <div className="col-md-3">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <h6 className="text-muted mb-1">Bookings Today</h6>
              <h3 className="mb-1">{cards.bookingsToday}</h3>
              <small className="text-primary">
                Appointments scheduled today
              </small>
            </div>
          </div>
        </div>

        <div className="col-md-3">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <h6 className="text-muted mb-1">Upcoming Bookings</h6>
              <h3 className="mb-1">{cards.bookingsUpcoming}</h3>
              <small className="text-primary">Future appointments</small>
            </div>
          </div>
        </div>

        <div className="col-md-3">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <h6 className="text-muted mb-1">Unpaid Invoices</h6>
              <h3 className="mb-1">{cards.invoicesUnpaid}</h3>
              <small className="text-danger">Need payment follow-up</small>
            </div>
          </div>
        </div>

        <div className="col-md-3">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <h6 className="text-muted mb-1">Today&apos;s Billing</h6>
              <h3 className="mb-1">
                â¹
                {cards.invoicesTodayTotal.toLocaleString("en-IN", {
                  maximumFractionDigits: 2,
                })}
              </h3>
              <small className="text-muted">
                Total invoice amount for today
              </small>
            </div>
          </div>
        </div>
      </div>

      {/* Recent activity: bookings + invoices */}
      <div className="row g-3">
        <div className="col-lg-6">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <div className="d-flex justify-content-between align-items-center mb-2">
                <h6 className="card-title mb-0">Recent Bookings</h6>
                <small className="text-muted">Last 5 records</small>
              </div>
              <div className="table-responsive" style={{ maxHeight: "260px" }}>
                <table className="table table-sm table-striped align-middle mb-0">
                  <thead className="table-light">
                    <tr>
                      <th style={{ width: "60px" }}>ID</th>
                      <th style={{ width: "90px" }}>Customer</th>
                      <th>Service</th>
                      <th style={{ width: "150px" }}>Date/Time</th>
                      <th style={{ width: "90px" }}>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {recentBookings.map((b) => (
                      <tr key={b.id}>
                        <td>{b.id}</td>
                        <td>{b.customer_id}</td>
                        <td>{b.service_name}</td>
                        <td>{b.booking_date}</td>
                        <td>
                          <span className={getBookingBadge(b.status)}>
                            {b.status || "pending"}
                          </span>
                        </td>
                      </tr>
                    ))}
                    {!recentBookings.length && (
                      <tr>
                        <td colSpan="5" className="text-center text-muted">
                          No bookings yet.
                        </td>
                      </tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div className="col-lg-6">
          <div className="card shadow-sm border-0 h-100">
            <div className="card-body">
              <div className="d-flex justify-content-between align-items-center mb-2">
                <h6 className="card-title mb-0">Recent Invoices</h6>
                <small className="text-muted">Last 5 records</small>
              </div>
              <div className="table-responsive" style={{ maxHeight: "260px" }}>
                <table className="table table-sm table-striped align-middle mb-0">
                  <thead className="table-light">
                    <tr>
                      <th style={{ width: "60px" }}>ID</th>
                      <th style={{ width: "90px" }}>Customer</th>
                      <th style={{ width: "150px" }}>Date</th>
                      <th style={{ width: "100px" }}>Total</th>
                      <th style={{ width: "90px" }}>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {recentInvoices.map((inv) => (
                      <tr key={inv.id}>
                        <td>{inv.id}</td>
                        <td>{inv.customer_id}</td>
                        <td>{inv.invoice_date}</td>
                        <td>{inv.total}</td>
                        <td>
                          <span className={getInvoiceBadge(inv.status)}>
                            {(inv.status || "unpaid").replace("_", " ")}
                          </span>
                        </td>
                      </tr>
                    ))}
                    {!recentInvoices.length && (
                      <tr>
                        <td colSpan="5" className="text-center text-muted">
                          No invoices yet.
                        </td>
                      </tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Dashboard;


===============================
FILE: src/pages/Notes/index.jsx
===============================
import React, { useEffect, useMemo, useState } from 'react';
import SearchBar from '../../components/common/SearchBar';
import Button from '../../components/common/Button';
import Modal from '../../components/common/Modal';

const emptyForm = {
  id: null,
  title: '',
  content: '',
  tags: '',
  is_pinned: 0,
};

const NotesPage = () => {
  const [notes, setNotes] = useState([]);
  const [loading, setLoading] = useState(false);
  const [search, setSearch] = useState('');
  const [showModal, setShowModal] = useState(false);
  const [form, setForm] = useState(emptyForm);
  const [isEditing, setIsEditing] = useState(false);

  const loadNotes = async () => {
    if (!window.xnoll) return;
    setLoading(true);
    try {
      const rows = await window.xnoll.notesList();
      setNotes(rows || []);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadNotes();
  }, []);

  const filtered = useMemo(() => {
    const term = search.trim().toLowerCase();
    let data = [...notes];
    if (term) {
      data = data.filter(
        (n) =>
          (n.title || '').toLowerCase().includes(term) ||
          (n.content || '').toLowerCase().includes(term) ||
          (n.tags || '').toLowerCase().includes(term)
      );
    }
        data.sort((a, b) => Number(b.is_pinned || 0) - Number(a.is_pinned || 0));
    return data;
  }, [notes, search]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!window.xnoll) return;
        if (!form.title.trim()) return;
        setLoading(true);
        try {
          const payload = {
            ...form,
            is_pinned: form.is_pinned ? 1 : 0,
            tags: form.tags.trim(),
            content: form.content.trim(),
          };
      if (isEditing && form.id != null) {
        await window.xnoll.notesUpdate(payload);
      } else {
        await window.xnoll.notesCreate(payload);
      }
      await loadNotes();
      setShowModal(false);
      setForm(emptyForm);
      setIsEditing(false);
    } catch (err) {
      console.error('Save note failed', err);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id) => {
    if (!window.xnoll) return;
    if (!window.confirm('Delete this note?')) return;
    setLoading(true);
    try {
      await window.xnoll.notesDelete(id);
      await loadNotes();
    } finally {
      setLoading(false);
    }
  };

  const openEdit = (note) => {
        setForm({
          id: note.id,
          title: note.title || '',
          content: note.content || '',
          tags: note.tags || '',
          is_pinned: Number(note.is_pinned) === 1,
        });
    setIsEditing(true);
    setShowModal(true);
  };

  const openCreate = () => {
    setForm(emptyForm);
    setIsEditing(false);
    setShowModal(true);
  };

  return (
    <div>
      <div className="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
        <div>
          <h4 className="mb-0">Notes</h4>
          <small className="text-muted">Fast jotting with tags & pin</small>
        </div>
        <div className="d-flex gap-2 flex-wrap">
          <SearchBar value={search} onChange={setSearch} size="sm" />
          <Button variant="primary" size="sm" onClick={openCreate}>
            + New Note
          </Button>
        </div>
      </div>

      <div className="row g-3">
        {filtered.map((note) => (
          <div className="col-md-4" key={note.id}>
            <div className="card shadow-sm h-100">
              <div className="card-body d-flex flex-column">
                <div className="d-flex justify-content-between align-items-start">
                  <div>
                    <h6 className="mb-1">
                      {note.title}{' '}
                      {note.is_pinned ? (
                        <span className="badge bg-warning text-dark ms-2">Pinned</span>
                      ) : null}
                    </h6>
                    {note.tags ? (
                      <div className="d-flex flex-wrap gap-1">
                        {note.tags.split(',').map((tag, index) => (
                          <span key={index} className="badge bg-secondary">
                            {tag.trim()}
                          </span>
                        ))}
                      </div>
                    ) : (
                      <small className="text-muted">No tags</small>
                    )}
                  </div>
                  <div className="btn-group btn-group-sm">
                    <button
                      className="btn btn-outline-primary"
                      onClick={() => openEdit(note)}
                    >
                      Edit
                    </button>
                    <button
                      className="btn btn-outline-danger"
                      onClick={() => handleDelete(note.id)}
                    >
                      Del
                    </button>
                  </div>
                </div>
                <p className="mt-2 mb-0 small text-muted" style={{ whiteSpace: 'pre-line' }}>
                  {note.content || 'â'}
                </p>
              </div>
            </div>
          </div>
        ))}

        {!filtered.length && !loading && (
          <div className="col-12 text-center text-muted py-4">No notes yet.</div>
        )}
      </div>

      <Modal show={showModal} onClose={() => setShowModal(false)} title={isEditing ? 'Edit Note' : 'New Note'}>
        <form onSubmit={handleSubmit}>
          <div className="mb-2">
            <label className="form-label small mb-0">Title *</label>
            <input
              className="form-control form-control-sm"
              value={form.title}
              onChange={(e) => setForm((f) => ({ ...f, title: e.target.value }))}
              required
              autoFocus
            />
          </div>
          <div className="mb-2">
            <label className="form-label small mb-0">Content</label>
            <textarea
              className="form-control form-control-sm"
              rows="4"
              value={form.content}
              onChange={(e) => setForm((f) => ({ ...f, content: e.target.value }))}
            />
          </div>
          <div className="mb-2">
            <label className="form-label small mb-0">Tags (comma separated)</label>
            <input
              className="form-control form-control-sm"
              value={form.tags}
              onChange={(e) => setForm((f) => ({ ...f, tags: e.target.value }))}
              placeholder="e.g. followup,priority"
            />
          </div>
              <div className="form-check mb-3">
                <input
                  className="form-check-input"
                  type="checkbox"
                  id="notePin"
                  checked={!!form.is_pinned}
                  onChange={(e) => setForm((f) => ({ ...f, is_pinned: e.target.checked }))}
                />
                <label className="form-check-label" htmlFor="notePin">
                  Pin this note
                </label>
              </div>
          <div className="d-flex justify-content-end gap-2">
            <Button variant="outline-secondary" type="button" onClick={() => setShowModal(false)} size="sm">
              Cancel
            </Button>
            <Button variant="primary" type="submit" size="sm" disabled={loading}>
              {loading ? 'Saving...' : 'Save'}
            </Button>
          </div>
        </form>
      </Modal>
    </div>
  );
};

export default NotesPage;



===============================
FILE: .env.development
===============================
VITE_APP_ENV=development
VITE_API_BASE_URL=http://localhost:8000
VITE_SYNC_ENABLED=false
VITE_LOG_LEVEL=debug
import.meta.env.MODE === "development"


===============================
FILE: .env.production
===============================
VITE_APP_ENV=production
VITE_API_BASE_URL=https://api.xnoll.com
VITE_SYNC_ENABLED=true
VITE_LOG_LEVEL=warn


===============================
FILE: electron-builder.yaml
===============================
appId: com.xnoll.desktop
productName: Xnoll Desktop
directories:
  output: dist/build
  buildResources: build
files:
  - dist/renderer/**/*
  - electron/**/*
  - package.json
asar: true
compression: maximum

win:
  target:
    - nsis
  icon: build/icon.ico
  
nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: Xnoll Desktop

mac:
  target:
    - dmg
  icon: build/icon.icns
  category: public.app-category.business
  hardenedRuntime: true
  gatekeeperAssess: false
  
linux:
  target:
    - AppImage
    - deb
  icon: build/icon.png
  category: Office

===============================
FILE: package.json
===============================
{
  "name": "xnoll-booking",
  "version": "1.0.0",
  "description": "Offline-first booking and appointment management system",
  "author": "Xnoll Team",
  "license": "Commercial",
  "main": "electron/main.js",
  "scripts": {
    "dev:renderer": "vite --config vite.config.mts --mode development",
    "dev:electron": "cross-env NODE_ENV=development electron .",
    "dev": "concurrently \"npm run dev:renderer\" \"wait-on http://localhost:5173 && npm run dev:electron\"",
    "build:renderer": "vite build --config vite.config.mts --mode production",
    "build:electron": "cross-env NODE_ENV=production electron-builder",
    "build": "npm run build:renderer && npm run build:electron",
    "rebuild": "electron-rebuild -f -w better-sqlite3",
    "postinstall": "electron-builder install-app-deps && npm run rebuild",
    "test": "echo \"Error: no test specified\" && exit 1",
    "lint": "eslint src electron",
    "format": "prettier --write \"src/**/*.{js,jsx}\" \"electron/**/*.js\""
  },
  "dependencies": {
    "@faker-js/faker": "^10.1.0",
    "better-sqlite3": "^12.5.0",
    "dayjs": "^1.11.19",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "sweetalert2": "^11.26.4"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.3.4",
    "concurrently": "^9.0.0",
    "cross-env": "^7.0.3",
    "electron": "^33.0.0",
    "electron-builder": "^24.13.3",
    "electron-rebuild": "^3.2.9",
    "eslint": "^8.57.0",
    "eslint-plugin-react": "^7.34.0",
    "prettier": "^3.2.5",
    "vite": "^5.4.0",
    "wait-on": "^8.0.0"
  },
  "build": {
    "appId": "com.xnoll.desktop",
    "productName": "Xnoll Desktop",
    "directories": {
      "output": "dist/build",
      "buildResources": "build"
    },
    "files": [
      "dist/renderer/**/*",
      "electron/**/*",
      "package.json",
      "node_modules/**/*"
    ],
    "asar": true,
    "compression": "maximum",
    "win": {
      "target": [
        {
          "target": "nsis",
          "arch": [
            "x64",
            "ia32"
          ]
        }
      ],
      "icon": "build/icon.ico"
    },
    "nsis": {
      "oneClick": false,
      "allowToChangeInstallationDirectory": true,
      "createDesktopShortcut": true,
      "createStartMenuShortcut": true,
      "shortcutName": "Xnoll Desktop",
      "installerIcon": "build/icon.ico",
      "uninstallerIcon": "build/icon.ico"
    },
    "mac": {
      "target": [
        "dmg",
        "zip"
      ],
      "icon": "build/icon.icns",
      "category": "public.app-category.business",
      "hardenedRuntime": true,
      "gatekeeperAssess": false
    },
    "dmg": {
      "contents": [
        {
          "x": 130,
          "y": 220
        },
        {
          "x": 410,
          "y": 220,
          "type": "link",
          "path": "/Applications"
        }
      ]
    },
    "linux": {
      "target": [
        "AppImage",
        "deb",
        "rpm"
      ],
      "icon": "build/icons",
      "category": "Office",
      "maintainer": "support@xnoll.com"
    }
  },
  "keywords": [
    "booking",
    "appointment",
    "scheduling",
    "salon",
    "spa",
    "offline",
    "desktop"
  ]
}


===============================
FILE: vite.config.mts
===============================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig({
  root: resolve(__dirname, 'src'),
  plugins: [react()],
  build: {
    outDir: resolve(__dirname, 'dist/renderer'),
    emptyOutDir: true
  },
  server: {
    port: 5173,
    strictPort: true
  },
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  }
});
